<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pinky Eyelashess — Extensiones de Pestañas & Cejas | Reserva Online</title>
    <meta name="description"
        content="Extensiones de pestañas (clásicas, híbridas, volumen 3D/5D, foxy, doll) y diseño/laminado de cejas. Reserva online, precios claros, reseñas y cuidado post. Atención dedicada.">
    <link rel="canonical" href="https://pinkyeyelashess.com/">
    <link rel="icon"
        href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='50' fill='%23FFE9F5'/%3E%3Cpath d='M50,25 Q65,45 50,75 Q35,45 50,25 Z' fill='%23E6B884'/%3E%3C/svg%3E"
        type="image/svg+xml">

    <meta property="og:title" content="Pinky Eyelashess — Extensiones de Pestañas & Cejas">
    <meta property="og:description"
        content="Extensiones de pestañas (clásicas, híbridas, volumen 3D/5D, foxy, doll) y diseño/laminado de cejas. Reserva online, precios claros, reseñas y cuidado post.">
    <meta property="og:image" content="https://pinkyeyelashess.com/og-image.webp">
    <meta property="og:url" content="https://pinkyeyelashess.com/">
    <meta property="og:type" content="website">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Pinky Eyelashess — Extensiones de Pestañas & Cejas">
    <meta name="twitter:description"
        content="Extensiones de pestañas y diseño/laminado de cejas. Reserva online, precios claros.">
    <meta name="twitter:image" content="https://pinkyeyelashess.com/og-image.webp">


    <link rel="manifest" href="manifest.webmanifest">


    <link rel="manifest" href="manifest.webmanifest">

    <!-- Manifest -->
    <link rel="manifest" href="/manifest.webmanifest">


    <meta name="theme-color" content="#FFE9F5">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400;1,700&family=Montserrat:wght@300;400;500;600;700&family=Great+Vibes&display=swap"
        rel="stylesheet" media="print" onload="this.media='all'">


    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.38.4/dist/umd/supabase.min.js"></script>


    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.38.4/dist/umd/supabase.min.js"></script>

    <!-- Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.38.4/dist/umd/supabase.min.js"></script>

    <!-- Chart.js para métricas en panel admin -->


    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js" defer></script>
    <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"BeautySalon",
    "name":"Pinky Eyelashess",
    "url":"https://pinkyeyelashess.com",
    "image":"https://pinkyeyelashess.com/og-image.webp",
    "telephone":"+56 9 3648 6082",
    "priceRange":"$$",
    "address": { "@type":"PostalAddress", "addressLocality":"Santiago", "addressCountry":"CL" },
    "sameAs":[
      "https://www.instagram.com/pinky.eyelashess?igsh=bnkxNHdlMmFrZmxz",
      "https://www.facebook.com/share/14QB1iFBQeC/?mibextid=wwXIfr",
      "https://www.tiktok.com/@pinky.eyelashess?_t=ZM-8z30a3ktCXG&_r=1"
    ],
    "offers": [
      { "@type":"Offer", "name":"Pestañas Híbridas", "priceCurrency":"CLP", "price":"35000", "availability":"https://schema.org/InStock" },
      { "@type":"Offer", "name":"Volumen 3D", "priceCurrency":"CLP", "price":"40000", "availability":"https://schema.org/InStock" },
      { "@type":"Offer", "name":"Diseño y Laminado de Cejas", "priceCurrency":"CLP", "price":"20000", "availability":"https://schema.org/InStock" }
    ]
  }
  </script>

    <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"FAQPage",
    "mainEntity":[
      {"@type":"Question","name":"¿Cuánto duran las extensiones de pestañas?","acceptedAnswer":{"@type":"Answer","text":"Según el efecto y el cuidado, 3 a 5 semanas. Recomendamos retoque cada 2–3 semanas."}},
      {"@type":"Question","name":"¿Cada cuánto se hace el retoque?","acceptedAnswer":{"@type":"Answer","text":"Entre las semanas 2 y 3 para mantener volumen, forma y simetría."}},
      {"@type":"Question","name":"¿Cómo cuidarlas las primeras 24h?","acceptedAnswer":{"@type":"Answer","text":"Evita mojar, vapor y aceites. No jales ni frotes. Cepíllalas suavemente al día siguiente."}},
      {"@type":"Question","name":"¿Puedo usar máscara de pestañas?","acceptedAnswer":{"@type":"Answer","text":"No es necesario. Si usas, que sea libre de aceites y aplícala en puntas, no en la base."}},
      {"@type":"Question","name":"¿Contraindicaciones?","acceptedAnswer":{"@type":"Answer","text":"Consulta si tienes alergias oculares, infecciones, procedimientos recientes o sensibilidad extrema."}}
    ]
  }
  </script>

    <style>


        :root {


            --color-primary: #FFDFF2;
            --color-primary-light: #FFF0F9;
            --color-primary-dark: #FFCCEA;
            --color-secondary: #F8D0BA;
            --color-secondary-light: #FDE8DC;
            --color-secondary-dark: #F2B999;
            --color-accent: #D279A5;
            --color-accent-light: #E5A8C7;
            --color-accent-dark: #BA5186;
            --color-gold: #D4AF37;
            --color-gold-light: #F0E68C;
            --color-gold-dark: #B8860B;
            --color-text: #584450;
            --color-text-light: #8A6F7D;
            --color-text-extra-light: #B8A6B0;
            --color-white: #FFFFFF;
            --color-black: #000000;
            --color-error: #E55F7E;
            --color-success: #66BB8A;
            --color-warning: #FFAB8C;
            --color-info: #82C3E6;
            --color-gray-100: #F9F7F8;
            --color-gray-200: #F0EDF0;
            --color-gray-300: #E3DEE2;
            --color-gray-400: #D0C8CE;
            --color-gray-500: #B2A8AF;
            --color-gray-600: #8A7F87;
            --color-gray-700: #6B6269;
            --color-gray-800: #4F484D;
            --color-gray-900: #342E32;

            --font-title: 'Playfair Display', serif;
            --font-cursive: 'Great Vibes', cursive;
            --font-body: 'Montserrat', sans-serif;

            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.04), 0 1px 3px rgba(0, 0, 0, 0.05);
            --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.04), 0 4px 6px rgba(0, 0, 0, 0.03);
            --shadow-xl: 0 20px 25px rgba(0, 0, 0, 0.05), 0 10px 10px rgba(0, 0, 0, 0.03);

            --radius-sm: 4px;
            --radius-md: 8px;
            --radius-lg: 16px;
            --radius-xl: 24px;
            --radius-full: 9999px;

            --spacing-xs: 0.25rem;
            --spacing-sm: 0.5rem;
            --spacing-md: 1rem;
            --spacing-lg: 1.5rem;
            --spacing-xl: 2rem;
            --spacing-2xl: 3rem;
            --spacing-3xl: 4rem;
            --spacing-4xl: 6rem;

            --container-width: 1300px;
            --header-height: 80px;
            --header-height-mobile: 70px;

            --transition-fast: 0.2s ease;
            --transition-normal: 0.3s ease;
            --transition-slow: 0.5s ease;

            --z-header: 100;
            --z-overlay: 200;
            --z-modal: 300;
            --z-toast: 400;
            --z-admin: 500;
        }

                *,
        *::before,
        *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html {
            font-size: 16px;
            scroll-behavior: smooth;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            overflow-x: hidden;
        }

        body {
            font-family: var(--font-body);
            color: var(--color-text);
            background-color: var(--color-white);
            line-height: 1.6;
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--color-primary-light) 0%, var(--color-white) 100%);
            opacity: 0.3;
            z-index: -1;
        }

        h1,
        h2,
        h3,
        h4,
        h5,
        h6 {
            font-family: var(--font-title);
            font-weight: 700;
            line-height: 1.3;
            margin-bottom: var(--spacing-md);
            color: var(--color-text);
        }

        h1 {
            font-size: 3rem;
            font-weight: 700;
            letter-spacing: -0.02em;
        }

        h2 {
            font-size: 2.5rem;
            letter-spacing: -0.01em;
        }

        h3 {
            font-size: 2rem;
        }

        h4 {
            font-size: 1.5rem;
        }

        h5 {
            font-size: 1.25rem;
        }

        h6 {
            font-size: 1rem;
        }

        p {
            margin-bottom: var(--spacing-md);
        }

        a {
            color: var(--color-accent);
            text-decoration: none;
            transition: color var(--transition-fast);
        }

        a:hover,
        a:focus {
            color: var(--color-accent-dark);
            text-decoration: none;
        }

        img {
            max-width: 100%;
            height: auto;
            display: block;
            user-select: none;
            border-radius: var(--radius-md);
        }

        button,
        .button {
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background-color: var(--color-accent);
            color: var(--color-white);
            font-family: var(--font-body);
            font-weight: 600;
            font-size: 0.9375rem;
            padding: 0.75rem 1.75rem;
            border: none;
            border-radius: var(--radius-full);
            transition: all var(--transition-fast);
            box-shadow: var(--shadow-sm);
            text-align: center;
            white-space: nowrap;
            line-height: 1.2;
            position: relative;
            overflow: hidden;
        }

        button::before,
        .button::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--color-white);
            opacity: 0;
            transition: opacity var(--transition-fast);
        }

        button:hover,
        .button:hover {
            transform: translateY(-2px);
            background-color: var(--color-accent-dark);
            box-shadow: var(--shadow-md);
        }

        button:active,
        .button:active {
            transform: translateY(0);
            box-shadow: var(--shadow-sm);
        }

        button:disabled,
        .button:disabled {
            background-color: var(--color-gray-400);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .button-gold {
            background: linear-gradient(135deg, var(--color-gold-light), var(--color-gold-dark));
            color: var(--color-white);
        }

        .button-gold:hover {
            background: linear-gradient(135deg, var(--color-gold), var(--color-gold-dark));
        }

        .button-secondary {
            background-color: transparent;
            color: var(--color-accent);
            border: 2px solid var(--color-accent);
        }

        .button-secondary:hover {
            color: var(--color-white);
            background-color: var(--color-accent);
            border-color: var(--color-accent);
        }

        .button-text {
            background-color: transparent;
            color: var(--color-accent);
            padding: 0.5rem 1rem;
            box-shadow: none;
        }

        .button-text:hover {
            background-color: rgba(210, 121, 165, 0.1);
            box-shadow: none;
            color: var(--color-accent-dark);
        }

        .button-icon {
            padding: 0.75rem;
            border-radius: var(--radius-full);
            width: 2.75rem;
            height: 2.75rem;
        }

        .button-small {
            padding: 0.5rem 1.25rem;
            font-size: 0.875rem;
        }

        .button-large {
            padding: 1rem 2.25rem;
            font-size: 1rem;
        }

        input,
        select,
        textarea {
            font-family: var(--font-body);
            font-size: 1rem;
            width: 100%;
            padding: 0.875rem 1rem;
            border: 1px solid var(--color-gray-300);
            border-radius: var(--radius-md);
            background-color: var(--color-white);
            color: var(--color-text);
            transition: all var(--transition-fast);
        }

        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: var(--color-accent);
            box-shadow: 0 0 0 3px rgba(210, 121, 165, 0.2);
        }

        input::placeholder,
        select::placeholder,
        textarea::placeholder {
            color: var(--color-gray-500);
        }

        textarea {
            min-height: 100px;
            resize: vertical;
        }

        select {
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%238A6F7D' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 1rem center;
            background-size: 1rem;
            padding-right: 2.5rem;
        }

        label {
            display: block;
            font-weight: 500;
            margin-bottom: var(--spacing-sm);
            color: var(--color-text);
        }

        .container {
            width: 100%;
            max-width: var(--container-width);
            margin: 0 auto;
            padding: 0 var(--spacing-md);
        }

        .section {
            padding: var(--spacing-3xl) 0;
            position: relative;
            overflow: hidden;
            scroll-margin-top: var(--header-height);
        }

        .section-sm {
            padding: var(--spacing-xl) 0;
        }

        .section-lg {
            padding: var(--spacing-4xl) 0;
        }

        .section-title {
            text-align: center;
            margin-bottom: var(--spacing-xl);
            position: relative;
            padding-bottom: var(--spacing-md);
            color: var(--color-accent-dark);
        }

        .section-title::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 2px;
            background: linear-gradient(to right, var(--color-accent), var(--color-gold));
        }

        .section-subtitle {
            text-align: center;
            font-size: 1.125rem;
            color: var(--color-text-light);
            margin-top: var(--spacing-sm);
            margin-bottom: var(--spacing-xl);
            max-width: 700px;
            margin-left: auto;
            margin-right: auto;
        }

                .text-center {
            text-align: center;
        }

        .text-left {
            text-align: left;
        }

        .text-right {
            text-align: right;
        }

        .text-primary {
            color: var(--color-primary);
        }

        .text-accent {
            color: var(--color-accent);
        }

        .text-gold {
            color: var(--color-gold);
        }

        .text-white {
            color: var(--color-white);
        }

        .text-light {
            color: var(--color-text-light);
        }

        .text-extra-light {
            color: var(--color-text-extra-light);
        }

        .text-cursive {
            font-family: var(--font-cursive);
            font-size: 1.5em;
            font-weight: 400;
        }

        .bg-primary {
            background-color: var(--color-primary);
        }

        .bg-primary-light {
            background-color: var(--color-primary-light);
        }

        .bg-primary-dark {
            background-color: var(--color-primary-dark);
        }

        .bg-secondary {
            background-color: var(--color-secondary);
        }

        .bg-accent {
            background-color: var(--color-accent);
        }

        .bg-white {
            background-color: var(--color-white);
        }

        .bg-gray-100 {
            background-color: var(--color-gray-100);
        }

        .bg-gold-gradient {
            background: linear-gradient(135deg, var(--color-gold-light), var(--color-gold-dark));
        }

        .mt-0 {
            margin-top: 0;
        }

        .mt-1 {
            margin-top: var(--spacing-xs);
        }

        .mt-2 {
            margin-top: var(--spacing-sm);
        }

        .mt-3 {
            margin-top: var(--spacing-md);
        }

        .mt-4 {
            margin-top: var(--spacing-lg);
        }

        .mt-5 {
            margin-top: var(--spacing-xl);
        }

        .mt-6 {
            margin-top: var(--spacing-2xl);
        }

        .mt-7 {
            margin-top: var(--spacing-3xl);
        }

        .mt-8 {
            margin-top: var(--spacing-4xl);
        }

        .mb-0 {
            margin-bottom: 0;
        }

        .mb-1 {
            margin-bottom: var(--spacing-xs);
        }

        .mb-2 {
            margin-bottom: var(--spacing-sm);
        }

        .mb-3 {
            margin-bottom: var(--spacing-md);
        }

        .mb-4 {
            margin-bottom: var(--spacing-lg);
        }

        .mb-5 {
            margin-bottom: var(--spacing-xl);
        }

        .mb-6 {
            margin-bottom: var(--spacing-2xl);
        }

        .mb-7 {
            margin-bottom: var(--spacing-3xl);
        }

        .mb-8 {
            margin-bottom: var(--spacing-4xl);
        }

        .mx-auto {
            margin-left: auto;
            margin-right: auto;
        }

        .pt-0 {
            padding-top: 0;
        }

        .pt-1 {
            padding-top: var(--spacing-xs);
        }

        .pt-2 {
            padding-top: var(--spacing-sm);
        }

        .pt-3 {
            padding-top: var(--spacing-md);
        }

        .pt-4 {
            padding-top: var(--spacing-lg);
        }

        .pt-5 {
            padding-top: var(--spacing-xl);
        }

        .pt-6 {
            padding-top: var(--spacing-2xl);
        }

        .pt-7 {
            padding-top: var(--spacing-3xl);
        }

        .pt-8 {
            padding-top: var(--spacing-4xl);
        }

        .pb-0 {
            padding-bottom: 0;
        }

        .pb-1 {
            padding-bottom: var(--spacing-xs);
        }

        .pb-2 {
            padding-bottom: var(--spacing-sm);
        }

        .pb-3 {
            padding-bottom: var(--spacing-md);
        }

        .pb-4 {
            padding-bottom: var(--spacing-lg);
        }

        .pb-5 {
            padding-bottom: var(--spacing-xl);
        }

        .pb-6 {
            padding-bottom: var(--spacing-2xl);
        }

        .pb-7 {
            padding-bottom: var(--spacing-3xl);
        }

        .pb-8 {
            padding-bottom: var(--spacing-4xl);
        }

        .p-3 {
            padding: var(--spacing-md);
        }

        .p-4 {
            padding: var(--spacing-lg);
        }

        .p-5 {
            padding: var(--spacing-xl);
        }

        .rounded-sm {
            border-radius: var(--radius-sm);
        }

        .rounded-md {
            border-radius: var(--radius-md);
        }

        .rounded-lg {
            border-radius: var(--radius-lg);
        }

        .rounded-xl {
            border-radius: var(--radius-xl);
        }

        .rounded-full {
            border-radius: var(--radius-full);
        }

        .shadow-sm {
            box-shadow: var(--shadow-sm);
        }

        .shadow-md {
            box-shadow: var(--shadow-md);
        }

        .shadow-lg {
            box-shadow: var(--shadow-lg);
        }

        .shadow-xl {
            box-shadow: var(--shadow-xl);
        }

        .flex {
            display: flex;
        }

        .inline-flex {
            display: inline-flex;
        }

        .flex-col {
            flex-direction: column;
        }

        .flex-row {
            flex-direction: row;
        }

        .flex-wrap {
            flex-wrap: wrap;
        }

        .flex-nowrap {
            flex-wrap: nowrap;
        }

        .flex-1 {
            flex: 1;
        }

        .items-center {
            align-items: center;
        }

        .items-start {
            align-items: flex-start;
        }

        .items-end {
            align-items: flex-end;
        }

        .justify-center {
            justify-content: center;
        }

        .justify-between {
            justify-content: space-between;
        }

        .justify-start {
            justify-content: flex-start;
        }

        .justify-end {
            justify-content: flex-end;
        }

        .gap-1 {
            gap: var(--spacing-xs);
        }

        .gap-2 {
            gap: var(--spacing-sm);
        }

        .gap-3 {
            gap: var(--spacing-md);
        }

        .gap-4 {
            gap: var(--spacing-lg);
        }

        .gap-5 {
            gap: var(--spacing-xl);
        }

        .gap-6 {
            gap: var(--spacing-2xl);
        }

        .w-full {
            width: 100%;
        }

        .h-full {
            height: 100%;
        }

        .hidden {
            display: none !important;
        }

        .block {
            display: block;
        }

        .inline-block {
            display: inline-block;
        }

        .grid {
            display: grid;
            gap: var(--spacing-md);
        }

        .grid-cols-1 {
            grid-template-columns: 1fr;
        }

        .grid-cols-2 {
            grid-template-columns: repeat(2, 1fr);
        }

        .grid-cols-3 {
            grid-template-columns: repeat(3, 1fr);
        }

        .grid-cols-4 {
            grid-template-columns: repeat(4, 1fr);
        }

        .overlay {
            position: relative;
        }

        .overlay::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1;
        }

        .overlay>* {
            position: relative;
            z-index: 2;
        }

        .card {
            background-color: var(--color-white);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
            overflow: hidden;
            transition: transform var(--transition-normal), box-shadow var(--transition-normal);
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .card-body {
            padding: var(--spacing-lg);
        }

        .card-title {
            font-size: 1.25rem;
            margin-bottom: var(--spacing-sm);
        }

        .card-subtitle {
            font-size: 0.875rem;
            color: var(--color-text-light);
            margin-bottom: var(--spacing-md);
        }

        .card-footer {
            padding: var(--spacing-md) var(--spacing-lg);
            border-top: 1px solid var(--color-gray-200);
        }

        .badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: 600;
            padding: 0.25rem 0.75rem;
            border-radius: var(--radius-full);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .badge-accent {
            background-color: var(--color-accent-light);
            color: var(--color-accent-dark);
        }

        .badge-primary {
            background-color: var(--color-primary);
            color: var(--color-text);
        }

        .badge-success {
            background-color: rgba(102, 187, 138, 0.15);
            color: #2E7D42;
        }

        .badge-warning {
            background-color: rgba(255, 171, 140, 0.15);
            color: #E67E22;
        }

        .badge-error {
            background-color: rgba(229, 95, 126, 0.15);
            color: #C0392B;
        }

        .badge-gold {
            background: linear-gradient(135deg, var(--color-gold-light), var(--color-gold-dark));
            color: var(--color-white);
        }

                .toast-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: var(--z-toast);
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-width: 350px;
            width: calc(100% - 40px);
        }

        .toast {
            padding: 1rem 1.25rem;
            border-radius: var(--radius-md);
            background-color: var(--color-white);
            color: var(--color-text);
            box-shadow: var(--shadow-lg);
            display: flex;
            align-items: center;
            justify-content: space-between;
            animation: slideIn 0.3s forwards;
            border-left: 4px solid var(--color-accent);
        }

        .toast-success {
            border-left-color: var(--color-success);
        }

        .toast-error {
            border-left-color: var(--color-error);
        }

        .toast-warning {
            border-left-color: var(--color-warning);
        }

        .toast-info {
            border-left-color: var(--color-info);
        }

        .toast-content {
            flex: 1;
            padding-right: var(--spacing-md);
        }

        .toast-title {
            font-weight: 600;
            margin-bottom: 2px;
            font-size: 0.9375rem;
        }

        .toast-message {
            font-size: 0.875rem;
            color: var(--color-text-light);
        }

        .toast-close {
            background: none;
            border: none;
            color: var(--color-gray-500);
            font-size: 1.25rem;
            padding: 0;
            cursor: pointer;
            width: 24px;
            height: 24px;
            flex-shrink: 0;
            box-shadow: none;
        }

        .toast-close:hover {
            color: var(--color-text);
            background: none;
            box-shadow: none;
            transform: none;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }

            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }

                .header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background-color: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            z-index: var(--z-header);
            box-shadow: var(--shadow-sm);
            height: var(--header-height);
            display: flex;
            align-items: center;
            transition: all var(--transition-normal);
        }

        .header.scrolled {
            height: 70px;
            box-shadow: var(--shadow-md);
        }

        .header-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
        }

        .logo {
            display: flex;
            align-items: center;
            font-family: var(--font-cursive);
            font-size: 2rem;
            font-weight: 400;
            color: var(--color-accent);
            position: relative;
            z-index: 15;
            line-height: 1;
        }

        .logo span {
            color: var(--color-gold);
        }

        .logo img {
            height: 40px;
            width: auto;
            margin-right: var(--spacing-sm);
        }

        .logo-icon {
            display: inline-block;
            width: 40px;
            height: 40px;
            margin-right: 10px;
            position: relative;
        }

        .logo-icon::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--color-accent-light), var(--color-accent));
            border-radius: 50%;
        }

        .logo-icon::after {
            content: '';
            position: absolute;
            top: 20%;
            left: 40%;
            width: 60%;
            height: 60%;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23FFFFFF'%3E%3Cpath d='M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z'/%3E%3C/svg%3E");
            background-size: contain;
            transform: translate(-50%, -50%);
        }

        .nav-toggle {
            display: none;
            background: none;
            border: none;
            color: var(--color-text);
            font-size: 1.5rem;
            padding: 0;
            cursor: pointer;
            width: 40px;
            height: 40px;
            position: relative;
            z-index: 15;
        }

        .nav-toggle span {
            display: block;
            width: 24px;
            height: 2px;
            background-color: var(--color-text);
            position: relative;
            transition: all var(--transition-fast);
        }

        .nav-toggle span::before,
        .nav-toggle span::after {
            content: '';
            position: absolute;
            width: 24px;
            height: 2px;
            background-color: var(--color-text);
            transition: all var(--transition-fast);
        }

        .nav-toggle span::before {
            top: -8px;
        }

        .nav-toggle span::after {
            bottom: -8px;
        }

        .nav-toggle.active span {
            background-color: transparent;
        }

        .nav-toggle.active span::before {
            top: 0;
            transform: rotate(45deg);
        }

        .nav-toggle.active span::after {
            bottom: 0;
            transform: rotate(-45deg);
        }

        .nav {
            display: flex;
            align-items: center;
        }

        .nav-list {
            display: flex;
            list-style: none;
            margin: 0;
            padding: 0;
        }

        .nav-item {
            margin: 0 var(--spacing-sm);
        }

        .nav-link {
            display: block;
            padding: var(--spacing-sm) var(--spacing-sm);
            color: var(--color-text);
            font-weight: 500;
            font-size: 0.9375rem;
            transition: color var(--transition-fast);
            position: relative;
        }

        .nav-link::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 2px;
            background: linear-gradient(to right, var(--color-accent), var(--color-gold));
            transition: width var(--transition-normal);
        }

        .nav-link:hover,
        .nav-link:focus,
        .nav-link.active {
            color: var(--color-accent);
        }

        .nav-link:hover::after,
        .nav-link:focus::after,
        .nav-link.active::after {
            width: 70%;
        }

        .nav-cta {
            margin-left: var(--spacing-md);
        }

        .nav-social {
            display: flex;
            align-items: center;
            margin-left: var(--spacing-lg);
        }

        .nav-social-link {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 36px;
            border-radius: var(--radius-full);
            color: var(--color-text);
            margin-left: var(--spacing-xs);
            transition: all var(--transition-fast);
            background-color: transparent;
        }

        .nav-social-link:hover {
            background-color: var(--color-primary);
            color: var(--color-accent);
            transform: translateY(-2px);
        }

                .hero {
            padding-top: calc(var(--header-height) + var(--spacing-xl));
            padding-bottom: var(--spacing-3xl);
            position: relative;
            overflow: hidden;
            background: linear-gradient(to bottom right, var(--color-primary-light), var(--color-primary));
        }

        .hero::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100%;
            height: 100%;
            background-image: url('data:image/svg+xml,%3Csvg width="60" height="60" viewBox="0 0 60 60" xmlns="http://www.w3.org/2000/svg"%3E%3Cg fill="none" fill-rule="evenodd"%3E%3Cg fill="%23D279A5" fill-opacity="0.1"%3E%3Cpath d="M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z"/%3E%3C/g%3E%3C/g%3E%3C/svg%3E');
            opacity: 0.8;
            z-index: 0;
        }

        .hero-container {
            position: relative;
            z-index: 1;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: var(--spacing-3xl);
        }

        .hero-content {
            flex: 1;
            max-width: 600px;
        }

        .hero-subtitle {
            font-family: var(--font-cursive);
            font-size: 2rem;
            color: var(--color-accent);
            margin-bottom: var(--spacing-sm);
            line-height: 1.2;
        }

        .hero-title {
            font-size: 3.5rem;
            margin-bottom: var(--spacing-md);
            line-height: 1.2;
        }

        .hero-title span {
            color: var(--color-accent);
        }

        .hero-description {
            font-size: 1.25rem;
            margin-bottom: var(--spacing-lg);
            color: var(--color-text-light);
        }

        .hero-cta {
            display: flex;
            gap: var(--spacing-md);
        }

        .hero-image {
            flex: 1;
            max-width: 500px;
            position: relative;
        }

        .hero-image img {
            width: 100%;
            height: auto;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-xl);
        }

        .hero-image::before {
            content: '';
            position: absolute;
            top: -20px;
            right: -20px;
            width: 100%;
            height: 100%;
            border: 3px solid var(--color-accent-light);
            border-radius: var(--radius-lg);
            z-index: -1;
        }

        .hero-badge {
            position: absolute;
            bottom: -20px;
            left: -20px;
            background-color: var(--color-white);
            box-shadow: var(--shadow-lg);
            border-radius: var(--radius-full);
            padding: var(--spacing-sm) var(--spacing-md);
            font-weight: 600;
            color: var(--color-accent);
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
        }

        .hero-badge svg {
            width: 20px;
            height: 20px;
        }

                .lashbook {
            background-color: var(--color-white);
            position: relative;
        }

        .lashbook::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%23FFE9F5' fill-opacity='0.5' fill-rule='evenodd'/%3E%3C/svg%3E");
            opacity: 0.5;
            z-index: 0;
        }

        .lashbook-filters {
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-xl);
            justify-content: center;
            position: relative;
            z-index: 1;
        }

        .filter-btn {
            background-color: transparent;
            border: 2px solid var(--color-accent);
            color: var(--color-text);
            padding: 0.5rem 1.25rem;
            border-radius: var(--radius-full);
            transition: all var(--transition-fast);
            font-size: 0.875rem;
            font-weight: 600;
        }

        .filter-btn:hover,
        .filter-btn.active {
            background-color: var(--color-accent);
            color: var(--color-white);
        }

        .lashbook-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: var(--spacing-lg);
            position: relative;
            z-index: 1;
        }

        .lashbook-item {
            position: relative;
            border-radius: var(--radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow-md);
            cursor: pointer;
            transition: all var(--transition-normal);
            aspect-ratio: 3/4;
        }

        .lashbook-item:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .lashbook-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform var(--transition-slow);
            user-select: none;
            -webkit-user-drag: none;
        }

        .lashbook-item:hover .lashbook-img {
            transform: scale(1.05);
        }

        .lashbook-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            padding: var(--spacing-lg);
            background: linear-gradient(to top, rgba(0, 0, 0, 0.8), transparent);
            color: var(--color-white);
            transition: opacity var(--transition-normal);
        }

        .lashbook-title {
            font-family: var(--font-title);
            font-size: 1.25rem;
            margin-bottom: var(--spacing-xs);
        }

        .lashbook-category {
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            opacity: 0.8;
        }

                .modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            z-index: var(--z-modal);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: opacity var(--transition-normal), visibility var(--transition-normal);
        }

        .modal-backdrop.active {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background-color: var(--color-white);
            border-radius: var(--radius-lg);
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            padding: var(--spacing-xl);
            position: relative;
            box-shadow: var(--shadow-xl);
            transform: scale(0.9);
            opacity: 0;
            transition: transform var(--transition-normal), opacity var(--transition-normal);
        }

        .modal-backdrop.active .modal {
            transform: scale(1);
            opacity: 1;
        }

        .modal-close {
            position: absolute;
            top: var(--spacing-md);
            right: var(--spacing-md);
            background: none;
            border: none;
            font-size: 1.75rem;
            color: var(--color-text);
            cursor: pointer;
            z-index: 10;
            padding: var(--spacing-xs);
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--radius-full);
            transition: all var(--transition-fast);
        }

        .modal-close:hover {
            background-color: var(--color-gray-200);
            color: var(--color-text);
            transform: none;
        }

        .modal-content {
            margin-top: var(--spacing-md);
        }

        .modal-image {
            width: 100%;
            border-radius: var(--radius-md);
            margin-bottom: var(--spacing-md);
        }

        .modal-title {
            font-size: 1.75rem;
            margin-bottom: var(--spacing-xs);
        }

        .modal-category {
            font-size: 0.875rem;
            color: var(--color-text-light);
            margin-bottom: var(--spacing-md);
        }

        .modal-description {
            margin-bottom: var(--spacing-lg);
        }

                .precios {
            background: linear-gradient(135deg, var(--color-primary-light) 0%, var(--color-white) 100%);
            position: relative;
        }

        .precios::after {
            content: '';
            position: absolute;
            bottom: 0;
            right: 0;
            width: 200px;
            height: 200px;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='60' height='60' viewBox='0 0 60 60'%3E%3Cpath d='M29.9,30.8c5.7-5.7,9.5-11.8,9.5-16c0-5.7-5.2-8.4-8.8-8.4c-3.7,0-7.3,2.3-8.8,6.6c-1.5-4.3-5-6.6-8.8-6.6 c-3.7,0-8.8,2.7-8.8,8.4c0,4.2,3.9,10.3,9.5,16c6.1,6.1,12.1,10,12.5,10.2l0.3,0.2l4.1-3.4l4.1-3.4C34.7,34.1,33.3,33.9,29.9,30.8z' fill='%23D279A5' fill-opacity='0.1'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: bottom right;
            z-index: 0;
            opacity: 0.8;
        }

        .precios-grid {
            display: grid;

            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: var(--spacing-lg);

            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: var(--spacing-2xl);

            position: relative;
            z-index: 1;
        }

        .precio-card {
            background-color: var(--color-white);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
            padding: var(--spacing-lg);
            transition: transform var(--transition-normal), box-shadow var(--transition-normal);
            display: flex;
            flex-direction: column;
            height: auto;
            overflow: hidden;
            position: relative;
        }

        .precio-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .precio-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(to right, var(--color-accent), var(--color-gold));
        }

        .precio-image {
            width: 100%;
            height: 150px;
            border-radius: var(--radius-md);
            margin-bottom: var(--spacing-md);
            overflow: hidden;
            position: relative;
        }

        .precio-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform var(--transition-normal);
        }

        .precio-card:hover .precio-image img {
            transform: scale(1.05);
        }

        .precio-image::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, transparent 60%, rgba(0, 0, 0, 0.25));
            z-index: 1;
        }

        .precio-category {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--color-text-light);
            margin-bottom: var(--spacing-xs);
        }

        .precio-title {
            font-size: 1.25rem;
            margin-bottom: var(--spacing-sm);
            font-family: var(--font-title);
        }

        .precio-amount {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--color-accent);
            margin-bottom: var(--spacing-sm);
            display: flex;
            align-items: center;
        }

        .precio-original {
            font-size: 1rem;
            color: var(--color-text-light);
            text-decoration: line-through;
            margin-right: var(--spacing-xs);
        }

        .precio-discount {
            background-color: var(--color-accent);
            color: var(--color-white);
            font-size: 0.75rem;
            padding: 2px 8px;
            border-radius: var(--radius-sm);
            margin-left: var(--spacing-sm);
        }

        .precio-description {
            margin-bottom: var(--spacing-sm);
            flex-grow: 1;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .precio-cta {
            align-self: center;
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-sm);
            justify-content: center;
        }

        .precio-details {
            list-style: none;
            margin-bottom: var(--spacing-md);
        }

        .precio-details li {
            display: flex;
            align-items: flex-start;
            margin-bottom: var(--spacing-xs);
        }

        .precio-details li::before {
            content: "✓";
            color: var(--color-accent);
            margin-right: var(--spacing-sm);
            font-weight: bold;
        }

                .reservar {
            background-color: var(--color-white);
            position: relative;
        }

        .reservar::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%23FFE9F5' fill-opacity='0.5' fill-rule='evenodd'/%3E%3C/svg%3E");
            opacity: 0.5;
            z-index: 0;
        }

        .reservar-container {
            background-color: var(--color-white);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            padding: var(--spacing-xl);
            max-width: 700px;
            margin: 0 auto;
            position: relative;
            overflow: hidden;
            z-index: 1;
        }

        .reservar-container::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 200px;
            height: 200px;
            background-color: var(--color-primary-light);
            border-radius: 0 0 0 100%;
            z-index: 0;
            opacity: 0.5;
        }

        .reservar-container::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 150px;
            height: 150px;
            background-color: var(--color-primary-light);
            border-radius: 0 100% 0 0;
            z-index: 0;
            opacity: 0.5;
        }

        .reservar-form {
            position: relative;
            z-index: 1;
        }

        .form-group {
            margin-bottom: var(--spacing-md);
        }

        .form-row {
            display: flex;
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-md);
        }

        .form-label {
            display: block;
            margin-bottom: var(--spacing-xs);
            font-weight: 500;
        }

        .form-error {
            color: var(--color-error);
            font-size: 0.875rem;
            margin-top: var(--spacing-xs);
        }

      
/* Estilos actualizados para los time slots - solo lo esencial */
#timeSlots.time-slots{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:12px}
.hour-slots{display:flex;flex-direction:column;gap:8px}
.hour-label{font-weight:600;margin-bottom:4px}
.hour-slots-grid{display:grid;grid-template-columns:1fr;gap:8px}

/* Contenedor de horarios */
.time-slots {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
    gap: 10px;
    margin-top: 15px;
}

/* Estilo básico para cada slot de tiempo */
.time-slot {
    background-color: var(--color-white);
    border: 1px solid var(--color-primary-light);
    border-radius: 8px;
    text-align: center;
    cursor: pointer;
    transition: all 0.2s ease;
    padding: 12px 10px;
    font-size: 0.9rem;
    color: var(--color-text);
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
}

/* Hover sobre slot disponible */
.time-slot:hover:not(.disabled) {
    border-color: var(--color-accent);
    transform: translateY(-2px);
    box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);
}

/* Slot seleccionado */
.time-slot.selected {
    background-color: var(--color-accent);
    color: var(--color-white);
    border-color: var(--color-accent);
    font-weight: 500;
    box-shadow: 0 3px 8px rgba(210, 121, 165, 0.3);
}

/* Slot no disponible */
.time-slot.disabled {
    background-color: var(--color-gray-100);
    color: var(--color-gray-400);
    cursor: not-allowed;
    border-color: var(--color-gray-200);
}

/* Título de sección de horarios */
.time-slots-title {
    font-family: var(--font-title);
    font-size: 1.3rem;
    margin-bottom: 15px;
    color: var(--color-text);
    border-bottom: 2px solid var(--color-primary-light);
    padding-bottom: 8px;
}




                .calendar-container {
            width: 100%;
            background-color: var(--color-white);
            border-radius: var(--radius-md);
            overflow: hidden;
            box-shadow: var(--shadow-sm);
            margin-bottom: var(--spacing-md);
        }

        .calendar-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--spacing-md);
            background-color: var(--color-primary-light);
        }

        .calendar-month {
            font-weight: 600;
            font-size: 1.125rem;
            color: var(--color-text);
        }

        .calendar-nav {
            display: flex;
            gap: var(--spacing-xs);
        }

        .calendar-btn {
            background: none;
            border: none;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--radius-full);
            cursor: pointer;
            color: var(--color-text);
            font-size: 1.25rem;
            transition: all var(--transition-fast);
            padding: 0;
        }

        .calendar-btn:hover {
            background-color: rgba(210, 121, 165, 0.2);
            transform: none;
        }

        .calendar-weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            padding: var(--spacing-sm) var(--spacing-md);
            border-bottom: 1px solid var(--color-gray-200);
            background-color: var(--color-gray-100);
        }

        .weekday {
            text-align: center;
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--color-text-light);
            text-transform: uppercase;
        }

        .calendar-days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            padding: var(--spacing-sm);
            gap: 2px;
        }

        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all var(--transition-fast);
            font-size: 0.875rem;
            position: relative;
        }

        .calendar-day:hover:not(.disabled):not(.outside-month) {
            background-color: var(--color-primary-light);
        }

        .calendar-day.selected {
            background-color: var(--color-accent);
            color: var(--color-white);
            font-weight: 600;
        }

        .calendar-day.today {
            border: 1px solid var(--color-accent);
        }

        .calendar-day.disabled {
            color: var(--color-gray-400);
            cursor: not-allowed;
            background-color: var(--color-gray-100);
            position: relative;
            opacity: 0.6;
        }

        .calendar-day.disabled::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 10%;
            right: 10%;
            height: 1px;
            background-color: var(--color-gray-400);
            transform: translateY(-50%);
        }

        .calendar-day.blackout {
            background-color: #ffe6e6;
            color: #d32f2f;
            border: 1px solid #ffcdd2;
        }

        .calendar-day.blackout::before {
            background-color: #d32f2f;
        }

        .calendar-day.closed-day {
            background-color: #f5f5f5;
            color: var(--color-gray-500);
            border: 1px solid #e0e0e0;
        }

        .calendar-day.outside-month {
            color: var(--color-gray-400);
            cursor: default;
        }

        .calendar-day.has-events::after {
            content: '';
            position: absolute;
            bottom: 3px;
            left: 50%;
            transform: translateX(-50%);
            width: 4px;
            height: 4px;
            border-radius: 50%;
            background-color: var(--color-accent);
        }

                .referencias {
            background: linear-gradient(135deg, var(--color-primary-light), var(--color-white));
            position: relative;
        }

        .referencias::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 300px;
            height: 300px;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24'%3E%3Cpath d='M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z' fill='%23D279A5' fill-opacity='0.1'/%3E%3C/svg%3E");
            background-repeat: repeat;
            z-index: 0;
            opacity: 0.5;
        }

        .referencias-slider {
            position: relative;
            border-radius: var(--radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow-lg);
            margin: 0 auto;
            max-width: 800px;
            z-index: 1;
        }

        .slider-container {
            display: flex;
            transition: transform var(--transition-normal);
        }

        .slider-item {
            flex: 0 0 100%;
            position: relative;
        }

        .slider-img {
            width: 100%;
            aspect-ratio: 16/9;
            object-fit: cover;
        }

        .slider-caption {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            padding: var(--spacing-lg);
            background: linear-gradient(to top, rgba(0, 0, 0, 0.8), transparent);
            color: var(--color-white);
        }

        .slider-title {
            font-size: 1.5rem;
            margin-bottom: var(--spacing-xs);
        }

        .slider-description {
            font-size: 0.9375rem;
            opacity: 0.9;
        }

        .slider-nav {
            display: flex;
            justify-content: center;
            margin-top: var(--spacing-md);
            gap: var(--spacing-xs);
            position: relative;
            z-index: 1;
        }

        .slider-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: var(--color-gray-300);
            cursor: pointer;
            transition: background-color var(--transition-fast);
        }

        .slider-dot.active {
            background-color: var(--color-accent);
        }

        .slider-arrows {
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            display: flex;
            justify-content: space-between;
            transform: translateY(-50%);
            z-index: 10;
            padding: 0 var(--spacing-sm);
        }

        .slider-arrow {
            background-color: rgba(255, 255, 255, 0.8);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.25rem;
            color: var(--color-text);
            box-shadow: var(--shadow-md);
            transition: all var(--transition-fast);
        }

        .slider-arrow:hover {
            background-color: var(--color-white);
            box-shadow: var(--shadow-lg);
        }

                .comparison-slider {
            position: relative;
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
            height: 400px;
            border-radius: var(--radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow-lg);
            user-select: none;
        }

        .comparison-before,
        .comparison-after {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .comparison-before {
            clip-path: polygon(0 0, var(--slider-position) 0, var(--slider-position) 100%, 0 100%);
            z-index: 2;
        }

        .comparison-after {
            z-index: 1;
        }

        .comparison-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .comparison-slider-handle {
            position: absolute;
            top: 0;
            left: var(--slider-position);
            width: 4px;
            height: 100%;
            background-color: var(--color-white);
            cursor: ew-resize;
            z-index: 10;
            transform: translateX(-50%);
        }

        .comparison-slider-handle::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.8);
            box-shadow: var(--shadow-md);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color var(--transition-fast);
        }

        .comparison-slider-handle::after {
            content: '◀ ▶';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: var(--color-text);
            font-size: 14px;
            letter-spacing: -3px;
        }

        .comparison-slider-label {
            position: absolute;
            top: 20px;
            color: var(--color-white);
            font-weight: 600;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.7);
            padding: 5px 10px;
            border-radius: var(--radius-sm);
            background-color: rgba(0, 0, 0, 0.5);
        }

        .comparison-before-label {
            left: 20px;
        }

        .comparison-after-label {
            right: 20px;
        }

                .faq {
            background-color: var(--color-white);
        }

        .faq-container {
            max-width: 800px;
            margin: 0 auto;
        }

        .faq-item {
            background-color: var(--color-white);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-sm);
            margin-bottom: var(--spacing-md);
            overflow: hidden;
            transition: box-shadow var(--transition-fast);
        }

        .faq-item:hover {
            box-shadow: var(--shadow-md);
        }

        .faq-question {
            padding: var(--spacing-md) var(--spacing-lg);
            font-weight: 600;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background-color var(--transition-fast);
        }

        .faq-question:hover {
            background-color: rgba(210, 121, 165, 0.1);
        }

        .faq-icon {
            transition: transform var(--transition-fast);
            font-size: 1.25rem;
        }

        .faq-answer {
            padding: 0;
            max-height: 0;
            overflow: hidden;
            transition: all var(--transition-normal);
        }

        .faq-answer-inner {
            padding: 0 var(--spacing-lg) var(--spacing-lg);
        }

        .faq-item.active .faq-question {
            background-color: rgba(210, 121, 165, 0.1);
        }

        .faq-item.active .faq-icon {
            transform: rotate(180deg);
        }

        .faq-item.active .faq-answer {
            max-height: 500px;
        }

                .sobre-mi {
            background: linear-gradient(135deg, var(--color-primary-light), var(--color-white));
        }

        .sobre-mi-container {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-xl);
            max-width: 900px;
            margin: 0 auto;
            background-color: var(--color-white);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            overflow: hidden;
        }

        .sobre-mi-header {
            position: relative;
            height: 150px;
            overflow: hidden;
        }

        .sobre-mi-header-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to right, var(--color-accent), var(--color-secondary));
            z-index: 0;
        }

        .sobre-mi-header-pattern {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('data:image/svg+xml,%3Csvg width="40" height="40" viewBox="0 0 40 40" xmlns="http://www.w3.org/2000/svg"%3E%3Cg fill="%23FFFFFF" fill-opacity="0.1" fill-rule="evenodd"%3E%3Cpath d="M0 40L40 0H20L0 20M40 40V20L20 40"/%3E%3C/g%3E%3C/svg%3E');
            z-index: 1;
        }

        .sobre-mi-profile {
            display: flex;
            margin-top: -75px;
            padding: 0 var(--spacing-xl);
            position: relative;
            z-index: 2;
        }

        .sobre-mi-image {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            border: 5px solid var(--color-white);
            overflow: hidden;
            box-shadow: var(--shadow-md);
        }

        .sobre-mi-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
        }

        .sobre-mi-titles {
            padding: var(--spacing-md) 0 0 var(--spacing-lg);
        }

        .sobre-mi-name {
            font-size: 1.75rem;
            margin-bottom: var(--spacing-xs);
        }

        .sobre-mi-position {
            color: var(--color-accent);
            font-size: 1.125rem;
            font-weight: 500;
        }

        .sobre-mi-content {
            padding: var(--spacing-lg) var(--spacing-xl) var(--spacing-xl);
        }

        .sobre-mi-text {
            margin-bottom: var(--spacing-lg);
        }

        .certificaciones {
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-md);
            margin-top: var(--spacing-lg);
        }

        .certificacion {
            background-color: var(--color-gray-100);
            border-radius: var(--radius-md);
            padding: var(--spacing-md);
            box-shadow: var(--shadow-sm);
            flex: 1 0 calc(50% - var(--spacing-md));
            min-width: 200px;
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            transition: transform var(--transition-fast), box-shadow var(--transition-fast);
        }

        .certificacion:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-md);
        }

        .certificacion-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--color-accent-light), var(--color-accent));
            border-radius: var(--radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            color: var(--color-white);
            font-size: 1.5rem;
        }

        .certificacion-content {
            flex: 1;
        }

        .certificacion-title {
            font-weight: 600;
            font-size: 1.0625rem;
            margin-bottom: 2px;
        }

        .certificacion-fecha {
            font-size: 0.875rem;
            color: var(--color-text-light);
        }

                .resenas {
            background-color: var(--color-white);
            position: relative;
        }

        .resenas::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url("data:image/svg+xml,%3Csvg width='80' height='80' viewBox='0 0 80 80' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23FFE9F5' fill-opacity='0.8'%3E%3Cpath d='M50 50c0-5.523 4.477-10 10-10s10 4.477 10 10-4.477 10-10 10c0 5.523-4.477 10-10 10s-10-4.477-10-10 4.477-10 10-10zM10 10c0-5.523 4.477-10 10-10s10 4.477 10 10-4.477 10-10 10c0 5.523-4.477 10-10 10S0 25.523 0 20s4.477-10 10-10zm10 8c4.418 0 8-3.582 8-8s-3.582-8-8-8-8 3.582-8 8 3.582 8 8 8zm40 40c4.418 0 8-3.582 8-8s-3.582-8-8-8-8 3.582-8 8 3.582 8 8 8z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
            z-index: 0;
            opacity: 0.2;
        }

        .resenas-container {
            max-width: 1000px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        .resenas-stats {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: var(--spacing-xl);
            background-color: var(--color-white);
            border-radius: var(--radius-lg);
            padding: var(--spacing-xl);
            box-shadow: var(--shadow-md);
            position: relative;
            overflow: hidden;
        }

        .resenas-stats::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 150px;
            height: 150px;
            background: linear-gradient(135deg, var(--color-primary-light), transparent);
            border-radius: 0 0 0 100%;
            z-index: 0;
            opacity: 0.7;
        }

        .resenas-promedio {
            font-size: 3.5rem;
            font-weight: 700;
            color: var(--color-accent);
            margin-bottom: var(--spacing-xs);
            position: relative;
            z-index: 1;
        }

        .resenas-stars {
            font-size: 1.75rem;
            color: var(--color-gold);
            margin-bottom: var(--spacing-md);
            position: relative;
            z-index: 1;
        }

        .resenas-count {
            font-size: 0.9375rem;
            color: var(--color-text-light);
            position: relative;
            z-index: 1;
        }

        .resenas-distribution {
            width: 100%;
            margin-top: var(--spacing-md);
            position: relative;
            z-index: 1;
        }

        .rating-bar {
            display: flex;
            align-items: center;
            margin-bottom: var(--spacing-xs);
        }

        .rating-level {
            flex: 0 0 40px;
            text-align: right;
            padding-right: var(--spacing-sm);
            font-size: 0.875rem;
            font-weight: 500;
        }

        .rating-bar-bg {
            flex: 1;
            height: 8px;
            background-color: var(--color-gray-200);
            border-radius: var(--radius-full);
            overflow: hidden;
        }

        .rating-bar-fill {
            height: 100%;
            background: linear-gradient(to right, var(--color-accent-light), var(--color-accent));
            border-radius: var(--radius-full);
        }

        .rating-count {
            flex: 0 0 40px;
            padding-left: var(--spacing-sm);
            font-size: 0.875rem;
            color: var(--color-text-light);
        }

        .resenas-list {
            margin-top: var(--spacing-xl);
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: var(--spacing-lg);
        }

        .resena-item {
            background-color: var(--color-white);
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            box-shadow: var(--shadow-md);
            transition: transform var(--transition-normal), box-shadow var(--transition-normal);
        }

        .resena-item:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .resena-header {
            display: flex;
            align-items: center;
            margin-bottom: var(--spacing-sm);
        }

        .resena-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--color-accent), var(--color-secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--color-white);
            font-weight: 600;
            font-size: 1.25rem;
            margin-right: var(--spacing-sm);
        }

        .resena-info {
            flex: 1;
        }

        .resena-name {
            font-weight: 600;
            margin-bottom: 2px;
        }

        .resena-date {
            font-size: 0.75rem;
            color: var(--color-text-light);
        }

        .resena-stars {
            font-size: 0.9375rem;
            color: var(--color-gold);
            margin-bottom: var(--spacing-sm);
        }

        .resena-content {
            font-size: 0.9375rem;
            line-height: 1.6;
        }

        .add-resena {
            margin-top: var(--spacing-2xl);
            background-color: var(--color-white);
            border-radius: var(--radius-lg);
            padding: var(--spacing-xl);
            box-shadow: var(--shadow-md);
        }

        .rating-input {
            display: flex;
            gap: var(--spacing-xs);
            margin-bottom: var(--spacing-md);
        }

        .rating-btn {
            background: none;
            border: none;
            font-size: 1.75rem;
            color: var(--color-gray-300);
            cursor: pointer;
            transition: color var(--transition-fast);
            padding: 0;
            width: auto;
            height: auto;
            box-shadow: none;
        }

        .rating-btn.active,
        .rating-btn:hover {
            color: var(--color-gold);
            transform: none;
            box-shadow: none;
            background: none;
        }

                .redes {
            background: linear-gradient(135deg, var(--color-primary-light), var(--color-white));
            position: relative;
        }

        .redes::after {
            content: '';
            position: absolute;
            bottom: 0;
            right: 0;
            width: 200px;
            height: 200px;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='80' height='80' viewBox='0 0 80 80'%3E%3Cg fill='%23D279A5' fill-opacity='0.1'%3E%3Cpath d='M20 20c-5.523 0-10-4.477-10-10S14.477 0 20 0s10 4.477 10 10-4.477 10-10 10zm0 60c-5.523 0-10-4.477-10-10s4.477-10 10-10 10 4.477 10 10-4.477 10-10 10zm40-40c-5.523 0-10-4.477-10-10s4.477-10 10-10 10 4.477 10 10-4.477 10-10 10zm0 40c-5.523 0-10-4.477-10-10s4.477-10 10-10 10 4.477 10 10-4.477 10-10 10z'%3E%3C/path%3E%3C/g%3E%3C/svg%3E");
            z-index: 0;
            opacity: 0.5;
        }

        .redes-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: var(--spacing-xl);
            max-width: 800px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        .red-social {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            transition: transform var(--transition-normal);
            width: 180px;
        }

        .red-social:hover {
            transform: translateY(-5px);
        }

        .red-icon {
            width: 70px;
            height: 70px;
            border-radius: var(--radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: var(--spacing-sm);
            transition: all var(--transition-normal);
            box-shadow: var(--shadow-md);
        }

        .red-icon svg {
            width: 35px;
            height: 35px;
            fill: var(--color-white);
        }

        .red-instagram .red-icon {
            background: linear-gradient(45deg, #f09433, #e6683c, #dc2743, #cc2366, #bc1888);
        }

        .red-facebook .red-icon {
            background-color: #1877F2;
        }

        .red-tiktok .red-icon {
            background-color: #000000;
        }

        .red-title {
            font-weight: 600;
            font-size: 1.125rem;
            margin-bottom: 2px;
        }

        .red-username {
            font-size: 0.875rem;
            color: var(--color-text-light);
        }

                .footer {
            background-color: var(--color-text);
            color: var(--color-white);
            padding: var(--spacing-2xl) 0;
            margin-top: var(--spacing-3xl);
            position: relative;
            overflow: hidden;
        }

        .footer::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('data:image/svg+xml,%3Csvg width="60" height="60" viewBox="0 0 60 60" xmlns="http://www.w3.org/2000/svg"%3E%3Cg fill="none" fill-rule="evenodd"%3E%3Cg fill="%23FFFFFF" fill-opacity="0.05"%3E%3Cpath d="M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z"/%3E%3C/g%3E%3C/g%3E%3C/svg%3E');
            opacity: 0.1;
            pointer-events: none;
        }

        .footer-container {
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-xl);
        }

        .footer-col {
            flex: 1;
            min-width: 250px;
        }

        .footer-logo {
            font-family: var(--font-cursive);
            font-size: 2rem;
            font-weight: 400;
            margin-bottom: var(--spacing-sm);
            color: var(--color-white);
        }

        .footer-logo span {
            color: var(--color-accent-light);
        }

        .footer-contact {
            margin-bottom: var(--spacing-md);
        }

        .contact-item {
            display: flex;
            align-items: center;
            margin-bottom: var(--spacing-sm);
            color: var(--color-gray-300);
        }

        .contact-item a {
            color: var(--color-gray-300);
        }

        .contact-item a:hover {
            color: var(--color-accent-light);
        }

        .contact-icon {
            margin-right: var(--spacing-sm);
        }

        .footer-nav {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-sm);
        }

        .footer-nav-title {
            font-weight: 600;
            margin-bottom: var(--spacing-sm);
            color: var(--color-accent-light);
            font-size: 1.125rem;
        }

        .footer-nav-link {
            color: var(--color-gray-300);
            transition: color var(--transition-fast);
            font-size: 0.9375rem;
        }

        .footer-nav-link:hover {
            color: var(--color-white);
            text-decoration: none;
        }

        .footer-form {
            display: flex;
            margin-bottom: var(--spacing-sm);
        }

        .footer-form input {
            flex: 1;
            border-top-right-radius: 0;
            border-bottom-right-radius: 0;
            border-right: none;
            background-color: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.2);
            color: var(--color-white);
        }

        .footer-form input::placeholder {
            color: var(--color-gray-400);
        }

        .footer-form button {
            border-top-left-radius: 0;
            border-bottom-left-radius: 0;
            padding: var(--spacing-sm) var(--spacing-md);
        }

        .footer-bottom {
            margin-top: var(--spacing-xl);
            padding-top: var(--spacing-md);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            text-align: center;
            font-size: 0.875rem;
            color: var(--color-gray-400);
        }

                .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .modal-container {
            background-color: var(--color-white);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-xl);
            max-width: 90vw;
            max-height: 90vh;
            overflow: hidden;
            position: relative;
            animation: modalSlideIn 0.3s ease-out;
        }

        .modal-large {
            width: 100vw;
            height: 100vh;
            max-width: none;
            max-height: none;
            border-radius: 0;
            display: flex;
            flex-direction: column;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-lg);
            border-bottom: 1px solid var(--color-gray-200);
            background-color: var(--color-gray-50);
        }

        .modal-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin: 0;
            color: var(--color-gray-900);
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--color-gray-500);
            cursor: pointer;
            padding: var(--spacing-xs);
            border-radius: var(--radius-sm);
            transition: all var(--transition-fast);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-close:hover {
            background-color: var(--color-gray-100);
            color: var(--color-gray-700);
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-20px) scale(0.95);
            }

            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

                @media (max-width: 768px) {
            .modal-large {
                width: 100vw;
                height: 100vh;
                border-radius: 0;
            }

            .modal-header {
                padding: var(--spacing-md);
            }

            .modal-title {
                font-size: 1.125rem;
            }

            .admin-panel {
                flex-direction: column;
            }

            .admin-sidebar {
                width: 100%;
                padding: var(--spacing-sm) 0;
            }

            .admin-sidebar-header {
                padding: 0 var(--spacing-md);
                margin-bottom: var(--spacing-sm);
            }

            .admin-menu {
                display: flex;
                overflow-x: auto;
                padding: 0 var(--spacing-sm);
                gap: var(--spacing-xs);
                flex: 0 0 auto;
            }

            .admin-menu-item {
                margin-bottom: 0;
                flex-shrink: 0;
            }

            .admin-menu-link {
                padding: var(--spacing-xs) var(--spacing-sm);
                white-space: nowrap;
                border-radius: var(--radius-sm);
                flex-direction: column;
                align-items: center;
                gap: var(--spacing-xs);
                border-left: none;
                border-bottom: 3px solid transparent;
            }

            .admin-menu-link.active {
                border-bottom-color: var(--color-accent);
            }

            .admin-menu-text {
                font-size: 0.75rem;
            }

            .admin-sidebar-footer {
                margin-top: auto;
                padding: var(--spacing-sm) var(--spacing-md);
                border-top: 1px solid rgba(255, 255, 255, 0.1);
            }

            .admin-content {
                padding: var(--spacing-md);
                flex: 1;
                overflow-y: auto;
                min-height: 0;
            }

            .admin-dashboard {
                grid-template-columns: 1fr;
                gap: var(--spacing-sm);
            }

            .admin-form-row {
                flex-direction: column;
            }

            .admin-table-container {
                overflow-x: auto;
            }
        }

                .admin-login {
            width: 100%;
            max-width: 400px;
            margin: 0;
            background-color: var(--color-white);
            border-radius: 0;
            box-shadow: none;
            padding: var(--spacing-lg);
            position: relative;
            overflow: hidden;
        }

        .admin-login::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 150px;
            height: 150px;
            background-color: var(--color-primary-light);
            border-radius: 0 0 0 100%;
            z-index: 0;
            opacity: 0.5;
        }

        .admin-login-form {
            position: relative;
            z-index: 1;
        }

        .admin-login-title {
            font-size: 1.75rem;
            margin-bottom: var(--spacing-md);
            text-align: center;
        }

        .admin-panel {
            background-color: var(--color-white);
            border-radius: 0;
            box-shadow: none;
            margin-top: 0;
            display: flex;
            flex: 1;
            min-height: 0;
            overflow: hidden;
        }

        .admin-sidebar {
            width: 250px;
            background-color: var(--color-gray-900);
            color: var(--color-white);
            padding: var(--spacing-lg) 0;
            z-index: 10;
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
        }

        .admin-sidebar-header {
            padding: 0 var(--spacing-lg);
            margin-bottom: var(--spacing-lg);
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-shrink: 0;
        }

        .admin-sidebar-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--color-white);
            margin-bottom: 0;
        }

        .admin-sidebar-toggle {
            background-color: transparent;
            border: none;
            color: var(--color-gray-400);
            cursor: pointer;
            padding: 0;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: color var(--transition-fast);
        }

        .admin-sidebar-toggle:hover {
            color: var(--color-white);
            background-color: transparent;
            box-shadow: none;
            transform: none;
        }

        .admin-menu {
            list-style: none;
            padding: 0;
            margin: 0;
            flex: 1;
            overflow-y: auto;
        }

        .admin-menu-item {
            margin-bottom: var(--spacing-xs);
        }

        .admin-menu-link {
            display: flex;
            align-items: center;
            padding: var(--spacing-sm) var(--spacing-lg);
            color: var(--color-gray-400);
            transition: all var(--transition-fast);
            border-left: 3px solid transparent;
            gap: var(--spacing-sm);
        }

        .admin-menu-link:hover {
            color: var(--color-white);
            background-color: rgba(255, 255, 255, 0.05);
            text-decoration: none;
        }

        .admin-menu-link.active {
            color: var(--color-white);
            background-color: rgba(255, 255, 255, 0.05);
            border-left-color: var(--color-accent);
        }

        .admin-menu-icon {
            flex-shrink: 0;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .admin-menu-text {
            flex: 1;
        }

        .admin-sidebar-footer {
            margin-top: auto;
            padding: var(--spacing-md) var(--spacing-lg);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .admin-logout-btn {
            background-color: transparent;
            color: var(--color-gray-400);
            border: 1px solid var(--color-gray-700);
            width: 100%;
            padding: var(--spacing-sm) var(--spacing-md);
            font-size: 0.875rem;
        }

        .admin-logout-btn:hover {
            background-color: rgba(255, 255, 255, 0.05);
            color: var(--color-white);
        }

        .admin-content {
            flex: 1;
            padding: var(--spacing-lg);
            overflow-y: auto;
            background-color: var(--color-gray-100);
            min-height: 0;
        }

        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-lg);
            padding-bottom: var(--spacing-md);
            border-bottom: 1px solid var(--color-gray-200);
        }

        .admin-header-title {
            font-size: 1.5rem;
            margin-bottom: 0;
        }

        .admin-header-actions {
            display: flex;
            gap: var(--spacing-sm);
        }

        .admin-section {
            display: none;
            animation: fadeIn 0.3s forwards;
        }

        .admin-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        .admin-dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-xl);
        }

        .admin-card {
            background-color: var(--color-white);
            border-radius: var(--radius-md);
            padding: var(--spacing-md);
            box-shadow: var(--shadow-sm);
            display: flex;
            flex-direction: column;
        }

        .admin-card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: var(--spacing-sm);
        }

        .admin-card-title {
            font-size: 0.875rem;
            color: var(--color-text-light);
            margin-bottom: 0;
            font-weight: 500;
        }

        .admin-card-icon {
            width: 30px;
            height: 30px;
            border-radius: var(--radius-full);
            background-color: rgba(210, 121, 165, 0.1);
            color: var(--color-accent);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .admin-card-content {
            flex: 1;
        }

        .admin-card-value {
            font-size: 1.75rem;
            font-weight: 700;
            margin-bottom: var(--spacing-xs);
        }

        .admin-card-subtitle {
            font-size: 0.875rem;
            color: var(--color-text-light);
        }

        .admin-card-footer {
            display: flex;
            align-items: center;
            margin-top: var(--spacing-md);
            padding-top: var(--spacing-sm);
            border-top: 1px solid var(--color-gray-200);
            font-size: 0.75rem;
        }

        .admin-card-change {
            display: flex;
            align-items: center;
            gap: 2px;
        }

        .admin-card-change.positive {
            color: var(--color-success);
        }

        .admin-card-change.negative {
            color: var(--color-error);
        }

        .admin-card-period {
            margin-left: auto;
            color: var(--color-text-light);
        }

        .admin-form {
            background-color: var(--color-white);
            border-radius: var(--radius-md);
            padding: var(--spacing-lg);
            box-shadow: var(--shadow-sm);
            margin-bottom: var(--spacing-lg);
        }

        .admin-form-title {
            font-size: 1.125rem;
            margin-bottom: var(--spacing-md);
            padding-bottom: var(--spacing-sm);
            border-bottom: 1px solid var(--color-gray-200);
        }

        .admin-table-container {
            background-color: var(--color-white);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-sm);
            overflow-x: auto;
            margin-bottom: var(--spacing-lg);
        }

        .admin-table {
            width: 100%;
            border-collapse: collapse;
            white-space: nowrap;
        }

        .admin-table th,
        .admin-table td {
            padding: var(--spacing-sm) var(--spacing-md);
            border-bottom: 1px solid var(--color-gray-200);
            text-align: left;
        }

        .admin-table th {
            background-color: var(--color-gray-100);
            font-weight: 600;
            color: var(--color-text);
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .admin-table tbody tr {
            transition: background-color var(--transition-fast);
        }

        .admin-table tbody tr:hover {
            background-color: var(--color-gray-100);
        }

        .admin-table-actions {
            display: flex;
            gap: var(--spacing-xs);
        }

        .admin-action-btn {
            padding: 0.25rem;
            width: 30px;
            height: 30px;
            font-size: 0.9375rem;
        }

        .admin-tabs {
            display: flex;
            overflow-x: auto;
            margin-bottom: var(--spacing-md);
            background-color: var(--color-white);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-sm);
            scrollbar-width: thin;
            -ms-overflow-style: none;
        }

        .admin-tabs::-webkit-scrollbar {
            height: 4px;
        }

        .admin-tabs::-webkit-scrollbar-thumb {
            background-color: var(--color-gray-300);
            border-radius: var(--radius-full);
        }

        .admin-tab {
            padding: var(--spacing-sm) var(--spacing-lg);
            cursor: pointer;
            transition: all var(--transition-fast);
            font-weight: 500;
            color: var(--color-text-light);
            border-bottom: 2px solid transparent;
        }

        .admin-tab:hover {
            color: var(--color-text);
        }

        .admin-tab.active {
            color: var(--color-accent);
            border-bottom-color: var(--color-accent);
        }

        .chart-container {
            height: 300px;
            background-color: var(--color-white);
            border-radius: var(--radius-md);
            padding: var(--spacing-md);
            box-shadow: var(--shadow-sm);
            margin-bottom: var(--spacing-lg);
        }

        .admin-chart-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: var(--spacing-md);
        }

        .admin-chart-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 0;
        }

        .admin-chart-actions {
            display: flex;
            gap: var(--spacing-xs);
        }

                .file-input-container {
            position: relative;
            width: 100%;
            margin-bottom: var(--spacing-md);
        }

        .file-input {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
            z-index: 10;
        }

        .file-input-label {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: var(--spacing-lg);
            border: 2px dashed var(--color-gray-300);
            border-radius: var(--radius-md);
            background-color: var(--color-gray-100);
            transition: all var(--transition-fast);
            text-align: center;
            cursor: pointer;
        }

        .file-input-label:hover {
            border-color: var(--color-accent);
            background-color: rgba(210, 121, 165, 0.05);
        }

        .file-input-icon {
            margin-bottom: var(--spacing-sm);
            color: var(--color-accent);
            font-size: 2rem;
        }

        .file-input-text {
            font-weight: 500;
        }

        .file-input-subtext {
            font-size: 0.875rem;
            color: var(--color-text-light);
            margin-top: var(--spacing-xs);
        }

        .file-preview {
            margin-top: var(--spacing-md);
            border-radius: var(--radius-md);
            overflow: hidden;
            position: relative;
        }

        .file-preview img {
            width: 100%;
            height: auto;
            border-radius: var(--radius-md);
        }

        .file-preview-label {
            display: inline-block;
            padding: var(--spacing-xs) var(--spacing-sm);
            background-color: var(--color-accent);
            color: var(--color-white);
            font-size: 0.75rem;
            border-radius: var(--radius-md);
            position: absolute;
            top: var(--spacing-sm);
            right: var(--spacing-sm);
            z-index: 1;
        }

                @media (max-width: 1100px) {
            :root {
                --header-height: 70px;
            }

            .hero-title {
                font-size: 3rem;
            }

            .hero-container {
                flex-direction: column;
                gap: var(--spacing-xl);
            }

            .hero-content,
            .hero-image {
                max-width: 100%;
            }

            .sobre-mi-container {
                flex-direction: column;
            }
        }

        @media (max-width: 900px) {
            :root {
                --header-height: 70px;
            }

            h1 {
                font-size: 2.5rem;
            }

            h2 {
                font-size: 2rem;
            }

            .nav-toggle {
                display: flex;
            }

            .nav {
                position: fixed;
                top: var(--header-height);
                right: -100%;
                width: 300px;
                max-width: 80%;
                height: calc(100vh - var(--header-height));
                background-color: var(--color-white);
                flex-direction: column;
                align-items: flex-start;
                padding: var(--spacing-lg);
                box-shadow: var(--shadow-lg);
                transition: right var(--transition-normal);
                overflow-y: auto;
                z-index: 90;
            }

            .nav.active {
                right: 0;
            }

            .nav-list {
                flex-direction: column;
                width: 100%;
            }

            .nav-item {
                margin: 0;
                width: 100%;
            }

            .nav-link {
                padding: var(--spacing-sm) 0;
                width: 100%;
                border-bottom: 1px solid var(--color-gray-200);
            }

            .nav-link::after {
                display: none;
            }

            .nav-cta {
                margin: var(--spacing-md) 0 0 0;
                width: 100%;
            }

            .nav-social {
                margin: var(--spacing-md) 0 0 0;
                width: 100%;
                justify-content: center;
            }

            .hero-title {
                font-size: 2.5rem;
            }


        }

        @media (max-width: 600px) {
            :root {
                --section-padding: var(--spacing-xl);
            }

            h1 {
                font-size: 2.25rem;
            }

            h2 {
                font-size: 1.75rem;
            }

            .section {
                padding: var(--spacing-2xl) 0;
            }

            .lashbook-grid {
                grid-template-columns: 1fr;
            }

            .precios-grid {
                grid-template-columns: 1fr;
            }

            .form-row {
                flex-direction: column;
            }

            .tiempo-slots {
                grid-template-columns: repeat(3, 1fr);
            }

            .resenas-list {
                grid-template-columns: 1fr;
            }

            .redes-container {
                gap: var(--spacing-lg);
            }

            .footer-container {
                flex-direction: column;
                gap: var(--spacing-lg);
            }
        }
    </style>
</head>

<body>
        <div class="toast-container" id="toastContainer"></div>

        <header class="header" id="header">
        <div class="container header-container">
            <a href="#" class="logo">
                <div class="logo-icon"></div>
                Pinky <span>Eyelashess</span>
            </a>

            <button class="nav-toggle" id="navToggle" aria-label="Menú de navegación">
                <span></span>
            </button>

            <nav class="nav" id="nav">
                <ul class="nav-list">
                    <li class="nav-item"><a href="#hero" class="nav-link active">Inicio</a></li>
                    <li class="nav-item"><a href="#lashbook" class="nav-link">Galería</a></li>
                    <li class="nav-item"><a href="#precios" class="nav-link">Servicios</a></li>
                    <li class="nav-item"><a href="#reservar" class="nav-link">Reservar</a></li>
                    <li class="nav-item"><a href="#referencias" class="nav-link">Antes/Después</a></li>
                    <li class="nav-item"><a href="#faq" class="nav-link">FAQ</a></li>
                    <li class="nav-item"><a href="#sobre-mi" class="nav-link">Sobre Mí</a></li>
                    <li class="nav-item"><a href="#resenas" class="nav-link">Reseñas</a></li>
                </ul>

                <div class="nav-cta">
                    <a href="#reservar" class="button">Reservar Ahora</a>
                </div>

                <div class="nav-social">
                    <a href="https://www.instagram.com/pinky.eyelashess?igsh=bnkxNHdlMmFrZmxz" class="nav-social-link"
                        target="_blank" rel="noopener" aria-label="Instagram">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                            viewBox="0 0 16 16">
                            <path
                                d="M8 0C5.829 0 5.556.01 4.703.048 3.85.088 3.269.222 2.76.42a3.917 3.917 0 0 0-1.417.923A3.927 3.927 0 0 0 .42 2.76C.222 3.268.087 3.85.048 4.7.01 5.555 0 5.827 0 8.001c0 2.172.01 2.444.048 3.297.04.852.174 1.433.372 1.942.205.526.478.972.923 1.417.444.445.89.719 1.416.923.51.198 1.09.333 1.942.372C5.555 15.99 5.827 16 8 16s2.444-.01 3.298-.048c.851-.04 1.434-.174 1.943-.372a3.916 3.916 0 0 0 1.416-.923c.445-.445.718-.891.923-1.417.197-.509.332-1.09.372-1.942C15.99 10.445 16 10.173 16 8s-.01-2.445-.048-3.299c-.04-.851-.175-1.433-.372-1.941a3.926 3.926 0 0 0-.923-1.417A3.911 3.911 0 0 0 13.24.42c-.51-.198-1.092-.333-1.943-.372C10.443.01 10.172 0 7.998 0h.003zm-.717 1.442h.718c2.136 0 2.389.007 3.232.046.78.035 1.204.166 1.486.275.373.145.64.319.92.599.28.28.453.546.598.92.11.281.24.705.275 1.485.039.843.047 1.096.047 3.231s-.008 2.389-.047 3.232c-.035.78-.166 1.203-.275 1.485a2.47 2.47 0 0 1-.599.919c-.28.28-.546.453-.92.598-.28.11-.704.24-1.485.276-.843.038-1.096.047-3.232.047s-2.39-.009-3.233-.047c-.78-.036-1.203-.166-1.485-.276a2.478 2.478 0 0 1-.92-.598 2.48 2.48 0 0 1-.6-.92c-.109-.281-.24-.705-.275-1.485-.038-.843-.046-1.096-.046-3.233 0-2.136.008-2.388.046-3.231.036-.78.166-1.204.276-1.486.145-.373.319-.64.599-.92.28-.28.546-.453.92-.598.282-.11.705-.24 1.485-.276.738-.034 1.024-.044 2.515-.045v.002zm4.988 1.328a.96.96 0 1 0 0 1.92.96.96 0 0 0 0-1.92zm-4.27 1.122a4.109 4.109 0 1 0 0 8.217 4.109 4.109 0 0 0 0-8.217zm0 1.441a2.667 2.667 0 1 1 0 5.334 2.667 2.667 0 0 1 0-5.334z" />
                        </svg>
                    </a>
                    <a href="https://www.facebook.com/share/14QB1iFBQeC/?mibextid=wwXIfr" class="nav-social-link"
                        target="_blank" rel="noopener" aria-label="Facebook">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                            viewBox="0 0 16 16">
                            <path
                                d="M16 8.049c0-4.446-3.582-8.05-8-8.05C3.58 0-.002 3.603-.002 8.05c0 4.017 2.926 7.347 6.75 7.951v-5.625h-2.03V8.05H6.75V6.275c0-2.017 1.195-3.131 3.022-3.131.876 0 1.791.157 1.791.157v1.98h-1.009c-.993 0-1.303.621-1.303 1.258v1.51h2.218l-.354 2.326H9.25V16c3.824-.604 6.75-3.934 6.75-7.951z" />
                        </svg>
                    </a>
                    <a href="https://www.tiktok.com/@pinky.eyelashess?_t=ZM-8z30a3ktCXG&_r=1" class="nav-social-link"
                        target="_blank" rel="noopener" aria-label="TikTok">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                            viewBox="0 0 16 16">
                            <path
                                d="M9 0h1.98c.144.715.54 1.617 1.235 2.512C12.895 3.389 13.797 4 15 4v2c-1.753 0-3.07-.814-4-1.829V11a5 5 0 1 1-5-5v2a3 3 0 1 0 3 3V0Z" />
                        </svg>
                    </a>
                </div>
            </nav>
        </div>
    </header>

        <section class="hero" id="hero">
        <div class="container hero-container">
            <div class="hero-content">
                <h2 class="hero-subtitle">Mirada que habla</h2>
                <h1 class="hero-title">Extensiones de Pestañas & <span>Diseño de Cejas</span></h1>
                <p class="hero-description">Transforma tu mirada con tratamientos personalizados para realzar tu belleza
                    natural. Especialista en Cejas Y Pestañas.</p>
                <div class="hero-cta">
                    <a href="#reservar" class="button">Reservar Ahora</a>
                    <a href="#precios" class="button button-secondary">Ver Servicios</a>
                </div>
            </div>

            <div class="hero-image">
                <img src="img/ChatGPT Image 23 ago 2025, 03_53_52 a.m..png"
                    alt="Extensiones de pestañas profesionales" width="500" height="375">

                <div class="hero-badge">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                        viewBox="0 0 16 16">
                        <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z" />
                        <path
                            d="M10.97 4.97a.235.235 0 0 0-.02.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-1.071-1.05z" />
                    </svg>
                    Productos premium
                </div>
            </div>
        </div>
    </section>

        <section class="section lashbook" id="lashbook">
        <div class="container">
            <h2 class="section-title">Nuestra Galería</h2>
            <p class="section-subtitle">Descubre nuestros diferentes estilos y técnicas que realzarán tu mirada</p>

            <div class="lashbook-filters">
                <button class="filter-btn active" data-filter="all">Todos</button>
                <button class="filter-btn" data-filter="LASH">Pestañas</button>
                <button class="filter-btn" data-filter="CEJA">Cejas</button>
            </div>

            <div class="lashbook-grid" id="lashbookGrid">
                            </div>
        </div>
    </section>

        <div class="modal-backdrop" id="lashbookModal">
        <div class="modal">
            <button class="modal-close" id="modalClose" aria-label="Cerrar">×</button>
            <div class="modal-content" id="modalContent">
                            </div>
        </div>
    </div>

        <section class="section precios" id="precios">
        <div class="container">
            <h2 class="section-title">Nuestros Servicios</h2>
            <p class="section-subtitle">Descubre nuestros tratamientos exclusivos diseñados para realzar tu belleza
                natural</p>

        <div class="precios-grid" id="preciosGrid">
                            </div>
        </div>
    </section>

    <div class="modal-backdrop" id="serviceModal">
        <div class="modal">
            <button class="modal-close" id="serviceModalClose" aria-label="Cerrar">×</button>
            <div class="modal-content" id="serviceModalContent"></div>
        </div>
    </div>

        <section class="section reservar" id="reservar">
        <div class="container">
            <h2 class="section-title">Reserva tu Cita</h2>
            <p class="section-subtitle">Selecciona el servicio, fecha y horario que prefieras</p>

            <div class="reservar-container">
                <form class="reservar-form" id="reservarForm">
                    <div class="form-group">
                        <label for="servicio">Servicio</label>
                        <select id="servicio" name="servicio" required>
                            <option value="">Selecciona un servicio</option>
                                                    </select>
                    </div>

                    <div class="form-row">
                        <div class="form-group" style="flex: 1;">
                            <label for="nombre">Nombre completo</label>
                            <input type="text" id="nombre" name="nombre" placeholder="Tu nombre" required>
                        </div>

                        <div class="form-group" style="flex: 1;">
                            <label for="telefono">Teléfono</label>
                            <input type="tel" id="telefono" name="telefono" placeholder="+56 9 1234 5678" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Fecha</label>
                        <div class="calendar-container" id="calendar">
                                                    </div>
                    </div>

                    <div class="form-group">
                        <label>Horarios disponibles</label>
                        <div class="time-slots" id="timeSlots">
                                                        <p class="text-center text-light" id="noSlotsMessage" style="display: none; width: 100%;">
                                Selecciona una fecha para ver horarios disponibles</p>
                        </div>
                    </div>

                    <div class="form-group" id="reservaSummary"
                        style="display: none; background-color: var(--color-primary-light); padding: var(--spacing-md); border-radius: var(--radius-md);">
                        <h4 class="mb-2">Resumen de reserva</h4>
                        <p class="mb-1"><strong>Servicio:</strong> <span id="summaryServicio"></span></p>
                        <p class="mb-1"><strong>Fecha:</strong> <span id="summaryFecha"></span></p>
                        <p class="mb-1"><strong>Hora:</strong> <span id="summaryHora"></span></p>
                        <p class="mb-1"><strong>Duración:</strong> <span id="summaryDuracion"></span></p>
                        <p class="mb-0"><strong>Precio:</strong> <span id="summaryPrecio"></span></p>
                    </div>

                    <div class="mt-5 text-center">
                        <button type="submit" class="button button-large" id="btnReservar" disabled>Reservar
                            Ahora</button>
                    </div>
                </form>
            </div>
        </div>
    </section>

        <section class="section referencias" id="referencias">
        <div class="container">
            <h2 class="section-title">Antes y Después</h2>
            <p class="section-subtitle">Transformaciones reales que muestran el impacto de nuestros servicios</p>

                <div class="comparison-slider" id="comparisonSlider" style="--slider-position: 50%">
                <div class="comparison-before">
                    <img src="img/antes.png"
                        alt="Antes del tratamiento" class="comparison-image">
                    <div class="comparison-slider-label comparison-before-label">Antes</div>
                </div>
                <div class="comparison-after">
                    <img src="img/despues.png"
                        alt="Después del tratamiento" class="comparison-image">
                    <div class="comparison-slider-label comparison-after-label">Después</div>
                </div>
                <div class="comparison-slider-handle"></div>
            </div>

            <div class="slider-nav mt-4">
                <div class="slider-dot active" data-index="0"></div>
                <div class="slider-dot" data-index="1"></div>
                <div class="slider-dot" data-index="2"></div>
            </div>
        </div>
    </section>

        <section class="section faq" id="faq">
        <div class="container">
            <h2 class="section-title">Preguntas Frecuentes</h2>
            <p class="section-subtitle">Respuestas a las dudas más comunes sobre nuestros servicios</p>

            <div class="faq-container">
                <div class="faq-item">
                    <div class="faq-question">
                        ¿Cuánto duran las extensiones de pestañas?
                        <span class="faq-icon">▼</span>
                    </div>
                    <div class="faq-answer">
                        <div class="faq-answer-inner">
                            Según el efecto y el cuidado, las extensiones pueden durar de 3 a 5 semanas. Recomendamos un
                            retoque cada 2–3 semanas para mantener un aspecto perfecto. La duración depende de tu ciclo
                            natural de crecimiento de pestañas y de los cuidados que les brindes.
                        </div>
                    </div>
                </div>

                <div class="faq-item">
                    <div class="faq-question">
                        ¿Cada cuánto se hace el retoque?
                        <span class="faq-icon">▼</span>
                    </div>
                    <div class="faq-answer">
                        <div class="faq-answer-inner">
                            El retoque ideal se realiza entre las semanas 2 y 3 para mantener el volumen, forma y
                            simetría de tus pestañas. Esperar más tiempo puede requerir una aplicación completa nueva,
                            ya que muchas pestañas naturales con extensiones habrán caído en su ciclo normal.
                        </div>
                    </div>
                </div>

                <div class="faq-item">
                    <div class="faq-question">
                        ¿Cómo cuidarlas las primeras 24h?
                        <span class="faq-icon">▼</span>
                    </div>
                    <div class="faq-answer">
                        <div class="faq-answer-inner">
                            <p>Durante las primeras 24 horas es crucial:</p>
                            <ul>
                                <li>Evitar mojar las pestañas completamente</li>
                                <li>No exponerlas al vapor (duchas muy calientes, saunas)</li>
                                <li>Evitar productos con aceites cerca de los ojos</li>
                                <li>No frotar ni tirar de las pestañas</li>
                                <li>Dormir preferiblemente boca arriba</li>
                                <li>Cepillarlas suavemente sólo a partir del día siguiente</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="faq-item">
                    <div class="faq-question">
                        ¿Puedo usar máscara de pestañas?
                        <span class="faq-icon">▼</span>
                    </div>
                    <div class="faq-answer">
                        <div class="faq-answer-inner">
                            Con extensiones de pestañas generalmente no es necesario usar máscara. Si deseas usarla,
                            asegúrate de que sea específicamente formulada para extensiones (libre de aceites) y
                            aplícala sólo en las puntas, nunca en la base donde se encuentra el adhesivo. Para
                            retirarla, usa un desmaquillante libre de aceite.
                        </div>
                    </div>
                </div>

                <div class="faq-item">
                    <div class="faq-question">
                        ¿Existen contraindicaciones?
                        <span class="faq-icon">▼</span>
                    </div>
                    <div class="faq-answer">
                        <div class="faq-answer-inner">
                            <p>Consulta con nosotras antes de agendar si presentas:</p>
                            <ul>
                                <li>Alergias oculares o a adhesivos</li>
                                <li>Infecciones o inflamaciones en los ojos</li>
                                <li>Tratamientos dermatológicos recientes</li>
                                <li>Blefaritis u ojo seco severo</li>
                                <li>Has tenido reacciones adversas a extensiones previamente</li>
                                <li>Estás embarazada (primer trimestre)</li>
                            </ul>
                            <p>Siempre priorizamos tu salud y bienestar.</p>
                        </div>
                    </div>
                </div>

                <div class="faq-item">
                    <div class="faq-question">
                        ¿Qué diferencia hay entre los tipos de volumen?
                        <span class="faq-icon">▼</span>
                    </div>
                    <div class="faq-answer">
                        <div class="faq-answer-inner">
                            <p><strong>Clásico:</strong> Una extensión por pestaña natural. Aspecto natural pero
                                definido.</p>
                            <p><strong>Híbrido:</strong> Combinación de técnica clásica y volumen. Más definición que el
                                clásico pero sin la densidad total del volumen.</p>
                            <p><strong>Volumen 3D/5D:</strong> Múltiples extensiones ultraligeras por cada pestaña
                                natural (3-5). Aporta densidad, volumen y dramátismo.</p>
                            <p><strong>Foxy:</strong> Efecto alargado hacia los extremos, estilizando la mirada como un
                                "cat eye" natural.</p>
                            <p><strong>Doll:</strong> Extensiones más largas en el centro, creando un efecto de ojos de
                                muñeca, más abiertos y redondeados.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

        <section class="section sobre-mi" id="sobre-mi">
        <div class="container">
            <h2 class="section-title">Sobre Mí</h2>
            <p class="section-subtitle">Conoce a la persona detrás de Pinky Eyelashess</p>

            <div class="sobre-mi-container">
                <div class="sobre-mi-header">
                    <div class="sobre-mi-header-bg"></div>
                    <div class="sobre-mi-header-pattern"></div>
                </div>

                <div class="sobre-mi-profile">
                    <div class="sobre-mi-image">
                        <img src="img/perfil.png"
                            alt="Fundadora de Pinky Eyelashess">
                    </div>

                    <div class="sobre-mi-titles">
                        <h3 class="sobre-mi-name">Odalys Noriega</h3>
                        <p class="sobre-mi-position">Creadora de Pinky Eyelashess</p>
                    </div>
                </div>

                <div class="sobre-mi-content">
                    <div class="sobre-mi-text">
                        <p>Llevo más de 3 años dedicada al arte de las pestañas y cejas, siempre trabajando con cariño y
                            dedicación porque sé lo importante que es para cada una de mis Pinkys sentirse bien consigo
                            mismas.</p>
                        <p>Me encanta poder crear pestañas que resalten la mirada y cejas que hagan ver el rostro más
                            armonioso, logrando resultados naturales y que realcen la belleza única de cada persona.</p>
                        <p>En Pinky Eyelashess encontrarás un espacio cálido y cercano, donde lo más importante es que
                            disfrutes la experiencia y te sientas radiante al salir.</p>
                    </div>

                </div>
            </div>
        </div>
    </section>

        <section class="section resenas" id="resenas">
        <div class="container">
            <h2 class="section-title">Reseñas de Clientes</h2>
            <p class="section-subtitle">Descubre lo que nuestras clientas opinan sobre nuestros servicios</p>

            <div class="resenas-container">
                <div class="resenas-stats">
                    <div class="resenas-promedio">4.9</div>
                    <div class="resenas-stars">★★★★★</div>
                    <div class="resenas-count"><span id="totalReviews">0</span> reseñas verificadas</div>

                    <div class="resenas-distribution">
                        <div class="rating-bar">
                            <div class="rating-level">5 ★</div>
                            <div class="rating-bar-bg">
                                <div class="rating-bar-fill" style="width: 92%;"></div>
                            </div>
                            <div class="rating-count" id="rating5Count">0</div>
                        </div>
                        <div class="rating-bar">
                            <div class="rating-level">4 ★</div>
                            <div class="rating-bar-bg">
                                <div class="rating-bar-fill" style="width: 6%;"></div>
                            </div>
                            <div class="rating-count" id="rating4Count">0</div>
                        </div>
                        <div class="rating-bar">
                            <div class="rating-level">3 ★</div>
                            <div class="rating-bar-bg">
                                <div class="rating-bar-fill" style="width: 2%;"></div>
                            </div>
                            <div class="rating-count" id="rating3Count">0</div>
                        </div>
                        <div class="rating-bar">
                            <div class="rating-level">2 ★</div>
                            <div class="rating-bar-bg">
                                <div class="rating-bar-fill" style="width: 0%;"></div>
                            </div>
                            <div class="rating-count" id="rating2Count">0</div>
                        </div>
                        <div class="rating-bar">
                            <div class="rating-level">1 ★</div>
                            <div class="rating-bar-bg">
                                <div class="rating-bar-fill" style="width: 0%;"></div>
                            </div>
                            <div class="rating-count" id="rating1Count">0</div>
                        </div>
                    </div>
                </div>

                <div class="resenas-list" id="resenasGrid">
                                    </div>

                <div class="add-resena">
                    <h3 class="mb-3">Comparte tu experiencia</h3>
                    <form id="reviewForm">
                        <div class="form-group">
                            <label for="reviewName">Nombre</label>
                            <input type="text" id="reviewName" name="reviewName" placeholder="Tu nombre" required>
                        </div>

                        <div class="form-group">
                            <label>Calificación</label>
                            <div class="rating-input">
                                <button type="button" class="rating-btn" data-value="1">★</button>
                                <button type="button" class="rating-btn" data-value="2">★</button>
                                <button type="button" class="rating-btn" data-value="3">★</button>
                                <button type="button" class="rating-btn" data-value="4">★</button>
                                <button type="button" class="rating-btn" data-value="5">★</button>
                                <input type="hidden" id="reviewRating" name="reviewRating" value="0" required>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="reviewComment">Comentario</label>
                            <textarea id="reviewComment" name="reviewComment"
                                placeholder="Cuéntanos tu experiencia (mínimo 20 caracteres)" required
                                minlength="20"></textarea>
                        </div>

                        <button type="submit" class="button">Enviar Reseña</button>
                    </form>
                </div>
            </div>
        </div>
    </section>

        <section class="section redes" id="redes">
        <div class="container">
            <h2 class="section-title">Síguenos en Redes</h2>
            <p class="section-subtitle">Mantente al día con nuestras últimas creaciones y promociones</p>

            <div class="redes-container">
                <a href="https://www.instagram.com/pinky.eyelashess?igsh=bnkxNHdlMmFrZmxz"
                    class="red-social red-instagram" target="_blank" rel="noopener">
                    <div class="red-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor"
                            viewBox="0 0 16 16">
                            <path
                                d="M8 0C5.829 0 5.556.01 4.703.048 3.85.088 3.269.222 2.76.42a3.917 3.917 0 0 0-1.417.923A3.927 3.927 0 0 0 .42 2.76C.222 3.268.087 3.85.048 4.7.01 5.555 0 5.827 0 8.001c0 2.172.01 2.444.048 3.297.04.852.174 1.433.372 1.942.205.526.478.972.923 1.417.444.445.89.719 1.416.923.51.198 1.09.333 1.942.372C5.555 15.99 5.827 16 8 16s2.444-.01 3.298-.048c.851-.04 1.434-.174 1.943-.372a3.916 3.916 0 0 0 1.416-.923c.445-.445.718-.891.923-1.417.197-.509.332-1.09.372-1.942C15.99 10.445 16 10.173 16 8s-.01-2.445-.048-3.299c-.04-.851-.175-1.433-.372-1.941a3.926 3.926 0 0 0-.923-1.417A3.911 3.911 0 0 0 13.24.42c-.51-.198-1.092-.333-1.943-.372C10.443.01 10.172 0 7.998 0h.003zm-.717 1.442h.718c2.136 0 2.389.007 3.232.046.78.035 1.204.166 1.486.275.373.145.64.319.92.599.28.28.453.546.598.92.11.281.24.705.275 1.485.039.843.047 1.096.047 3.231s-.008 2.389-.047 3.232c-.035.78-.166 1.203-.275 1.485a2.47 2.47 0 0 1-.599.919c-.28.28-.546.453-.92.598-.28.11-.704.24-1.485.276-.843.038-1.096.047-3.232.047s-2.39-.009-3.233-.047c-.78-.036-1.203-.166-1.485-.276a2.478 2.478 0 0 1-.92-.598 2.48 2.48 0 0 1-.6-.92c-.109-.281-.24-.705-.275-1.485-.038-.843-.046-1.096-.046-3.233 0-2.136.008-2.388.046-3.231.036-.78.166-1.204.276-1.486.145-.373.319-.64.599-.92.28-.28.546-.453.92-.598.282-.11.705-.24 1.485-.276.738-.034 1.024-.044 2.515-.045v.002zm4.988 1.328a.96.96 0 1 0 0 1.92.96.96 0 0 0 0-1.92zm-4.27 1.122a4.109 4.109 0 1 0 0 8.217 4.109 4.109 0 0 0 0-8.217zm0 1.441a2.667 2.667 0 1 1 0 5.334 2.667 2.667 0 0 1 0-5.334z" />
                        </svg>
                    </div>
                    <h3 class="red-title">Instagram</h3>
                    <p class="red-username">@pinky.eyelashess</p>
                </a>

                <a href="https://www.facebook.com/share/14QB1iFBQeC/?mibextid=wwXIfr" class="red-social red-facebook"
                    target="_blank" rel="noopener">
                    <div class="red-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor"
                            viewBox="0 0 16 16">
                            <path
                                d="M16 8.049c0-4.446-3.582-8.05-8-8.05C3.58 0-.002 3.603-.002 8.05c0 4.017 2.926 7.347 6.75 7.951v-5.625h-2.03V8.05H6.75V6.275c0-2.017 1.195-3.131 3.022-3.131.876 0 1.791.157 1.791.157v1.98h-1.009c-.993 0-1.303.621-1.303 1.258v1.51h2.218l-.354 2.326H9.25V16c3.824-.604 6.75-3.934 6.75-7.951z" />
                        </svg>
                    </div>
                    <h3 class="red-title">Facebook</h3>
                    <p class="red-username">Pinky Eyelashess</p>
                </a>

                <a href="https://www.tiktok.com/@pinky.eyelashess?_t=ZM-8z30a3ktCXG&_r=1" class="red-social red-tiktok"
                    target="_blank" rel="noopener">
                    <div class="red-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor"
                            viewBox="0 0 16 16">
                            <path
                                d="M9 0h1.98c.144.715.54 1.617 1.235 2.512C12.895 3.389 13.797 4 15 4v2c-1.753 0-3.07-.814-4-1.829V11a5 5 0 1 1-5-5v2a3 3 0 1 0 3 3V0Z" />
                        </svg>
                    </div>
                    <h3 class="red-title">TikTok</h3>
                    <p class="red-username">@pinky.eyelashess</p>
                </a>
            </div>
        </div>
    </section>

        <footer class="footer">
        <div class="container">
            <div class="footer-container">
                <div class="footer-col">
                    <div class="footer-logo">Pinky <span>Eyelashess</span></div>
                    <div class="footer-contact">
                        <div class="contact-item">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                class="contact-icon" viewBox="0 0 16 16">
                                <path
                                    d="M3.654 1.328a.678.678 0 0 0-1.015-.063L1.605 2.3c-.483.484-.661 1.169-.45 1.77a17.568 17.568 0 0 0 4.168 6.608 17.569 17.569 0 0 0 6.608 4.168c.601.211 1.286.033 1.77-.45l1.034-1.034a.678.678 0 0 0-.063-1.015l-2.307-1.794a.678.678 0 0 0-.58-.122l-2.19.547a1.745 1.745 0 0 1-1.657-.459L5.482 8.062a1.745 1.745 0 0 1-.46-1.657l.548-2.19a.678.678 0 0 0-.122-.58L3.654 1.328zM1.884.511a1.745 1.745 0 0 1 2.612.163L6.29 2.98c.329.423.445.974.315 1.494l-.547 2.19a.678.678 0 0 0 .178.643l2.457 2.457a.678.678 0 0 0 .644.178l2.189-.547a1.745 1.745 0 0 1 1.494.315l2.306 1.794c.829.645.905 1.87.163 2.611l-1.034 1.034c-.74.74-1.846 1.065-2.877.702a18.634 18.634 0 0 1-7.01-4.42 18.634 18.634 0 0 1-4.42-7.009c-.362-1.03-.037-2.137.703-2.877L1.885.511z" />
                            </svg>
                            <a href="tel:+56936486082">+56 9 3648 6082</a>
                        </div>
                        <div class="contact-item">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                class="contact-icon" viewBox="0 0 16 16">
                                <path
                                    d="M.05 3.555A2 2 0 0 1 2 2h12a2 2 0 0 1 1.95 1.555L8 8.414.05 3.555ZM0 4.697v7.104l5.803-3.558L0 4.697ZM6.761 8.83l-6.57 4.027A2 2 0 0 0 2 14h12a2 2 0 0 0 1.808-1.144l-6.57-4.027L8 9.586l-1.239-.757Zm3.436-.586L16 11.801V4.697l-5.803 3.546Z" />
                            </svg>
                            <a href="mailto:contacto@pinkyeyelashess.com">contacto@pinkyeyelashess.com</a>
                        </div>
                        <div class="contact-item">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                class="contact-icon" viewBox="0 0 16 16">
                                <path
                                    d="M8 16s6-5.686 6-10A6 6 0 0 0 2 6c0 4.314 6 10 6 10zm0-7a3 3 0 1 1 0-6 3 3 0 0 1 0 6z" />
                            </svg>
                            Cerro Navia, Santiago de Chile
                        </div>
                    </div>
                </div>

                <div class="footer-col">
                    <h3 class="footer-nav-title">Enlaces Rápidos</h3>
                    <div class="footer-nav">
                        <a href="#hero" class="footer-nav-link">Inicio</a>
                        <a href="#lashbook" class="footer-nav-link">Galería</a>
                        <a href="#precios" class="footer-nav-link">Servicios</a>
                        <a href="#reservar" class="footer-nav-link">Reservar</a>
                        <a href="#referencias" class="footer-nav-link">Antes/Después</a>
                        <a href="#faq" class="footer-nav-link">FAQ</a>


                    </div>
                </div>

                <div class="footer-col">
                    <h3 class="footer-nav-title">Servicios</h3>
                    <div class="footer-nav">
                        <a href="#precios" class="footer-nav-link">Pestañas Clásicas</a>
                        <a href="#precios" class="footer-nav-link">Pestañas Híbridas</a>
                        <a href="#precios" class="footer-nav-link">Volumen 3D/5D</a>
                        <a href="#precios" class="footer-nav-link">Efecto Foxy</a>
                        <a href="#precios" class="footer-nav-link">Efecto Doll</a>
                        <a href="#precios" class="footer-nav-link">Diseño y Laminado de Cejas</a>
                    </div>
                </div>

                <div class="footer-col">
                    <h3 class="footer-nav-title">Suscríbete</h3>
                    <p>Recibe nuestras novedades y promociones exclusivas.</p>
                    <div class="footer-form">
                        <input type="email" placeholder="Tu email">
                        <button type="button" class="button">Suscribir</button>
                    </div>
                    <div class="footer-nav">
                        <a href="#" class="footer-nav-link">Términos y Condiciones</a>
                        <a href="#" class="footer-nav-link">Política de Privacidad</a>
                    </div>
                </div>
            </div>

            <div class="footer-bottom">
                <p>&copy; 2025 Pinky Eyelashess. Todos los derechos reservados.</p>
                <button id="adminAccessBtn"
                    style="background: none; border: none; color: #888; font-size: 0.8rem; cursor: pointer; opacity: 0.7; transition: all 0.3s; padding: 5px 10px; border-radius: 4px;"
                    onmouseover="this.style.opacity='1'; this.style.backgroundColor='rgba(0,0,0,0.1)'"
                    onmouseout="this.style.opacity='0.7'; this.style.backgroundColor='transparent'"
                    title="Acceso al panel administrativo">⚙️ Admin</button>
            </div>
        </div>
    </footer>

        <div class="modal-overlay" id="adminLoginModal" style="display: none;">
        <div class="modal-container">
            <div class="admin-login" id="adminLogin">
                <div class="modal-header">
                    <h2 class="admin-login-title">Panel Administrativo</h2>
                    <button class="modal-close" id="closeAdminLoginModal">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor"
                            viewBox="0 0 16 16">
                            <path
                                d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z" />
                        </svg>
                    </button>
                </div>
                <form class="admin-login-form" id="adminLoginForm">
                    <div class="form-group">
                        <label for="adminPassword">Contraseña</label>
                        <input type="password" id="adminPassword" placeholder="Ingresa la contraseña de administrador"
                            required>
                    </div>
                    <div class="mt-4 text-center">
                        <button type="submit" class="button">Acceder</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

        <div class="modal-overlay" id="adminPanelModal" style="display: none;">
        <div class="modal-container modal-large">
            <div class="modal-header">
                <h3 class="modal-title">Panel Administrativo</h3>
                <button class="modal-close" id="closeAdminPanelModal">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor"
                        viewBox="0 0 16 16">
                        <path
                            d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z" />
                    </svg>
                </button>
            </div>
            <div class="admin-panel" id="adminPanel">
                <div class="admin-sidebar">
                    <div class="admin-sidebar-header">
                        <h3 class="admin-sidebar-title">Pinky Admin</h3>
                        <button class="admin-sidebar-toggle" id="adminSidebarToggle">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                viewBox="0 0 16 16">
                                <path fill-rule="evenodd"
                                    d="M2.5 12a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5z" />
                            </svg>
                        </button>
                    </div>

                    <ul class="admin-menu">
                        <li class="admin-menu-item">
                            <a href="#" class="admin-menu-link active" data-section="dashboard">
                                <div class="admin-menu-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                        viewBox="0 0 16 16">
                                        <path
                                            d="M8 4a.5.5 0 0 1 .5.5V6a.5.5 0 0 1-1 0V4.5A.5.5 0 0 1 8 4zM3.732 5.732a.5.5 0 0 1 .707 0l.915.914a.5.5 0 1 1-.708.708l-.914-.915a.5.5 0 0 1 0-.707zM2 10a.5.5 0 0 1 .5-.5h1.586a.5.5 0 0 1 0 1H2.5A.5.5 0 0 1 2 10zm9.5 0a.5.5 0 0 1 .5-.5h1.5a.5.5 0 0 1 0 1H12a.5.5 0 0 1-.5-.5zm.754-4.246a.389.389 0 0 0-.527-.02L7.547 9.31a.91.91 0 1 0 1.302 1.258l3.434-4.297a.389.389 0 0 0-.029-.518z" />
                                        <path fill-rule="evenodd"
                                            d="M0 10a8 8 0 1 1 15.547 2.661c-.442 1.253-1.845 1.602-2.932 1.25C11.309 13.488 9.475 13 8 13c-1.474 0-3.31.488-4.615.911-1.087.352-2.49.003-2.932-1.25A7.988 7.988 0 0 1 0 10zm8-7a7 7 0 0 0-6.603 9.329c.203.575.923.876 1.68.63C4.397 12.533 6.358 12 8 12s3.604.532 4.923.96c.757.245 1.477-.056 1.68-.631A7 7 0 0 0 8 3z" />
                                    </svg>
                                </div>
                                <span class="admin-menu-text">Dashboard</span>
                            </a>
                        </li>
                        <li class="admin-menu-item">
                            <a href="#" class="admin-menu-link" data-section="reservas">
                                <div class="admin-menu-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                        viewBox="0 0 16 16">
                                        <path
                                            d="M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5zM1 4v10a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V4H1z" />
                                        <path
                                            d="M11 6.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zm-3 0a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zm-5 3a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zm3 0a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1z" />
                                    </svg>
                                </div>
                                <span class="admin-menu-text">Reservas</span>
                            </a>
                        </li>
                        <li class="admin-menu-item">
                            <a href="#" class="admin-menu-link" data-section="servicios">
                                <div class="admin-menu-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                        viewBox="0 0 16 16">
                                        <path
                                            d="M7 7V1.414a1 1 0 0 1 2 0V2h5a1 1 0 0 1 .8.4l.975 1.3a.5.5 0 0 1 0 .6L14.8 5.6a1 1 0 0 1-.8.4H9v10H7v-5H2a1 1 0 0 1-.8-.4L.225 9.3a.5.5 0 0 1 0-.6L1.2 7.4A1 1 0 0 1 2 7h5zm1 3V8H2l-.75 1L2 10h6zm0-5h6l.75-1L14 3H8v2z" />
                                    </svg>
                                </div>
                                <span class="admin-menu-text">Servicios</span>
                            </a>
                        </li>
                        <li class="admin-menu-item">
                            <a href="#" class="admin-menu-link" data-section="galeria">
                                <div class="admin-menu-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                        viewBox="0 0 16 16">
                                        <path d="M6.002 5.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0z" />
                                        <path
                                            d="M2.002 1a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2h-12zm12 1a1 1 0 0 1 1 1v6.5l-3.777-1.947a.5.5 0 0 0-.577.093l-3.71 3.71-2.66-1.772a.5.5 0 0 0-.63.062L1.002 12V3a1 1 0 0 1 1-1h12z" />
                                    </svg>
                                </div>
                                <span class="admin-menu-text">Galería</span>
                            </a>
                        </li>
                        <li class="admin-menu-item">
                            <a href="#" class="admin-menu-link" data-section="resenas">
                                <div class="admin-menu-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                        viewBox="0 0 16 16">
                                        <path
                                            d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z" />
                                    </svg>
                                </div>
                                <span class="admin-menu-text">Reseñas</span>
                            </a>
                        </li>
                        <li class="admin-menu-item">
                            <a href="#" class="admin-menu-link" data-section="disponibilidad">
                                <div class="admin-menu-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                        viewBox="0 0 16 16">
                                        <path
                                            d="M8.5 5.5a.5.5 0 0 0-1 0v3.362l-1.429 2.38a.5.5 0 1 0 .858.515l1.5-2.5A.5.5 0 0 0 8.5 9V5.5z" />
                                        <path
                                            d="M6.5 0a.5.5 0 0 0 0 1H7v1.07a7.001 7.001 0 0 0-3.273 12.474l-.602.602a.5.5 0 0 0 .707.708l.746-.746A6.97 6.97 0 0 0 8 16a6.97 6.97 0 0 0 3.422-.892l.746.746a.5.5 0 0 0 .707-.708l-.601-.602A7.001 7.001 0 0 0 9 2.07V1h.5a.5.5 0 0 0 0-1h-3zm1.038 3.018a6.093 6.093 0 0 1 .924 0 6 6 0 1 1-.924 0zM10 5.139a.5.5 0 0 0-.854-.354L8 6.214V3.5a.5.5 0 0 0-1 0v2.714L5.854 4.786a.5.5 0 1 0-.708.708l1.5 1.5a.5.5 0 0 0 .708 0l1.5-1.5a.5.5 0 0 0 .146-.354z" />
                                    </svg>
                                </div>
                                <span class="admin-menu-text">Disponibilidad</span>
                            </a>
                        </li>
                        <li class="admin-menu-item">
                            <a href="#" class="admin-menu-link" data-section="descuentos">
                                <div class="admin-menu-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                        viewBox="0 0 16 16">
                                        <path
                                            d="M11.534 7h3.932a.25.25 0 0 1 .192.41l-1.966 2.36a.25.25 0 0 1-.384 0l-1.966-2.36a.25.25 0 0 1 .192-.41zm-11 2h3.932a.25.25 0 0 0 .192-.41L2.692 6.23a.25.25 0 0 0-.384 0L.342 8.59A.25.25 0 0 0 .534 9z" />
                                        <path fill-rule="evenodd"
                                            d="M8 3c-1.552 0-2.94.707-3.857 1.818a.5.5 0 1 1-.771-.636A6.002 6.002 0 0 1 13.917 7H12.9A5.002 5.002 0 0 0 8 3zM3.1 9a5.002 5.002 0 0 0 8.757 2.182.5.5 0 1 1 .771.636A6.002 6.002 0 0 1 2.083 9H3.1z" />
                                    </svg>
                                </div>
                                <span class="admin-menu-text">Descuentos</span>
                            </a>
                        </li>
                        <li class="admin-menu-item">
                            <a href="#" class="admin-menu-link" data-section="metricas">
                                <div class="admin-menu-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                        viewBox="0 0 16 16">
                                        <path
                                            d="M16 8s-3-5.5-8-5.5S0 8 0 8s3 5.5 8 5.5S16 8 16 8zM1.173 8a13.133 13.133 0 0 1 1.66-2.043C4.12 4.668 5.88 3.5 8 3.5c2.12 0 3.879 1.168 5.168 2.457A13.133 13.133 0 0 1 14.828 8c-.058.087-.122.183-.195.288-.335.48-.83 1.12-1.465 1.755C11.879 11.332 10.119 12.5 8 12.5c-2.12 0-3.879-1.168-5.168-2.457A13.134 13.134 0 0 1 1.172 8z" />
                                        <path
                                            d="M8 5.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5zM4.5 8a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0z" />
                                    </svg>
                                </div>
                                <span class="admin-menu-text">Métricas</span>
                            </a>
                        </li>
                    </ul>

                    <div class="admin-sidebar-footer">
                        <button class="admin-logout-btn" id="adminLogout">Cerrar Sesión</button>
                    </div>
                </div>

                <div class="admin-content">
                                        <div class="admin-section active" id="adminDashboard">
                        <div class="admin-header">
                            <h2 class="admin-header-title">Dashboard</h2>
                            <div class="admin-header-actions">
                                <button class="button button-small" id="refreshDashboard">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                        viewBox="0 0 16 16">
                                        <path fill-rule="evenodd"
                                            d="M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2v1z" />
                                        <path
                                            d="M8 4.466V.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384L8.41 4.658A.25.25 0 0 1 8 4.466z" />
                                    </svg>
                                    Actualizar
                                </button>
                            </div>
                        </div>

                        <div class="admin-dashboard">
                            <div class="admin-card">
                                <div class="admin-card-header">
                                    <h3 class="admin-card-title">Reservas Mensuales</h3>
                                    <div class="admin-card-icon">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                            fill="currentColor" viewBox="0 0 16 16">
                                            <path
                                                d="M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5zM1 4v10a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V4H1z" />
                                        </svg>
                                    </div>
                                </div>
                                <div class="admin-card-content">
                                    <div class="admin-card-value" id="reservasMensuales">0</div>
                                    <div class="admin-card-subtitle">Total de citas este mes</div>
                                </div>
                                <div class="admin-card-footer">
                                    <div class="admin-card-change positive" id="reservasChange">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                            fill="currentColor" viewBox="0 0 16 16">
                                            <path fill-rule="evenodd"
                                                d="M8 12a.5.5 0 0 0 .5-.5V5.707l2.146 2.147a.5.5 0 0 0 .708-.708l-3-3a.5.5 0 0 0-.708 0l-3 3a.5.5 0 1 0 .708.708L7.5 5.707V11.5a.5.5 0 0 0 .5.5z" />
                                        </svg>
                                        <span id="reservasChangePercent">+0%</span>
                                    </div>
                                    <div class="admin-card-period">vs. mes anterior</div>
                                </div>
                            </div>

                            <div class="admin-card">
                                <div class="admin-card-header">
                                    <h3 class="admin-card-title">Ingresos</h3>
                                    <div class="admin-card-icon">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                            fill="currentColor" viewBox="0 0 16 16">
                                            <path
                                                d="M4 10.781c.148 1.667 1.513 2.85 3.591 3.003V15h1.043v-1.216c2.27-.179 3.678-1.438 3.678-3.3 0-1.59-.947-2.51-2.956-3.028l-.722-.187V3.467c1.122.11 1.879.714 2.07 1.616h1.47c-.166-1.6-1.54-2.748-3.54-2.875V1H7.591v1.233c-1.939.23-3.27 1.472-3.27 3.156 0 1.454.966 2.483 2.661 2.917l.61.162v4.031c-1.149-.17-1.94-.8-2.131-1.718H4zm3.391-3.836c-1.043-.263-1.6-.825-1.6-1.616 0-.944.704-1.641 1.8-1.828v3.495l-.2-.05zm1.591 1.872c1.287.323 1.852.859 1.852 1.769 0 1.097-.826 1.828-2.2 1.939V8.73l.348.086z" />
                                        </svg>
                                    </div>
                                </div>
                                <div class="admin-card-content">
                                    <div class="admin-card-value" id="ingresosMensuales">$0</div>
                                    <div class="admin-card-subtitle">Ingresos del mes</div>
                                </div>
                                <div class="admin-card-footer">
                                    <div class="admin-card-change positive" id="ingresosChange">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                            fill="currentColor" viewBox="0 0 16 16">
                                            <path fill-rule="evenodd"
                                                d="M8 12a.5.5 0 0 0 .5-.5V5.707l2.146 2.147a.5.5 0 0 0 .708-.708l-3-3a.5.5 0 0 0-.708 0l-3 3a.5.5 0 1 0 .708.708L7.5 5.707V11.5a.5.5 0 0 0 .5.5z" />
                                        </svg>
                                        <span id="ingresosChangePercent">+0%</span>
                                    </div>
                                    <div class="admin-card-period">vs. mes anterior</div>
                                </div>
                            </div>

                            <div class="admin-card">
                                <div class="admin-card-header">
                                    <h3 class="admin-card-title">Servicios Populares</h3>
                                    <div class="admin-card-icon">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                            fill="currentColor" viewBox="0 0 16 16">
                                            <path
                                                d="M7 7V1.414a1 1 0 0 1 2 0V2h5a1 1 0 0 1 .8.4l.975 1.3a.5.5 0 0 1 0 .6L14.8 5.6a1 1 0 0 1-.8.4H9v10H7v-5H2a1 1 0 0 1-.8-.4L.225 9.3a.5.5 0 0 1 0-.6L1.2 7.4A1 1 0 0 1 2 7h5zm1 3V8H2l-.75 1L2 10h6zm0-5h6l.75-1L14 3H8v2z" />
                                        </svg>
                                    </div>
                                </div>
                                <div class="admin-card-content">
                                    <div class="admin-card-value" id="servicioPopular">-</div>
                                    <div class="admin-card-subtitle">Servicio más solicitado</div>
                                </div>
                                <div class="admin-card-footer">
                                    <div class="admin-card-change">
                                        <span id="servicioPopularPercent">0% del total</span>
                                    </div>
                                    <div class="admin-card-period">este mes</div>
                                </div>
                            </div>

                            <div class="admin-card">
                                <div class="admin-card-header">
                                    <h3 class="admin-card-title">Reseñas Pendientes</h3>
                                    <div class="admin-card-icon">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                            fill="currentColor" viewBox="0 0 16 16">
                                            <path
                                                d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z" />
                                        </svg>
                                    </div>
                                </div>
                                <div class="admin-card-content">
                                    <div class="admin-card-value" id="resenasPendientes">0</div>
                                    <div class="admin-card-subtitle">Esperando aprobación</div>
                                </div>
                                <div class="admin-card-footer">
                                    <div class="admin-card-change">
                                        <a href="#" class="admin-menu-link" data-section="resenas">Ver reseñas</a>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="admin-chart-header">
                            <h3 class="admin-chart-title">Ingresos por Mes</h3>
                            <div class="admin-chart-actions">
                                <button class="button button-small" id="downloadChartIngresos">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                        viewBox="0 0 16 16">
                                        <path
                                            d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z" />
                                        <path
                                            d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3z" />
                                    </svg>
                                    Exportar
                                </button>
                            </div>
                        </div>
                        <div class="chart-container">
                            <canvas id="chartIngresos"></canvas>
                        </div>

                        <div class="admin-chart-header">
                            <h3 class="admin-chart-title">Servicios por Popularidad</h3>
                        </div>
                        <div class="chart-container">
                            <canvas id="chartServicios"></canvas>
                        </div>
                    </div>

                                        <div class="admin-section" id="adminReservas">
                        <div class="admin-header">
                            <h2 class="admin-header-title">Reservas</h2>
                            <div class="admin-header-actions">
                                <button class="button button-small" id="exportReservas">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                        viewBox="0 0 16 16">
                                        <path
                                            d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z" />
                                        <path
                                            d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3z" />
                                    </svg>
                                    Exportar CSV
                                </button>
                                <button class="button button-small" id="refreshReservas">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                        viewBox="0 0 16 16">
                                        <path fill-rule="evenodd"
                                            d="M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2v1z" />
                                        <path
                                            d="M8 4.466V.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384L8.41 4.658A.25.25 0 0 1 8 4.466z" />
                                    </svg>
                                    Actualizar
                                </button>
                            </div>
                        </div>

                        <div class="admin-tabs">
                            <div class="admin-tab active" data-status="all">Todas</div>
                            <div class="admin-tab" data-status="PENDING">Pendientes</div>
                            <div class="admin-tab" data-status="CONFIRMED">Confirmadas</div>
                            <div class="admin-tab" data-status="CANCELLED">Canceladas</div>
                        </div>

                        <div class="admin-table-container">
                            <table class="admin-table" id="reservasTable">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Fecha</th>
                                        <th>Hora</th>
                                        <th>Cliente</th>
                                        <th>Teléfono</th>
                                        <th>Servicio</th>
                                        <th>Estado</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                                                    </tbody>
                            </table>
                        </div>
                    </div>

                                        <div class="admin-section" id="adminServicios">
                        <div class="admin-header">
                            <h2 class="admin-header-title">Gestión de Servicios</h2>
                            <div class="admin-header-actions">
                                <button class="button button-small" id="addServicio">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                        viewBox="0 0 16 16">
                                        <path
                                            d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z" />
                                    </svg>
                                    Nuevo Servicio
                                </button>
                            </div>
                        </div>

                        <div class="admin-form" id="servicioForm" style="display: none;">
                            <h3 class="admin-form-title">
                                <span id="servicioFormTitle">Nuevo Servicio</span>
                                <button class="button button-text" style="float: right;"
                                    id="cancelServicioForm">Cancelar</button>
                            </h3>

                            <form id="servicioEditForm">
                                <input type="hidden" id="servicioId" value="">

                                <div class="form-row">
                                    <div class="form-group" style="flex: 2;">
                                        <label for="servicioNombre">Nombre del Servicio</label>
                                        <input type="text" id="servicioNombre" required>
                                    </div>

                                    <div class="form-group" style="flex: 1;">
                                        <label for="servicioCategoria">Categoría</label>
                                        <select id="servicioCategoria" required>
                                            <option value="">Seleccionar</option>
                                            <option value="LASH">Pestañas</option>
                                            <option value="CEJA">Cejas</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="form-row">
                                    <div class="form-group" style="flex: 1;">
                                        <label for="servicioEfecto">Efecto</label>
                                        <input type="text" id="servicioEfecto" placeholder="Ej: Volumen, Híbrido, etc.">
                                    </div>

                                    <div class="form-group" style="flex: 1;">
                                        <label for="servicioMinutos">Duración (minutos)</label>
                                        <input type="number" id="servicioMinutos" min="15" step="15" required>
                                    </div>

                                    <div class="form-group" style="flex: 1;">
                                        <label for="servicioDuracion">Duración resultado (días)</label>
                                        <input type="number" id="servicioDuracion" min="1">
                                    </div>
                                </div>

                                <div class="form-row">
                                    <div class="form-group" style="flex: 1;">
                                        <label for="servicioBasePrecio">Precio Base ($)</label>
                                        <input type="number" id="servicioBasePrecio" min="0" required>
                                    </div>

                                    <div class="form-group" style="flex: 1;">
                                        <label for="servicioRetoquePrecio">Precio Retoque ($)</label>
                                        <input type="number" id="servicioRetoquePrecio" min="0">
                                    </div>

                                    <div class="form-group" style="flex: 1; display: flex; align-items: center;">
                                        <div style="margin-top: 30px;">
                                            <input type="checkbox" id="servicioActivo"
                                                style="width: auto; margin-right: 10px;">
                                            <label for="servicioActivo"
                                                style="display: inline; margin-bottom: 0;">Servicio activo</label>
                                        </div>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label for="servicioDescripcion">Descripción</label>
                                    <textarea id="servicioDescripcion" rows="3"></textarea>
                                </div>

                                <div class="form-group">
                                    <label for="servicioImagen">Imagen del servicio <span
                                            style="color: #e74c3c;">*</span></label>
                                    <small style="color: #666; display: block; margin-bottom: 10px;">Esta imagen se
                                        mostrará a los clientes en la página principal. Es importante para que puedan
                                        ver el resultado del servicio.</small>
                                    <div class="file-input-container">
                                        <input type="file" id="servicioImagen" class="file-input" accept="image/*"
                                            required>
                                        <label for="servicioImagen" class="file-input-label">
                                            <div style="text-align: center;">
                                                <div class="file-input-icon">
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48"
                                                        fill="currentColor" viewBox="0 0 16 16">
                                                        <path d="M6.002 5.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0z" />
                                                        <path
                                                            d="M2.002 1a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2h-12zm12 1a1 1 0 0 1 1 1v6.5l-3.777-1.947a.5.5 0 0 0-.577.093l-3.71 3.71-2.66-1.772a.5.5 0 0 0-.63.062L1.002 12V3a1 1 0 0 1 1-1h12z" />
                                                    </svg>
                                                </div>
                                                <div class="file-input-text">Haz clic para seleccionar imagen</div>
                                                <div class="file-input-subtext">o arrastra y suelta un archivo aquí
                                                </div>
                                            </div>
                                        </label>
                                    </div>
                                    <div class="file-preview" id="servicioImagenPreview" style="display: none;">
                                        <img id="previewImageServicio" src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=" alt="Vista previa"
                                            style="max-width: 100%; height: auto; border-radius: 8px;">
                                        <div class="file-preview-label">Vista previa de la imagen</div>
                                        <button type="button" class="button button-small" style="margin-top: 10px;"
                                            onclick="clearServicioImagen()">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                                fill="currentColor" viewBox="0 0 16 16">
                                                <path
                                                    d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z" />
                                                <path fill-rule="evenodd"
                                                    d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z" />
                                            </svg>
                                            Cambiar imagen
                                        </button>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <button type="submit" class="button">
                                        <span id="servicioSubmitText">Guardar Servicio</span>
                                    </button>
                                </div>
                            </form>
                        </div>

                        <div class="admin-table-container">
                            <table class="admin-table" id="serviciosTable">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Nombre</th>
                                        <th>Categoría</th>
                                        <th>Efecto</th>
                                        <th>Precio Base</th>
                                        <th>Precio Retoque</th>
                                        <th>Duración</th>
                                        <th>Estado</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                                                    </tbody>
                            </table>
                        </div>
                    </div>

                                        <div class="admin-section" id="adminGaleria">
                        <div class="admin-header">
                            <h2 class="admin-header-title">Gestión de Galería</h2>
                            <div class="admin-header-actions">
                                <button class="button button-small" id="addMedia">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                        viewBox="0 0 16 16">
                                        <path
                                            d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z" />
                                    </svg>
                                    Subir Imagen
                                </button>
                            </div>
                        </div>

                        <div class="admin-form" id="mediaForm" style="display: none;">
                            <h3 class="admin-form-title">
                                <span>Subir Nueva Imagen</span>
                                <button class="button button-text" style="float: right;"
                                    id="cancelMediaForm">Cancelar</button>
                            </h3>

                            <form id="mediaUploadForm">
                                <div class="form-group">
                                    <label for="mediaServicio">Asociar a Servicio</label>
                                    <select id="mediaServicio">
                                        <option value="">Ninguno (general)</option>
                                                                            </select>
                                </div>

                                <div class="file-input-container">
                                    <input type="file" id="mediaFile" class="file-input" accept="image/*" required>
                                    <label for="mediaFile" class="file-input-label">
                                        <div style="text-align: center;">
                                            <div class="file-input-icon">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48"
                                                    fill="currentColor" viewBox="0 0 16 16">
                                                    <path
                                                        d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z" />
                                                    <path
                                                        d="M7.646 1.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8.5 2.707V11.5a.5.5 0 0 1-1 0V2.707L5.354 4.854a.5.5 0 1 1-.708-.708l3-3z" />
                                                </svg>
                                            </div>
                                            <div class="file-input-text">Haz clic para seleccionar imagen</div>
                                            <div class="file-input-subtext">o arrastra y suelta un archivo aquí</div>
                                        </div>
                                    </label>
                                </div>

                                <div class="file-preview" id="filePreview" style="display: none;">
                                    <img id="previewImage" src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=" alt="Vista previa">
                                    <div class="file-preview-label">Vista previa</div>
                                </div>

                                <div class="form-group">
                                    <div style="margin-top: 30px;">
                                        <input type="checkbox" id="mediaPublic" style="width: auto; margin-right: 10px;"
                                            checked>
                                        <label for="mediaPublic" style="display: inline; margin-bottom: 0;">Imagen
                                            pública</label>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <button type="submit" class="button">Subir Imagen</button>
                                </div>
                            </form>
                        </div>

                        <div class="admin-table-container">
                            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px; padding: 20px;"
                                id="mediaGrid">
                                                            </div>
                        </div>
                    </div>

                                        <div class="admin-section" id="adminResenas">
                        <div class="admin-header">
                            <h2 class="admin-header-title">Gestión de Reseñas</h2>
                            <div class="admin-header-actions">
                                <button class="button button-small" id="refreshResenas">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                        viewBox="0 0 16 16">
                                        <path fill-rule="evenodd"
                                            d="M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2v1z" />
                                        <path
                                            d="M8 4.466V.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384L8.41 4.658A.25.25 0 0 1 8 4.466z" />
                                    </svg>
                                    Actualizar
                                </button>
                            </div>
                        </div>

                        <div class="admin-tabs">
                            <div class="admin-tab" data-approved="false">Pendientes</div>
                            <div class="admin-tab active" data-approved="all">Todas</div>
                            <div class="admin-tab" data-approved="true">Aprobadas</div>
                        </div>

                        <div class="admin-table-container">
                            <table class="admin-table" id="resenasTable">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Fecha</th>
                                        <th>Nombre</th>
                                        <th>Calificación</th>
                                        <th>Comentario</th>
                                        <th>Estado</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                                                    </tbody>
                            </table>
                        </div>
                    </div>

                                        <div class="admin-section" id="adminDisponibilidad">
                        <div class="admin-header">
                            <h2 class="admin-header-title">Gestión de Disponibilidad</h2>
                            <div class="admin-header-actions">
                                <button class="button button-small" id="addBlackout">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                        viewBox="0 0 16 16">
                                        <path
                                            d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z" />
                                    </svg>
                                    Añadir Cierre
                                </button>
                            </div>
                        </div>

                        <div class="admin-tabs">
                            <div class="admin-tab active" data-tab="weeklyAvailability">Horario Semanal</div>
                            <div class="admin-tab" data-tab="blackoutDates">Cierres Especiales</div>
                        </div>

                                                <div class="tab-content active" id="weeklyAvailabilityContent">
                            <div class="admin-form">
                                <h3 class="admin-form-title">Horario de Atención por Día</h3>

                                <form id="availabilityForm">
                                    <div
                                        style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px;">
                                        <div class="form-group">
                                            <label>Lunes</label>
                                            <div style="display: flex; gap: 10px; align-items: center;">
                                                <input type="time" id="monday-open" value="10:00" style="width: 120px;">
                                                <span>-</span>
                                                <input type="time" id="monday-close" value="19:00"
                                                    style="width: 120px;">
                                                <div>
                                                    <input type="checkbox" id="monday-closed"
                                                        style="width: auto; margin-left: 10px;">
                                                    <label for="monday-closed"
                                                        style="display: inline; margin-bottom: 0; font-size: 0.75rem;">Cerrado</label>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="form-group">
                                            <label>Martes</label>
                                            <div style="display: flex; gap: 10px; align-items: center;">
                                                <input type="time" id="tuesday-open" value="10:00"
                                                    style="width: 120px;">
                                                <span>-</span>
                                                <input type="time" id="tuesday-close" value="19:00"
                                                    style="width: 120px;">
                                                <div>
                                                    <input type="checkbox" id="tuesday-closed"
                                                        style="width: auto; margin-left: 10px;">
                                                    <label for="tuesday-closed"
                                                        style="display: inline; margin-bottom: 0; font-size: 0.75rem;">Cerrado</label>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="form-group">
                                            <label>Miércoles</label>
                                            <div style="display: flex; gap: 10px; align-items: center;">
                                                <input type="time" id="wednesday-open" value="10:00"
                                                    style="width: 120px;">
                                                <span>-</span>
                                                <input type="time" id="wednesday-close" value="19:00"
                                                    style="width: 120px;">
                                                <div>
                                                    <input type="checkbox" id="wednesday-closed"
                                                        style="width: auto; margin-left: 10px;">
                                                    <label for="wednesday-closed"
                                                        style="display: inline; margin-bottom: 0; font-size: 0.75rem;">Cerrado</label>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="form-group">
                                            <label>Jueves</label>
                                            <div style="display: flex; gap: 10px; align-items: center;">
                                                <input type="time" id="thursday-open" value="10:00"
                                                    style="width: 120px;">
                                                <span>-</span>
                                                <input type="time" id="thursday-close" value="19:00"
                                                    style="width: 120px;">
                                                <div>
                                                    <input type="checkbox" id="thursday-closed"
                                                        style="width: auto; margin-left: 10px;">
                                                    <label for="thursday-closed"
                                                        style="display: inline; margin-bottom: 0; font-size: 0.75rem;">Cerrado</label>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="form-group">
                                            <label>Viernes</label>
                                            <div style="display: flex; gap: 10px; align-items: center;">
                                                <input type="time" id="friday-open" value="10:00" style="width: 120px;">
                                                <span>-</span>
                                                <input type="time" id="friday-close" value="19:00"
                                                    style="width: 120px;">
                                                <div>
                                                    <input type="checkbox" id="friday-closed"
                                                        style="width: auto; margin-left: 10px;">
                                                    <label for="friday-closed"
                                                        style="display: inline; margin-bottom: 0; font-size: 0.75rem;">Cerrado</label>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="form-group">
                                            <label>Sábado</label>
                                            <div style="display: flex; gap: 10px; align-items: center;">
                                                <input type="time" id="saturday-open" value="10:00"
                                                    style="width: 120px;">
                                                <span>-</span>
                                                <input type="time" id="saturday-close" value="19:00"
                                                    style="width: 120px;">
                                                <div>
                                                    <input type="checkbox" id="saturday-closed"
                                                        style="width: auto; margin-left: 10px;">
                                                    <label for="saturday-closed"
                                                        style="display: inline; margin-bottom: 0; font-size: 0.75rem;">Cerrado</label>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="form-group">
                                            <label>Domingo</label>
                                            <div style="display: flex; gap: 10px; align-items: center;">
                                                <input type="time" id="sunday-open" value="10:00" style="width: 120px;">
                                                <span>-</span>
                                                <input type="time" id="sunday-close" value="19:00"
                                                    style="width: 120px;">
                                                <div>
                                                    <input type="checkbox" id="sunday-closed"
                                                        style="width: auto; margin-left: 10px;" checked>
                                                    <label for="sunday-closed"
                                                        style="display: inline; margin-bottom: 0; font-size: 0.75rem;">Cerrado</label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="form-group mt-4">
                                        <button type="submit" class="button">Guardar Horario</button>
                                    </div>
                                </form>
                            </div>
                        </div>

                                                <div class="tab-content" id="blackoutDatesContent">
                            <div class="admin-form" id="blackoutForm">
                                <h3 class="admin-form-title">Añadir Cierre Especial</h3>

                                <form id="blackoutAddForm">
                                    <div class="form-row">
                                        <div class="form-group" style="flex: 1;">
                                            <label for="blackoutDate">Fecha</label>
                                            <input type="date" id="blackoutDate" required>
                                        </div>

                                        <div class="form-group" style="flex: 2;">
                                            <label for="blackoutReason">Motivo</label>
                                            <input type="text" id="blackoutReason"
                                                placeholder="Ej: Vacaciones, Feriado, etc." required>
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <button type="submit" class="button">Añadir Cierre</button>
                                    </div>
                                </form>
                            </div>

                            <div class="admin-table-container">
                                <table class="admin-table" id="blackoutsTable">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Fecha</th>
                                            <th>Motivo</th>
                                            <th>Acciones</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                                                            </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                                        <div class="admin-section" id="adminDescuentos">
                        <div class="admin-header">
                            <h2 class="admin-header-title">Gestión de Descuentos</h2>
                            <div class="admin-header-actions">
                                <button class="button button-small" id="addDescuento">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                        viewBox="0 0 16 16">
                                        <path
                                            d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z" />
                                    </svg>
                                    Nuevo Descuento
                                </button>
                            </div>
                        </div>

                        <div class="admin-form" id="descuentoForm" style="display: none;">
                            <h3 class="admin-form-title">
                                <span id="descuentoFormTitle">Nuevo Descuento</span>
                                <button class="button button-text" style="float: right;"
                                    id="cancelDescuentoForm">Cancelar</button>
                            </h3>

                            <form id="descuentoEditForm">
                                <input type="hidden" id="descuentoId" value="">

                                <div class="form-row">
                                    <div class="form-group" style="flex: 2;">
                                        <label for="descuentoServicio">Servicio</label>
                                        <select id="descuentoServicio" required>
                                            <option value="">Seleccionar servicio</option>
                                                                                    </select>
                                    </div>

                                    <div class="form-group" style="flex: 1;">
                                        <label for="descuentoPorcentaje">Porcentaje (%)</label>
                                        <input type="number" id="descuentoPorcentaje" min="1" max="90" required>
                                    </div>
                                </div>

                                <div class="form-row">
                                    <div class="form-group" style="flex: 1;">
                                        <label for="descuentoEtiqueta">Etiqueta</label>
                                        <input type="text" id="descuentoEtiqueta" placeholder="Ej: Promoción verano"
                                            required>
                                    </div>

                                    <div class="form-group" style="flex: 1;">
                                        <label for="descuentoInicio">Fecha inicio</label>
                                        <input type="date" id="descuentoInicio" required>
                                    </div>

                                    <div class="form-group" style="flex: 1;">
                                        <label for="descuentoFin">Fecha fin</label>
                                        <input type="date" id="descuentoFin" required>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <div style="display: flex; align-items: center; margin-top: 20px;">
                                        <input type="checkbox" id="descuentoActivo"
                                            style="width: auto; margin-right: 10px;" checked>
                                        <label for="descuentoActivo"
                                            style="display: inline; margin-bottom: 0;">Descuento activo</label>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <button type="submit" class="button">
                                        <span id="descuentoSubmitText">Guardar Descuento</span>
                                    </button>
                                </div>
                            </form>
                        </div>

                        <div class="admin-table-container">
                            <table class="admin-table" id="descuentosTable">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Servicio</th>
                                        <th>Etiqueta</th>
                                        <th>Descuento</th>
                                        <th>Vigencia</th>
                                        <th>Estado</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                                                    </tbody>
                            </table>
                        </div>
                    </div>

                                        <div class="admin-section" id="adminMetricas">
                        <div class="admin-header">
                            <h2 class="admin-header-title">Métricas y Análisis</h2>
                            <div class="admin-header-actions">
                                <div style="display: flex; gap: 10px; align-items: center;">
                                    <label for="metricsDateRange" style="margin-bottom: 0;">Período:</label>
                                    <select id="metricsDateRange" style="width: auto;">
                                        <option value="30">Últimos 30 días</option>
                                        <option value="90">Últimos 3 meses</option>
                                        <option value="180">Últimos 6 meses</option>
                                        <option value="365">Último año</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="admin-dashboard">
                            <div class="admin-card">
                                <div class="admin-card-header">
                                    <h3 class="admin-card-title">Ingresos Totales</h3>
                                    <div class="admin-card-icon">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                            fill="currentColor" viewBox="0 0 16 16">
                                            <path
                                                d="M4 10.781c.148 1.667 1.513 2.85 3.591 3.003V15h1.043v-1.216c2.27-.179 3.678-1.438 3.678-3.3 0-1.59-.947-2.51-2.956-3.028l-.722-.187V3.467c1.122.11 1.879.714 2.07 1.616h1.47c-.166-1.6-1.54-2.748-3.54-2.875V1H7.591v1.233c-1.939.23-3.27 1.472-3.27 3.156 0 1.454.966 2.483 2.661 2.917l.61.162v4.031c-1.149-.17-1.94-.8-2.131-1.718H4zm3.391-3.836c-1.043-.263-1.6-.825-1.6-1.616 0-.944.704-1.641 1.8-1.828v3.495l-.2-.05zm1.591 1.872c1.287.323 1.852.859 1.852 1.769 0 1.097-.826 1.828-2.2 1.939V8.73l.348.086z" />
                                        </svg>
                                    </div>
                                </div>
                                <div class="admin-card-content">
                                    <div class="admin-card-value" id="metricaIngresoTotal">$0</div>
                                    <div class="admin-card-subtitle">Ingresos en el período</div>
                                </div>
                            </div>

                            <div class="admin-card">
                                <div class="admin-card-header">
                                    <h3 class="admin-card-title">Clientes Atendidos</h3>
                                    <div class="admin-card-icon">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                            fill="currentColor" viewBox="0 0 16 16">
                                            <path
                                                d="M7 14s-1 0-1-1 1-4 5-4 5 3 5 4-1 1-1 1H7zm4-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6z" />
                                            <path fill-rule="evenodd"
                                                d="M5.216 14A2.238 2.238 0 0 1 5 13c0-1.355.68-2.75 1.936-3.72A6.325 6.325 0 0 0 5 9c-4 0-5 3-5 4s1 1 1 1h4.216z" />
                                            <path d="M4.5 8a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5z" />
                                        </svg>
                                    </div>
                                </div>
                                <div class="admin-card-content">
                                    <div class="admin-card-value" id="metricaClientesTotal">0</div>
                                    <div class="admin-card-subtitle">Clientes únicos</div>
                                </div>
                            </div>

                            <div class="admin-card">
                                <div class="admin-card-header">
                                    <h3 class="admin-card-title">Tasa de Cancelación</h3>
                                    <div class="admin-card-icon">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                            fill="currentColor" viewBox="0 0 16 16">
                                            <path
                                                d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z" />
                                        </svg>
                                    </div>
                                </div>
                                <div class="admin-card-content">
                                    <div class="admin-card-value" id="metricaCancelacionRate">0%</div>
                                    <div class="admin-card-subtitle">Tasa de cancelación</div>
                                </div>
                            </div>

                            <div class="admin-card">
                                <div class="admin-card-header">
                                    <h3 class="admin-card-title">Calificación Promedio</h3>
                                    <div class="admin-card-icon">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                            fill="currentColor" viewBox="0 0 16 16">
                                            <path
                                                d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z" />
                                        </svg>
                                    </div>
                                </div>
                                <div class="admin-card-content">
                                    <div class="admin-card-value" id="metricaRatingPromedio">0.0</div>
                                    <div class="admin-card-subtitle">Calificación promedio</div>
                                </div>
                            </div>
                        </div>

                        <div class="admin-chart-header">
                            <h3 class="admin-chart-title">Ingresos por Servicio</h3>
                            <div class="admin-chart-actions">
                                <button class="button button-small" id="downloadChartIngresosPorServicio">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                        viewBox="0 0 16 16">
                                        <path
                                            d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z" />
                                        <path
                                            d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3z" />
                                    </svg>
                                    Exportar
                                </button>
                            </div>
                        </div>
                        <div class="chart-container">
                            <canvas id="chartIngresosPorServicio"></canvas>
                        </div>

                        <div class="admin-chart-header">
                            <h3 class="admin-chart-title">Reservas por Día de la Semana</h3>
                        </div>
                        <div class="chart-container">
                            <canvas id="chartReservasPorDia"></canvas>
                        </div>

                        <div class="admin-chart-header">
                            <h3 class="admin-chart-title">Horarios Más Populares</h3>
                        </div>
                        <div class="chart-container">
                            <canvas id="chartHorarioPopular"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const SUPABASE_URL = 'https://tcmtxvuucjttngcazgff.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRjbXR4dnV1Y2p0dG5nY2F6Z2ZmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDA3MjUwMDEsImV4cCI6MjA1NjMwMTAwMX0.2WcIjMUEhSM6j9kYpbsYArQocZdHx86k7wXk-NyjIs0';
        let supabase = null;
        if (window.supabase && window.supabase.createClient) {
            supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        }
        const ADMIN_PASSWORD = 'a665a45920422f9d417e4867efdc4fb8a04a1f3fff1fa07e998e86f7f7a27ae3';
        let appData = {
            services: [],
            availability: [],
            blackouts: [],
            appointments: [],
            reviews: [],
            discounts: [],
            media: [],
            stats: {
                monthlyIncome: 0,
                monthlyAppointments: 0,
                totalClients: 0,
                averageRating: 0
            }
        };
        let eventListenersInitialized = false;
        let adminEventListenersInitialized = false;
        const cache = {
            charts: {},
            dateFilters: {
                last7Days: null,
                last30Days: null,
                last90Days: null
            }
        };
        const utils = {
            formatCurrency: (amount) => {
                return new Intl.NumberFormat('es-CL', {
                    style: 'currency',
                    currency: 'CLP',
                    maximumFractionDigits: 0
                }).format(amount);
            },

            formatDate: (dateString, options = { year: 'numeric', month: 'long', day: 'numeric' }) => {
                if (!dateString) return '';
                const [y, m, d] = dateString.split('-').map(Number);
                return new Date(y, m - 1, d).toLocaleDateString('es-CL', options);
            },

            formatTime: (timeString) => {
                if (!timeString) return '';
                return timeString.substring(0, 5);
            },

            showToast: (title, message, type = 'info', duration = 5000) => {
                const toastContainer = document.getElementById('toastContainer');
                if (!toastContainer) return;

                const toastId = 'toast-' + Date.now();
                const toast = document.createElement('div');
                toast.className = `toast toast-${type}`;
                toast.id = toastId;

                toast.innerHTML = `
          <div class="toast-content">
            <div class="toast-title">${title}</div>
            <div class="toast-message">${message}</div>
          </div>
          <button class="toast-close" onclick="document.getElementById('${toastId}').remove()">×</button>
        `;

                toastContainer.appendChild(toast);
                setTimeout(() => {
                    const toastElement = document.getElementById(toastId);
                    if (toastElement) {
                        toastElement.style.animation = 'slideOut 0.3s forwards';
                        setTimeout(() => toastElement.remove(), 300);
                    }
                }, duration);
            },

            generateStars: (rating) => {
                let stars = '';
                for (let i = 1; i <= 5; i++) {
                    stars += i <= rating ? '★' : '☆';
                }
                return stars;
            },

            calculateEndTime: (startTime, durationMinutes) => {
                if (!startTime) return '';

                const [hours, minutes] = startTime.split(':').map(Number);
                let endHours = hours + Math.floor((minutes + durationMinutes) / 60);
                const endMinutes = (minutes + durationMinutes) % 60;
                endHours = endHours % 24;

                return `${endHours.toString().padStart(2, '0')}:${endMinutes.toString().padStart(2, '0')}`;
            },

            sha256: async (message) => {
                const msgBuffer = new TextEncoder().encode(message);
                const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
                return Array.from(new Uint8Array(hashBuffer))
                    .map(b => b.toString(16).padStart(2, '0'))
                    .join('');
            },

            debounce: (func, wait) => {
                let timeout;
                return function executedFunction(...args) {
                    const later = () => {
                        clearTimeout(timeout);
                        func(...args);
                    };
                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);
                };
            },

            isDayClosed: (dayOfWeek) => {
                const dayAvailability = appData.availability && appData.availability.find(a => a.weekday === dayOfWeek);
                return !dayAvailability || dayAvailability.is_closed;
            },

            isBlackoutDate: (dateString) => {
                return appData.blackouts && appData.blackouts.some(b => b.date === dateString);
            },

            getBlackoutInfo: (dateString) => {
                return appData.blackouts && appData.blackouts.find(b => b.date === dateString);
            },

            toTimeSlots: (openTime, closeTime, breakStart, breakEnd, interval, serviceDuration) => {
                const toMin = (t) => {
                    if (!t) return 0;
                    const [h, m] = t.split(':').map(Number);
                    return h * 60 + m;
                };

                const toTime = (mins) => `${String(Math.floor(mins / 60)).padStart(2, '0')}:${String(mins % 60).padStart(2, '0')}`;

                const start = toMin(openTime);
                const end = toMin(closeTime);
                const breakS = breakStart ? toMin(breakStart) : null;
                const breakE = breakEnd ? toMin(breakEnd) : null;

                const slots = [];
                for (let minutes = start; minutes + serviceDuration <= end; minutes += interval) {
                    if (breakS !== null && breakE !== null) {
                        const slotEnd = minutes + serviceDuration;
                        const overlapsBreak = (minutes < breakE) && (slotEnd > breakS);
                        if (overlapsBreak) continue;
                    }

                    slots.push({
                        time: toTime(minutes),
                        endTime: toTime(minutes + serviceDuration)
                    });
                }

                return slots;
            },

            getNextAvailableSlot: (date, serviceId) => {
                const service = appData.services.find(s => s.id == serviceId);
                if (!service) return null;

                const serviceDuration = service ? parseInt(service.work_minutes, 10) : 30;
                const [y, m, d] = date.split('-').map(Number);
                const dateObj = new Date(y, m - 1, d);
                let checkDate = new Date(dateObj);
                for (let i = 0; i < 14; i++) {
                    const dateStr = checkDate.toISOString().split('T')[0];
                    const dayOfWeek = checkDate.getDay();
                    if (utils.isDayClosed(dayOfWeek) || utils.isBlackoutDate(dateStr)) {
                        checkDate.setDate(checkDate.getDate() + 1);
                        continue;
                    }
                    const dayAvailability = appData.availability.find(a => a.weekday === dayOfWeek);
                    if (!dayAvailability) {
                        checkDate.setDate(checkDate.getDate() + 1);
                        continue;
                    }

                    return {
                        date: dateStr,
                        dayName: checkDate.toLocaleDateString('es-CL', { weekday: 'long' }),
                        formattedDate: utils.formatDate(dateStr)
                    };
                }

                return null;
            },

            isMobile: () => {
                return window.innerWidth <= 768;
            },

            exportToCSV: (data, filename) => {
                const csvContent = data.map(row =>
                    row.map(value =>
                        typeof value === 'string' ? `"${value.replace(/"/g, '""')}"` : value
                    ).join(',')
                ).join('\n');

                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.setAttribute('href', url);
                link.setAttribute('download', filename);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
        };
        async function initApp() {
            try {
                showLoader(true);
                const { data: services, error: servicesError } = await supabase
                    .from('services').select('*').eq('is_active', true);
                if (servicesError) throw servicesError;
                appData.services = services;
                const servicioSelect = document.getElementById('servicio');
                if (servicioSelect) {
                    servicioSelect.innerHTML = '<option value="">Selecciona un servicio</option>';
                    services.forEach(service => {
                        const option = document.createElement('option');
                        option.value = service.id;
                        option.textContent = `${service.name} (${utils.formatCurrency(service.base_price)})`;
                        servicioSelect.appendChild(option);
                    });
                }
                await Promise.all([
                    loadAvailability(),
                    loadBlackoutDates(),
                    loadDiscounts(),
                    loadMedia()
                ]);
                await Promise.all([
                    loadLashbook(),
                    loadServicesAndPrices(),
                    loadReviews()
                ]);
                initCalendar();
                setupObservers();
                setupEventListeners();
                showLoader(false);
                setTimeout(() => {
                    utils.showToast('¡Bienvenido/a!', 'Pinky Eyelashess - Estamos encantados de atenderte', 'success');
                }, 1000);

            } catch (error) {
                console.error('Error initApp:', error);
                utils.showToast('Error', 'No se pudo inicializar la página. Por favor, recarga la página.', 'error');
                showLoader(false);
            }
        }
        function showLoader(show) {
            const loader = document.getElementById('pageLoader');
            if (!loader) return;

            if (show) {
                loader.style.display = 'flex';
            } else {
                loader.style.opacity = '0';
                setTimeout(() => {
                    loader.style.display = 'none';
                    loader.style.opacity = '1';
                }, 300);
            }
        }
        function setupObservers() {
            const imgObserver = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const img = entry.target;
                        const src = img.getAttribute('data-src');
                        if (src) {
                            img.src = src;
                            img.removeAttribute('data-src');
                            img.classList.add('loaded');
                        }
                        imgObserver.unobserve(img);
                    }
                });
            }, { threshold: 0.1 });
            document.querySelectorAll('img[data-src]').forEach(img => {
                imgObserver.observe(img);
            });
            const animateObserver = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('visible');
                        animateObserver.unobserve(entry.target);
                    }
                });
            }, { threshold: 0.1 });
            document.querySelectorAll('.animate-on-scroll').forEach(el => {
                animateObserver.observe(el);
            });
        }
        function setupEventListeners() {
            if (eventListenersInitialized) return;
            eventListenersInitialized = true;
            window.addEventListener('scroll', () => {
                const header = document.getElementById('header');
                if (!header) return;

                if (window.scrollY > 50) {
                    header.classList.add('scrolled');
                } else {
                    header.classList.remove('scrolled');
                }
            });
            const navToggle = document.getElementById('navToggle');
            const nav = document.getElementById('nav');

            if (navToggle && nav) {
                navToggle.addEventListener('click', () => {
                    navToggle.classList.toggle('active');
                    nav.classList.toggle('active');
                });
            }
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();

                    const targetId = link.getAttribute('href');
                    const targetElement = document.querySelector(targetId);

                    if (targetElement) {
                        if (navToggle && nav) {
                            navToggle.classList.remove('active');
                            nav.classList.remove('active');
                        }
                        window.scrollTo({
                            top: targetElement.offsetTop - 80,
                            behavior: 'smooth'
                        });
                        document.querySelectorAll('.nav-link').forEach(navLink => {
                            navLink.classList.remove('active');
                        });
                        link.classList.add('active');
                    }
                });
            });
            document.querySelectorAll('.faq-question').forEach(question => {
                question.addEventListener('click', () => {
                    const faqItem = question.parentElement;
                    faqItem.classList.toggle('active');
                });
            });
            const modal = document.getElementById('lashbookModal');
            const modalClose = document.getElementById('modalClose');

            if (modal && modalClose) {
                modalClose.addEventListener('click', () => {
                    modal.classList.remove('active');
                });
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        modal.classList.remove('active');
                    }
                });
            }
            const serviceModal = document.getElementById('serviceModal');
            const serviceModalClose = document.getElementById('serviceModalClose');

            if (serviceModal && serviceModalClose) {
                serviceModalClose.addEventListener('click', () => {
                    serviceModal.classList.remove('active');
                });
                serviceModal.addEventListener('click', (e) => {
                    if (e.target === serviceModal) {
                        serviceModal.classList.remove('active');
                    }
                });
            }
            const reviewForm = document.getElementById('reviewForm');
            const ratingButtons = document.querySelectorAll('.rating-btn');

            if (reviewForm && ratingButtons.length) {
                ratingButtons.forEach(btn => {
                    btn.addEventListener('click', () => {
                        const value = btn.getAttribute('data-value');
                        document.getElementById('reviewRating').value = value;
                        ratingButtons.forEach(button => {
                            if (button.getAttribute('data-value') <= value) {
                                button.classList.add('active');
                            } else {
                                button.classList.remove('active');
                            }
                        });
                    });
                });

                reviewForm.addEventListener('submit', handleReviewSubmit);
            }
            const reservarForm = document.getElementById('reservarForm');
            if (reservarForm) {
                reservarForm.addEventListener('submit', handleBookingSubmit);
            }
            const servicioSelect = document.getElementById('servicio');
            if (servicioSelect) {
                servicioSelect.addEventListener('change', () => {
                    const calendarContainer = document.getElementById('calendar');
                    const selectedDate = calendarContainer ? calendarContainer.getAttribute('data-selected-date') : null;
                    if (selectedDate) loadTimeSlots(selectedDate);
                    if (!selectedDate && servicioSelect.value) {
                        suggestNextAvailableSlot(servicioSelect.value);
                    }
                });
            }
            const adminAccessBtn = document.getElementById('adminAccessBtn');
            if (adminAccessBtn) {
                adminAccessBtn.addEventListener('click', () => {
                    document.getElementById('adminLoginModal').style.display = 'flex';
                });
            }
            const adminLoginForm = document.getElementById('adminLoginForm');
            if (adminLoginForm) {
                adminLoginForm.addEventListener('submit', handleAdminLogin);
            }
            const adminLogout = document.getElementById('adminLogout');
            if (adminLogout) {
                adminLogout.addEventListener('click', () => {
                    document.getElementById('adminPanelModal').style.display = 'none';
                    document.getElementById('adminLoginModal').style.display = 'flex';
                    document.getElementById('adminPassword').value = '';
                    document.getElementById('adminLoginForm').reset();
                });
            }
            const closeButtons = {
                'closeAdminLoginModal': 'adminLoginModal',
                'closeAdminPanelModal': 'adminPanelModal'
            };

            Object.entries(closeButtons).forEach(([btnId, modalId]) => {
                const btn = document.getElementById(btnId);
                if (btn) {
                    btn.addEventListener('click', () => {
                        document.getElementById(modalId).style.display = 'none';
                    });
                }
            });
            ['adminLoginModal', 'adminPanelModal'].forEach(modalId => {
                const modal = document.getElementById(modalId);
                if (modal) {
                    modal.addEventListener('click', (e) => {
                        if (e.target.id === modalId) {
                            modal.style.display = 'none';
                        }
                    });
                }
            });
            if (window.location.hash === '#admin') {
                setTimeout(() => {
                    const adminLoginModal = document.getElementById('adminLoginModal');
                    if (adminLoginModal) {
                        adminLoginModal.style.display = 'flex';
                    }
                }, 500);
            }
            initComparisonSlider();
        }
        async function handleReviewSubmit(e) {
            e.preventDefault();

            const name = document.getElementById('reviewName').value;
            const rating = parseInt(document.getElementById('reviewRating').value);
            const comment = document.getElementById('reviewComment').value;

            if (!name || !rating || !comment || comment.length < 20) {
                utils.showToast('Error', 'Por favor completa todos los campos. El comentario debe tener al menos 20 caracteres.', 'error');
                return;
            }

            try {
                const submitBtn = e.target.querySelector('button[type="submit"]');
                if (submitBtn) submitBtn.disabled = true;

                const { data, error } = await supabase
                    .from('reviews')
                    .insert([
                        { name, stars: rating, comment, is_approved: false }
                    ]);

                if (error) throw error;

                utils.showToast('¡Gracias!', 'Tu reseña ha sido enviada y está en revisión.', 'success');
                e.target.reset();

                const ratingButtons = document.querySelectorAll('.rating-btn');
                ratingButtons.forEach(btn => btn.classList.remove('active'));
                if (submitBtn) submitBtn.disabled = false;
            } catch (error) {
                console.error('Error submitting review:', error);
                utils.showToast('Error', 'Hubo un problema al enviar tu reseña. Por favor intenta nuevamente.', 'error');
                const submitBtn = e.target.querySelector('button[type="submit"]');
                if (submitBtn) submitBtn.disabled = false;
            }
        }
        async function handleBookingSubmit(e) {
            e.preventDefault();

            const servicioId = parseInt(document.getElementById('servicio').value, 10);
            const nombre = document.getElementById('nombre').value;
            const telefono = document.getElementById('telefono').value;
            const calendar = document.getElementById('calendar');
            const fechaSeleccionada = calendar ? calendar.getAttribute('data-selected-date') : null;
            const horaSeleccionada = document.querySelector('.time-slot.selected')?.getAttribute('data-time');

            if (!servicioId || !nombre || !telefono || !fechaSeleccionada || !horaSeleccionada) {
                utils.showToast('Error', 'Por favor completa todos los campos y selecciona fecha y hora.', 'error');
                return;
            }
            const phoneRegex = /^(\+?56)?(\s?)(0?9)(\s?)[9876543]\d{7}$/;
            if (!phoneRegex.test(telefono)) {
                utils.showToast('Error', 'Por favor ingresa un número de teléfono válido (ej: +56912345678).', 'error');
                return;
            }
            const service = appData.services.find(s => s.id === servicioId);
            if (!service) {
                utils.showToast('Error', 'Servicio no encontrado.', 'error');
                return;
            }
            const endTime = utils.calculateEndTime(horaSeleccionada, service.work_minutes);

            try {
                const submitBtn = document.getElementById('btnReservar');
                if (submitBtn) submitBtn.disabled = true;
                const { data, error } = await supabase
                    .from('appointments')
                    .insert([
                        {
                            service_id: servicioId,
                            customer_name: nombre,
                            customer_phone: telefono,
                            date: fechaSeleccionada,
                            start_time: horaSeleccionada,
                            end_time: endTime,
                            status: 'PENDING',
                            source: 'WEB'
                        }
                    ]);

                if (error) throw error;
                const activeDiscounts = appData.discounts.filter(d =>
                    d.service_id === service.id &&
                    d.is_active &&
                    new Date(d.date_start) <= new Date() &&
                    new Date(d.date_end) >= new Date()
                );
                const hasDiscount = activeDiscounts.length > 0;
                const discount = hasDiscount ? activeDiscounts[0] : null;
                const finalPrice = hasDiscount
                    ? Math.round(service.base_price * (1 - discount.percent_off / 100))
                    : service.base_price;
                const message = encodeURIComponent(
                    `Nueva reserva Pinky Eyelashess:\n` +
                    `Cliente: ${nombre}\n` +
                    `Teléfono: ${telefono}\n` +
                    `Servicio: ${service.name}\n` +
                    `Fecha: ${utils.formatDate(fechaSeleccionada)}\n` +
                    `Hora: ${horaSeleccionada}–${endTime}\n` +
                    (hasDiscount
                        ? `Precio: ${utils.formatCurrency(service.base_price)} (-${discount.percent_off}% = ${utils.formatCurrency(finalPrice)})\n`
                        : `Precio: ${utils.formatCurrency(service.base_price)}\n`) +
                    `Origen: Web`
                );

                utils.showToast('¡Reserva Confirmada!', 'Te redirigiremos a WhatsApp para confirmar tu cita.', 'success');
                e.target.reset();
                document.getElementById('reservaSummary').style.display = 'none';
                document.getElementById('btnReservar').disabled = true;
                document.querySelector('.time-slot.selected')?.classList.remove('selected');
                setTimeout(() => {
                    window.open(`https://wa.me/56936486082?text=${message}`, '_blank');
                }, 2000);
                loadTimeSlots(fechaSeleccionada);
            } catch (error) {
                console.error('Error submitting appointment:', error);
                utils.showToast('Error', 'Hubo un problema al enviar tu reserva. Por favor intenta nuevamente.', 'error');
                const submitBtn = document.getElementById('btnReservar');
                if (submitBtn) submitBtn.disabled = false;
            }
        }
        async function handleAdminLogin(e) {
            e.preventDefault();

            const password = document.getElementById('adminPassword').value;
            if (!password) {
                utils.showToast('Error', 'Ingresa la contraseña', 'error');
                return;
            }

            try {
                const submitBtn = e.target.querySelector('button[type="submit"]');
                if (submitBtn) submitBtn.disabled = true;
                const loadingIndicator = document.createElement('span');
                loadingIndicator.className = 'loading-indicator';
                loadingIndicator.textContent = 'Verificando...';
                if (submitBtn) submitBtn.appendChild(loadingIndicator);

                const passwordHash = await utils.sha256(password);

                if (passwordHash === ADMIN_PASSWORD) {
                    document.getElementById('adminLoginModal').style.display = 'none';
                    document.getElementById('adminPanelModal').style.display = 'flex';
                    document.getElementById('adminPassword').value = '';
                    document.getElementById('adminLoginForm').reset();
                    initAdminPanel();

                    utils.showToast('Bienvenido/a', 'Panel de administración iniciado correctamente', 'success');
                } else {
                    utils.showToast('Error', 'Contraseña incorrecta', 'error');
                }
            } catch (error) {
                console.error('Error login admin:', error);
                utils.showToast('Error', 'Error al iniciar sesión', 'error');
            } finally {
                const submitBtn = e.target.querySelector('button[type="submit"]');
                if (submitBtn) {
                    submitBtn.disabled = false;
                    const loadingIndicator = submitBtn.querySelector('.loading-indicator');
                    if (loadingIndicator) loadingIndicator.remove();
                }
            }
        }
        async function loadAvailability() {
            try {
                const { data, error } = await supabase
                    .from('availability')
                    .select('*');

                if (error) throw error;

                appData.availability = data;
                return data;
            } catch (error) {
                console.error('Error loading availability:', error);
                utils.showToast('Error', 'No se pudo cargar la disponibilidad', 'error', 2000);
                return [];
            }
        }
        async function loadBlackoutDates() {
            try {
                const { data, error } = await supabase
                    .from('blackouts')
                    .select('*');

                if (error) throw error;

                appData.blackouts = data.map(b => ({
                    ...b,
                    date: (b.date || '').split('T')[0]
                }));

                return appData.blackouts;
            } catch (error) {
                console.error('Error loading blackout dates:', error);
                utils.showToast('Error', 'No se pudieron cargar los cierres', 'error', 2000);
                return [];
            }
        }
        async function loadDiscounts() {
            try {
                const { data, error } = await supabase
                    .from('discounts')
                    .select('*')
                    .eq('is_active', true);

                if (error) throw error;
                appData.discounts = data || [];

                return data;
            } catch (error) {
                console.error('Error loading discounts:', error);
                utils.showToast('Error', 'No se pudieron cargar los descuentos', 'error', 2000);
                return [];
            }
        }
        async function loadMedia() {
            try {
                const { data, error } = await supabase
                    .from('media')
                    .select('*')
                    .eq('is_public', true);

                if (error) throw error;
                appData.media = data || [];

                return data;
            } catch (error) {
                console.error('Error loading media:', error);
                return [];
            }
        }
        async function loadLashbook() {
            try {
                const { data, error } = await supabase
                    .from('media')
                    .select('*, services(*)')
                    .eq('is_public', true);

                if (error) throw error;

                const lashbookGrid = document.getElementById('lashbookGrid');
                if (!lashbookGrid) return;

                lashbookGrid.innerHTML = '';

                const uniqueMedia = [];
                const seenUrls = new Set();
                data.forEach(item => {
                    if (!seenUrls.has(item.url_storage)) {
                        seenUrls.add(item.url_storage);
                        uniqueMedia.push(item);
                    }
                });

                const sortedMedia = uniqueMedia.sort((a, b) => {
                    return new Date(b.created_at || 0) - new Date(a.created_at || 0);
                });

                sortedMedia.forEach(item => {
                    const category = item.services?.category || '';
                    const effect = item.services?.effect || '';

                    const lashbookItem = document.createElement('div');
                    lashbookItem.className = 'lashbook-item animate-on-scroll';
                    lashbookItem.setAttribute('data-category', category);
                    lashbookItem.setAttribute('data-effect', effect);

                    lashbookItem.innerHTML = `
                <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1 1'%3E%3C/svg%3E" 
                     data-src="${item.url_storage}" 
                     alt="${item.services?.name || 'Trabajo de Pinky Eyelashess'}" 
                     class="lashbook-img">
                <div class="lashbook-overlay">
                  <h3 class="lashbook-title">${item.services?.name || 'Nuestro trabajo'}</h3>
                  <p class="lashbook-category">${category} ${effect ? '• ' + effect : ''}</p>
                </div>
            `;

                    lashbookItem.addEventListener('click', () => {
                        showLashbookModal(item);
                    });

                    lashbookGrid.appendChild(lashbookItem);
                });
                setupObservers();
                document.querySelectorAll('.filter-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const filter = btn.getAttribute('data-filter');
                        document.querySelectorAll('.filter-btn').forEach(filterBtn => {
                            filterBtn.classList.remove('active');
                        });
                        btn.classList.add('active');
                        document.querySelectorAll('.lashbook-item').forEach(item => {
                            item.classList.remove('filtered-in', 'filtered-out');

                            if (filter === 'all' ||
                                item.getAttribute('data-category') === filter ||
                                item.getAttribute('data-effect') === filter) {
                                item.classList.add('filtered-in');
                                setTimeout(() => {
                                    item.style.display = 'block';
                                }, 300);
                            } else {
                                item.classList.add('filtered-out');
                                setTimeout(() => {
                                    item.style.display = 'none';
                                }, 300);
                            }
                        });
                    });
                });
            } catch (error) {
                console.error('Error loading lashbook:', error);
                utils.showToast('Error', 'No se pudo cargar la galería de trabajos', 'error', 2000);
            }
        }
        function showLashbookModal(item) {
            const modal = document.getElementById('lashbookModal');
            const modalContent = document.getElementById('modalContent');

            if (!modal || !modalContent) return;

            const serviceInfo = item.services
                ? `<p class="modal-category">${item.services.category} ${item.services.effect ? '• ' + item.services.effect : ''}</p>
           <h3 class="modal-title">${item.services.name}</h3>
           <div class="modal-description">${item.services.description || ''}</div>`
                : '';

            modalContent.innerHTML = `
        <img src="${item.url_storage}" alt="${item.services?.name || 'Trabajo de Pinky Eyelashess'}" class="modal-image">
        ${serviceInfo}
        ${item.services ? `<a href="#reservar" class="button mt-3" onclick="document.getElementById('lashbookModal').classList.remove('active'); document.getElementById('servicio').value = ${item.services.id};">Reservar este servicio</a>` : ''}
    `;

            modal.classList.add('active');
        }
        window.showServiceModal = function (serviceId) {
            const modal = document.getElementById('serviceModal');
            const modalContent = document.getElementById('serviceModalContent');
            if (!modal || !modalContent) return;

            const service = appData.services.find(s => s.id === serviceId);
            if (!service) return;

            const serviceMedia = appData.media.find(m => m.service_id === service.id && m.is_public);
            const imageUrl = serviceMedia ? serviceMedia.url_storage : '';

            modalContent.innerHTML = `
        ${imageUrl ? `<img src="${imageUrl}" alt="${service.name}" class="modal-image">` : ''}
        <p class="modal-category">${service.category === 'LASH' ? 'Pestañas' : 'Cejas'} ${service.effect ? '• ' + service.effect : ''}</p>
        <h3 class="modal-title">${service.name}</h3>
        <div class="modal-description">${service.description || ''}</div>
        <ul class="precio-details">
            <li>Duración: ${service.work_minutes} minutos</li>
            ${service.result_duration_days ? `<li>Duración del resultado: ${service.result_duration_days} días</li>` : ''}
            ${service.retouch_price ? `<li>Retoque: ${utils.formatCurrency(service.retouch_price)}</li>` : ''}
        </ul>
        <div class="precio-cta">
            <a href="#reservar" class="button" onclick="document.getElementById('serviceModal').classList.remove('active'); document.getElementById('servicio').value = ${service.id};">Reservar Ahora</a>
        </div>`;

            modal.classList.add('active');
        };
        async function loadServicesAndPrices() {
            try {
                const preciosGrid = document.getElementById('preciosGrid');
                if (!preciosGrid) return;

                preciosGrid.innerHTML = '';
                appData.services.forEach(service => {
                        const precioCard = document.createElement('div');
                        precioCard.className = 'precio-card animate-on-scroll';
                        const activeDiscounts = appData.discounts.filter(d =>
                            d.service_id === service.id &&
                            d.is_active &&
                            new Date(d.date_start) <= new Date() &&
                            new Date(d.date_end) >= new Date()
                        );

                        const hasDiscount = activeDiscounts.length > 0;
                        const discount = hasDiscount ? activeDiscounts[0] : null;
                        const discountedPrice = hasDiscount
                            ? Math.round(service.base_price * (1 - discount.percent_off / 100))
                            : null;
                        const serviceMedia = appData.media.find(m => m.service_id === service.id && m.is_public);
                        const imageUrl = serviceMedia ? serviceMedia.url_storage : '';

                        precioCard.innerHTML = `
                    <div class="precio-image">
                        ${imageUrl ? `<img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1 1'%3E%3C/svg%3E" data-src="${imageUrl}" alt="${service.name}">` : `
                        <div class="no-image-placeholder">
                            <div>
                                <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="#ccc" viewBox="0 0 16 16" style="margin-bottom: 10px;">
                                    <path d="M6.002 5.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0z"/>
                                    <path d="M2.002 1a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2h-12zm12 1a1 1 0 0 1 1 1v6.5l-3.777-1.947a.5.5 0 0 0-.577.093l-3.71 3.71-2.66-1.772a.5.5 0 0 0-.63.062L1.002 12V3a1 1 0 0 1 1-1h12z"/>
                                </svg>
                                <div>Sin imagen</div>
                            </div>
                        </div>`}
                    </div>
                    <p class="precio-category">${service.category === 'LASH' ? 'Pestañas' : 'Cejas'} ${service.effect ? '• ' + service.effect : ''}</p>
                    <h3 class="precio-title">${service.name}</h3>
                    <div class="precio-amount">
                        ${hasDiscount ? `<span class="precio-original">${utils.formatCurrency(service.base_price)}</span>` : ''}
                        ${utils.formatCurrency(hasDiscount ? discountedPrice : service.base_price)}
                        ${hasDiscount ? `<span class="precio-discount">-${discount.percent_off}%</span>` : ''}
                    </div>
                    <div class="precio-description">
                        ${service.description || 'Servicio profesional personalizado para realzar tu belleza natural.'}
                    </div>
                    <div class="precio-cta">
                        <button class="button button-secondary" onclick="showServiceModal(${service.id})">Ver más</button>
                        <a href="#reservar" class="button" onclick="document.getElementById('servicio').value = ${service.id};">Reservar Ahora</a>
                    </div>
                `;

                        preciosGrid.appendChild(precioCard);
                });
                setupObservers();

            } catch (error) {
                console.error('Error loading services and prices:', error);
                utils.showToast('Error', 'No se pudieron cargar los servicios y precios', 'error', 2000);
                const preciosGrid = document.getElementById('preciosGrid');
                if (!preciosGrid) return;

                preciosGrid.innerHTML = '';

                appData.services.forEach(service => {
                    const precioCard = document.createElement('div');
                    precioCard.className = 'precio-card';

                    precioCard.innerHTML = `
                <div class="precio-image">
                    <div class="no-image-placeholder">
                        <div>
                            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="#ccc" viewBox="0 0 16 16" style="margin-bottom: 10px;">
                                <path d="M6.002 5.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0z"/>
                                <path d="M2.002 1a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2h-12zm12 1a1 1 0 0 1 1 1v6.5l-3.777-1.947a.5.5 0 0 0-.577.093l-3.71 3.71-2.66-1.772a.5.5 0 0 0-.63.062L1.002 12V3a1 1 0 0 1 1-1h12z"/>
                            </svg>
                            <div>Sin imagen</div>
                        </div>
                    </div>
                </div>
                <p class="precio-category">${service.category === 'LASH' ? 'Pestañas' : 'Cejas'} ${service.effect ? '• ' + service.effect : ''}</p>
                <h3 class="precio-title">${service.name}</h3>
                <div class="precio-amount">
                    ${utils.formatCurrency(service.base_price)}
                </div>
                <div class="precio-description">
                    ${service.description || 'Servicio profesional personalizado para realzar tu belleza natural.'}
                </div>
                <div class="precio-cta">
                    <button class="button button-secondary" onclick="showServiceModal(${service.id})">Ver más</button>
                    <a href="#reservar" class="button" onclick="document.getElementById('servicio').value = ${service.id};">Reservar Ahora</a>
                </div>
            `;

                    preciosGrid.appendChild(precioCard);
                });
            }
        }
        async function loadReviews() {
            try {
                const { data: reviews, error } = await supabase
                    .from('reviews')
                    .select('*')
                    .eq('is_approved', true)
                    .order('created_at', { ascending: false });

                if (error) throw error;

                appData.reviews = reviews;
                const totalReviews = reviews.length;
                const totalReviewsElement = document.getElementById('totalReviews');
                if (totalReviewsElement) {
                    totalReviewsElement.textContent = totalReviews;
                }

                if (totalReviews > 0) {
                    const totalStars = reviews.reduce((acc, review) => acc + review.stars, 0);
                    const averageRating = (totalStars / totalReviews).toFixed(1);

                    const promedioElement = document.querySelector('.resenas-promedio');
                    if (promedioElement) {
                        promedioElement.textContent = averageRating;
                    }
                    const starsElement = document.querySelector('.resenas-stars');
                    if (starsElement) {
                        starsElement.textContent = utils.generateStars(Math.round(averageRating));
                    }
                    const ratingCounts = [0, 0, 0, 0, 0];
                    reviews.forEach(review => {
                        ratingCounts[review.stars - 1]++;
                    });
                    for (let i = 0; i < 5; i++) {
                        const percentage = totalReviews > 0 ? (ratingCounts[i] / totalReviews) * 100 : 0;
                        const barElement = document.querySelector(`.rating-bar:nth-child(${5 - i}) .rating-bar-fill`);
                        if (barElement) {
                            barElement.style.width = `${percentage}%`;
                        }

                        const countElement = document.getElementById(`rating${5 - i}Count`);
                        if (countElement) {
                            countElement.textContent = ratingCounts[4 - i];
                        }
                    }
                }
                const resenasGrid = document.getElementById('resenasGrid');
                if (!resenasGrid) return;

                resenasGrid.innerHTML = '';
                reviews.slice(0, 6).forEach(review => {
                    const resenaItem = document.createElement('div');
                    resenaItem.className = 'resena-item animate-on-scroll';

                    const date = new Date(review.created_at);
                    const formattedDate = date.toLocaleDateString('es-CL', {
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric'
                    });

                    const initials = review.name
                        .split(' ')
                        .map(n => n[0])
                        .join('')
                        .toUpperCase()
                        .substring(0, 2);

                    resenaItem.innerHTML = `
                <div class="resena-header">
                    <div class="resena-avatar">${initials}</div>
                    <div class="resena-info">
                        <h4 class="resena-name">${review.name}</h4>
                        <p class="resena-date">${formattedDate}</p>
                    </div>
                </div>
                <div class="resena-stars">${utils.generateStars(review.stars)}</div>
                <div class="resena-content">${review.comment}</div>
            `;

                    resenasGrid.appendChild(resenaItem);
                });
                if (reviews.length > 6) {
                    const verMasBtn = document.createElement('div');
                    verMasBtn.className = 'ver-mas-resenas';
                    verMasBtn.innerHTML = `<button class="button">Ver todas las reseñas (${reviews.length})</button>`;
                    verMasBtn.addEventListener('click', () => showAllReviews(reviews));
                    resenasGrid.parentElement.appendChild(verMasBtn);
                }
            } catch (error) {
                console.error('Error loading reviews:', error);
                utils.showToast('Error', 'No se pudieron cargar las reseñas', 'error', 2000);
            }
        }
        function showAllReviews(reviews) {
            const modalId = 'allReviewsModal';
            let modal = document.getElementById(modalId);

            if (!modal) {
                modal = document.createElement('div');
                modal.id = modalId;
                modal.className = 'modal';

                modal.innerHTML = `
            <div class="modal-content">
                <button class="modal-close">×</button>
                <h2>Todas las reseñas</h2>
                <div class="all-reviews-grid"></div>
            </div>
        `;

                document.body.appendChild(modal);

                modal.querySelector('.modal-close').addEventListener('click', () => {
                    modal.classList.remove('active');
                });

                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        modal.classList.remove('active');
                    }
                });
            }
            const resenasGrid = modal.querySelector('.all-reviews-grid');
            resenasGrid.innerHTML = '';

            reviews.forEach(review => {
                const resenaItem = document.createElement('div');
                resenaItem.className = 'resena-item';

                const date = new Date(review.created_at);
                const formattedDate = date.toLocaleDateString('es-CL', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });

                const initials = review.name
                    .split(' ')
                    .map(n => n[0])
                    .join('')
                    .toUpperCase()
                    .substring(0, 2);

                resenaItem.innerHTML = `
            <div class="resena-header">
                <div class="resena-avatar">${initials}</div>
                <div class="resena-info">
                    <h4 class="resena-name">${review.name}</h4>
                    <p class="resena-date">${formattedDate}</p>
                </div>
            </div>
            <div class="resena-stars">${utils.generateStars(review.stars)}</div>
            <div class="resena-content">${review.comment}</div>
        `;

                resenasGrid.appendChild(resenaItem);
            });
            modal.classList.add('active');
        }
        function initComparisonSlider() {
            const slider = document.getElementById('comparisonSlider');
            if (!slider) return;

            const handle = slider.querySelector('.comparison-slider-handle');
            let isDragging = false;

            const setSliderPosition = (position) => {
                const containerWidth = slider.offsetWidth;
                let posPercent = (position / containerWidth) * 100;
                posPercent = Math.max(0, Math.min(100, posPercent));

                slider.style.setProperty('--slider-position', `${posPercent}%`);
            };

            const startDrag = (e) => {
                isDragging = true;
                slider.classList.add('dragging');
                updateSliderPosition(e);
            };

            const stopDrag = () => {
                isDragging = false;
                slider.classList.remove('dragging');
            };

            const updateSliderPosition = (e) => {
                if (!isDragging) return;

                const containerRect = slider.getBoundingClientRect();
                const position = e.type.includes('touch')
                    ? e.touches[0].clientX - containerRect.left
                    : e.clientX - containerRect.left;

                setSliderPosition(position);
            };
            handle.addEventListener('mousedown', startDrag);
            window.addEventListener('mouseup', stopDrag);
            window.addEventListener('mousemove', updateSliderPosition);
            handle.addEventListener('touchstart', startDrag);
            window.addEventListener('touchend', stopDrag);
            window.addEventListener('touchcancel', stopDrag);
            window.addEventListener('touchmove', updateSliderPosition);
            slider.addEventListener('click', (e) => {
                if (e.target !== handle) {
                    const containerRect = slider.getBoundingClientRect();
                    const position = e.clientX - containerRect.left;
                    setSliderPosition(position);
                }
            });
            document.querySelectorAll('.slider-dot').forEach(dot => {
                dot.addEventListener('click', () => {
                    const index = dot.getAttribute('data-index');
                    const beforeImg = slider.querySelector('.comparison-before img');
                    const afterImg = slider.querySelector('.comparison-after img');
                    document.querySelectorAll('.slider-dot').forEach(d => {
                        d.classList.remove('active');
                    });
                    dot.classList.add('active');
                    if (beforeImg && afterImg) {
                        const beforeImgSets = [
                            'https://via.placeholder.com/400x300?text=Before1',
                            'https://via.placeholder.com/400x300?text=Before2',
                            'https://via.placeholder.com/400x300?text=Before3'
                        ];

                        const afterImgSets = [
                            'https://via.placeholder.com/400x300?text=After1',
                            'https://via.placeholder.com/400x300?text=After2',
                            'https://via.placeholder.com/400x300?text=After3'
                        ];
                        beforeImg.style.opacity = '0';
                        afterImg.style.opacity = '0';
                        setTimeout(() => {
                            beforeImg.src = beforeImgSets[index] || beforeImgSets[0];
                            afterImg.src = afterImgSets[index] || afterImgSets[0];
                            beforeImg.style.opacity = '1';
                            afterImg.style.opacity = '1';
                        }, 300);
                    }
                });
            });
            setSliderPosition(slider.offsetWidth / 2);
        }
        function initCalendar() {
            const calendarContainer = document.getElementById('calendar');
            if (!calendarContainer) return;

            const today = new Date();
            renderCalendar(today.getMonth(), today.getFullYear());
        }

        async function generateTimeSlots(date) {
    const timeSlotsContainer = document.getElementById('timeSlots');
    const noSlotsMessage = document.getElementById('noSlotsMessage');
    
    timeSlotsContainer.innerHTML = '';
    
    try {
        // Obtener horarios ya reservados para esta fecha
        // Obtener citas reservadas desde la tabla correcta
        const { data: reservedSlots, error } = await supabase
            .from('appointments')
            .select('start_time, service_id, services(work_minutes)')
            .eq('date', date)
            .in('status', ['PENDING', 'CONFIRMED']);
        
        if (error) throw error;
        
        // Horario de atención (configurable desde el panel admin)
        const openTime = '09:00';
        const closeTime = '19:00';
        const slotDuration = 30; // minutos
        
        // Convertir a minutos desde el inicio del día
        const openMinutes = parseInt(openTime.split(':')[0]) * 60 + parseInt(openTime.split(':')[1]);
        const closeMinutes = parseInt(closeTime.split(':')[0]) * 60 + parseInt(closeTime.split(':')[1]);
        
        // Crear contenedor para los slots
        const slotsGrid = document.createElement('div');
        slotsGrid.className = 'time-slots';
        
        // Generar todos los horarios posibles y ordenarlos cronológicamente
        const allSlots = [];
        
        for (let time = openMinutes; time < closeMinutes; time += slotDuration) {
            const hours = Math.floor(time / 60);
            const minutes = time % 60;
            const timeString = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;
            
            // Calcular hora de fin para mostrar
            const endTime = time + slotDuration;
            const endHours = Math.floor(endTime / 60);
            const endMinutes = endTime % 60;
            const endTimeString = `${endHours.toString().padStart(2, '0')}:${endMinutes.toString().padStart(2, '0')}`;
            
            allSlots.push({
                start: timeString,
                end: endTimeString,
                minutes: time
            });
        }
        
        // Ordenar slots por hora (de mañana a tarde)
        allSlots.sort((a, b) => a.minutes - b.minutes);
        
        // Marcar horarios como ocupados
        const unavailableSlots = new Set();
        if (reservedSlots && reservedSlots.length > 0) {
            reservedSlots.forEach(slot => {
                const reservedTime = slot.start_time;
                const serviceDuration = slot.services ? slot.services.work_minutes : 60; // Default 60 min
                const slotCount = Math.ceil(serviceDuration / slotDuration);
                
                // Convertir a minutos desde el inicio del día
                const reservedMinutes = parseInt(reservedTime.split(':')[0]) * 60 + parseInt(reservedTime.split(':')[1]);
                
                // Marcar todos los slots necesarios para este servicio
                for (let i = 0; i < slotCount; i++) {
                    const blockedTime = reservedMinutes + (i * slotDuration);
                    const blockedHours = Math.floor(blockedTime / 60);
                    const blockedMinutes = blockedTime % 60;
                    const blockedTimeString = `${blockedHours.toString().padStart(2, '0')}:${blockedMinutes.toString().padStart(2, '0')}`;
                    unavailableSlots.add(blockedTimeString);
                }
            });
        }
        
        // Crear los elementos visuales para los horarios
        let availableSlotsCount = 0;
        
        allSlots.forEach(slotInfo => {
            const slot = document.createElement('div');
            slot.className = 'time-slot';
            slot.textContent = `${formatTime(slotInfo.start)} a ${formatTime(slotInfo.end)}`;
            slot.dataset.time = slotInfo.start;
            
            if (unavailableSlots.has(slotInfo.start)) {
                slot.classList.add('disabled');
                slot.title = 'No disponible';
            } else {
                availableSlotsCount++;
                slot.addEventListener('click', () => selectTimeSlot(slot));
            }
            
            slotsGrid.appendChild(slot);
        });
        
        // Agregar grid al contenedor principal
        timeSlotsContainer.appendChild(slotsGrid);
        
        // Mostrar mensaje si no hay horarios disponibles
        if (availableSlotsCount === 0) {
            noSlotsMessage.textContent = 'No hay horarios disponibles para esta fecha. Por favor, selecciona otra fecha.';
            noSlotsMessage.style.display = 'block';
        } else {
            noSlotsMessage.style.display = 'none';
        }
    } catch (error) {
        console.error('Error generando horarios:', error);
        createToast('Error', 'No se pudieron cargar los horarios disponibles. Inténtalo de nuevo más tarde.', 'error');
        noSlotsMessage.textContent = 'Error al cargar horarios disponibles.';
        noSlotsMessage.style.display = 'block';
    }
}


        function renderCalendar(month, year) {
            const calendarContainer = document.getElementById('calendar');
            if (!calendarContainer) return;

            const today = new Date();
            calendarContainer.innerHTML = '';
            const header = document.createElement('div');
            header.className = 'calendar-header';

            const monthNames = ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];

            header.innerHTML = `
        <div class="calendar-month">${monthNames[month]} ${year}</div>
        <div class="calendar-controls">
            <button class="button-text" id="prevMonth">‹</button>
            <button class="button-text" id="nextMonth">›</button>
        </div>`;
            calendarContainer.appendChild(header);
            const daysHeader = document.createElement('div');
            daysHeader.className = 'calendar-weekdays';

            const weekdayNames = ['LUN', 'MAR', 'MIÉ', 'JUE', 'VIE', 'SÁB', 'DOM'];
            weekdayNames.forEach(d => {
                const el = document.createElement('div');
                el.className = 'weekday';
                el.textContent = d;
                daysHeader.appendChild(el);
            });
            calendarContainer.appendChild(daysHeader);
            const firstDay = new Date(year, month, 1);
            const firstDayIndex = (firstDay.getDay() + 6) % 7;
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const prevMonthLastDay = new Date(year, month, 0).getDate();
            const daysContainer = document.createElement('div');
            daysContainer.className = 'calendar-days';
            for (let i = 0; i < firstDayIndex; i++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day outside-month';
                dayElement.textContent = prevMonthLastDay - firstDayIndex + i + 1;
                daysContainer.appendChild(dayElement);
            }
            for (let day = 1; day <= daysInMonth; day++) {
                const dateObj = new Date(year, month, day);
                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;

                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                dayElement.textContent = day;
                const isToday = (dateObj.toDateString() === today.toDateString());
                if (isToday) dayElement.classList.add('today');
                const isPast = dateObj < new Date(today.setHours(0, 0, 0, 0));
                if (isPast) dayElement.classList.add('past');
                const dayOfWeekJS = dateObj.getDay();
                const closedByWeekday = utils.isDayClosed(dayOfWeekJS);
                const isBlackout = utils.isBlackoutDate(dateStr);

                if (closedByWeekday || isBlackout || isPast) {
                    dayElement.classList.add('disabled');
                    if (isBlackout) {
                        const blackoutInfo = utils.getBlackoutInfo(dateStr);
                        dayElement.setAttribute('title', blackoutInfo?.reason || 'Cerrado');
                    } else if (closedByWeekday) {
                        dayElement.setAttribute('title', 'No atendemos este día');
                    } else if (isPast) {
                        dayElement.setAttribute('title', 'Fecha pasada');
                    }
                } else {
                    dayElement.addEventListener('click', () => {
                        document.querySelectorAll('.calendar-day').forEach(d => d.classList.remove('selected'));
                        dayElement.classList.add('selected');
                        calendarContainer.setAttribute('data-selected-date', dateStr);
                        loadTimeSlots(dateStr);
                    });
                }

                daysContainer.appendChild(dayElement);
            }
            const totalCellsUsed = firstDayIndex + daysInMonth;
            const cellsToComplete = totalCellsUsed % 7 === 0 ? 0 : 7 - (totalCellsUsed % 7);
            for (let i = 1; i <= cellsToComplete; i++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day outside-month';
                dayElement.textContent = i;
                daysContainer.appendChild(dayElement);
            }

            calendarContainer.appendChild(daysContainer);
            document.getElementById('prevMonth').addEventListener('click', () => {
                let m = month - 1, y = year;
                if (m < 0) { m = 11; y--; }
                renderCalendar(m, y);
            });
            document.getElementById('nextMonth').addEventListener('click', () => {
                let m = month + 1, y = year;
                if (m > 11) { m = 0; y++; }
                renderCalendar(m, y);
            });
        }
       // Reemplaza tu función por esta versión
async function loadTimeSlots(date) {
  const timeSlotsContainer = document.getElementById('timeSlots');
  const servicioSelect     = document.getElementById('servicio');
  const btnReservar        = document.getElementById('btnReservar');
  const reservaSummary     = document.getElementById('reservaSummary');

  if (!timeSlotsContainer) return;

  const ensureMessage = (text, display = true) => {
    let msg = document.getElementById('noSlotsMessage');
    if (!msg) {
      msg = document.createElement('p');
      msg.id = 'noSlotsMessage';
      msg.className = 'text-center text-light';
      timeSlotsContainer.appendChild(msg);
    }
    msg.textContent = text;
    msg.style.display = display ? 'block' : 'none';
    return msg;
  };

  timeSlotsContainer.innerHTML = '';
  ensureMessage('', false);
  if (btnReservar) btnReservar.disabled = true;

  if (!date || !servicioSelect || !servicioSelect.value) {
    ensureMessage('Selecciona una fecha y servicio para ver horarios disponibles');
    if (reservaSummary) reservaSummary.style.display = 'none';
    return;
  }

  const serviceId = parseInt(servicioSelect.value, 10);

  try {
    const loading = document.createElement('div');
    loading.className = 'loading-slots';
    loading.textContent = 'Cargando horarios disponibles...';
    timeSlotsContainer.appendChild(loading);

    const toMinutes = (t) => {
      if (t == null) return null;
      if (typeof t === 'number') return t;

      if (typeof t === 'string') {
        const match = t.match(/^(\d{1,2}):(\d{2})/);
        if (match) return parseInt(match[1], 10) * 60 + parseInt(match[2], 10);
        const parsed = parseInt(t, 10);
        return isNaN(parsed) ? null : parsed;
      }
      return null;
    };
    const toTime = (mins) => {
      const hh = Math.floor(mins / 60);
      const mm = mins % 60;
      return `${String(hh).padStart(2,'0')}:${String(mm).padStart(2,'0')}`;
    };

    const [y, m, d] = date.split('-').map(Number);
    const dateObj   = new Date(y, m - 1, d);
    const dayOfWeek = dateObj.getDay();


    let dayAvailability = appData?.availability?.find(a => a.weekday === dayOfWeek);
    if (!dayAvailability) {
      const { data: availRows, error: availError } = await supabase
        .from('availability')
        .select('*')
        .eq('weekday', dayOfWeek)
        .limit(1);
      if (availError) throw availError;

      dayAvailability = (availRows && availRows[0]) || null;
      if (dayAvailability) {
        appData.availability = appData.availability || [];
        const existing = appData.availability.findIndex(a => a.weekday === dayOfWeek);
        if (existing >= 0) appData.availability[existing] = dayAvailability;
        else appData.availability.push(dayAvailability);
      }
    }

    if (!dayAvailability || dayAvailability.is_closed) {

      timeSlotsContainer.innerHTML = '';
      ensureMessage('Sin horarios disponibles (día cerrado)');
      return;
    }

    const service = appData?.services?.find(s => s.id == serviceId);
    if (!service) {
      timeSlotsContainer.innerHTML = '';
      ensureMessage('Servicio no encontrado');
      return;
    }

    const { data: appointments, error } = await supabase
      .from('appointments')
      .select('*')
      .eq('date', date)
      .in('status', ['PENDING', 'CONFIRMED']);
    if (error) throw error;

    const overlapsAppt = (start, end) => {
      return (appointments || []).some(a => {
        const aStart = toMinutes(a.start_time);
        const aEnd   = toMinutes(a.end_time);
        return start < aEnd && end > aStart;
      });
    };


    const OPEN        = toMinutes(dayAvailability.open_time);
    const CLOSE       = toMinutes(dayAvailability.close_time);
    const BREAK_START = toMinutes(dayAvailability.break_start);
    const BREAK_END   = toMinutes(dayAvailability.break_end);
    const interval    = toMinutes(dayAvailability.slot_minutes) || 15;

    const serviceDur  = parseInt(service.work_minutes, 10);

    const rawSlots = [];
    for (let start = OPEN; start + serviceDur <= CLOSE; start += interval) {
      const end = start + serviceDur;
      const crossesBreak = (BREAK_START != null && BREAK_END != null) &&
                           (start < BREAK_END) && (end > BREAK_START);
      if (crossesBreak) continue;
      rawSlots.push({ time: toTime(start), endTime: toTime(end), startMinutes: start });
    }

    const available = rawSlots.filter(s => !overlapsAppt(s.startMinutes, s.startMinutes + serviceDur));

    if (!available.length) {
      timeSlotsContainer.innerHTML = '';
      ensureMessage('No hay horarios disponibles para esta fecha');
      return;
    }

    const dedup = new Set();
    const uniqueSlots = available.filter(s => {
      if (dedup.has(s.time)) return false;
      dedup.add(s.time);
      return true;
    }).sort((a, b) => a.startMinutes - b.startMinutes);

    const groups = new Map();
    for (const s of uniqueSlots) {
      const hourNum = parseInt(s.time.split(':')[0], 10);
      if (!groups.has(hourNum)) groups.set(hourNum, []);
      groups.get(hourNum).push(s);
    }

    timeSlotsContainer.innerHTML = '';
    ensureMessage('', false);

    [...groups.entries()].sort((a, b) => a[0] - b[0]).forEach(([hour, hourSlots]) => {
      const hourContainer = document.createElement('div');
      hourContainer.className = 'hour-slots';
      hourContainer.innerHTML = `
        <div class="hour-label">${String(hour).padStart(2,'0')}:00</div>
        <div class="hour-slots-grid"></div>
      `;
      const slotsGrid = hourContainer.querySelector('.hour-slots-grid');

      hourSlots.forEach(slot => {
        const el = document.createElement('div');
        el.className = 'time-slot';
        el.textContent = slot.time;
        el.dataset.time = slot.time;
        el.dataset.endTime = slot.endTime;

        el.addEventListener('click', () => {
          document.querySelectorAll('.time-slot').forEach(s => s.classList.remove('selected'));
          el.classList.add('selected');
          if (btnReservar) btnReservar.disabled = false;
          updateReservaSummary(date, slot.time, slot.endTime, service);
        });

        slotsGrid.appendChild(el);
      });

      timeSlotsContainer.appendChild(hourContainer);
    });

  } catch (err) {
    console.error('Error loading time slots:', err);
    timeSlotsContainer.innerHTML = '';
    ensureMessage('Error al cargar horarios. Intenta nuevamente.');
  }
}

        function timeToMinutes(time) {
            if (!time) return 0;
            const [hours, minutes] = time.split(':').map(Number);
            return hours * 60 + minutes;
        }
        function updateReservaSummary(date, startTime, endTime, service) {
            const reservaSummary = document.getElementById('reservaSummary');
            if (!reservaSummary) return;

            const formattedDate = utils.formatDate(date);
            const formattedTime = `${startTime} - ${endTime}`;

            const servicioElement = document.getElementById('summaryServicio');
            const fechaElement = document.getElementById('summaryFecha');
            const horaElement = document.getElementById('summaryHora');
            const duracionElement = document.getElementById('summaryDuracion');
            const precioElement = document.getElementById('summaryPrecio');

            if (servicioElement) servicioElement.textContent = service.name;
            if (fechaElement) fechaElement.textContent = formattedDate;
            if (horaElement) horaElement.textContent = formattedTime;
            if (duracionElement) duracionElement.textContent = `${service.work_minutes} minutos`;
            const activeDiscounts = appData.discounts.filter(d =>
                d.service_id === service.id &&
                d.is_active &&
                new Date(d.date_start) <= new Date() &&
                new Date(d.date_end) >= new Date()
            );

            const hasDiscount = activeDiscounts.length > 0;
            const discount = hasDiscount ? activeDiscounts[0] : null;
            const finalPrice = hasDiscount
                ? Math.round(service.base_price * (1 - discount.percent_off / 100))
                : service.base_price;

            if (precioElement) {
                if (hasDiscount) {
                    precioElement.innerHTML = `<del>${utils.formatCurrency(service.base_price)}</del> ${utils.formatCurrency(finalPrice)} <span class="badge badge-accent">-${discount.percent_off}%</span>`;
                } else {
                    precioElement.textContent = utils.formatCurrency(service.base_price);
                }
            }

            reservaSummary.style.display = 'block';
            setTimeout(() => {
                reservaSummary.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }, 100);
        }

        
        function suggestNextAvailableSlot(serviceId) {
            const today = new Date();
            const nextSlot = utils.getNextAvailableSlot(today.toISOString().split('T')[0], serviceId);

            if (nextSlot) {
                const calendarContainer = document.getElementById('calendar');
                if (calendarContainer) {
                    const [nextY, nextM, nextD] = nextSlot.date.split('-').map(Number);
                    renderCalendar(nextM - 1, nextY);
                    setTimeout(() => {
                        const dayElements = document.querySelectorAll('.calendar-day:not(.outside-month)');
                        dayElements.forEach(dayEl => {
                            if (parseInt(dayEl.textContent, 10) === nextD) {
                                dayEl.click();
                            }
                        });
                    }, 100);
                }
            }
        }
        async function initAdminPanel() {
            try {
                showAdminLoader(true);
                await Promise.all([
                    loadAdminServices(),
                    loadAdminAppointments(),
                    loadAdminReviews(),
                    loadAdminDiscounts(),
                    loadAdminMedia(),
                    loadAdminAvailability(),
                    loadAdminBlackouts()
                ]);
                initAdminCharts();
                setupAdminEventHandlers();
                document.querySelectorAll('.admin-menu-link').forEach(link => {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();

                        const sectionId = link.getAttribute('data-section');
                        document.querySelectorAll('.admin-menu-link').forEach(menuLink => {
                            menuLink.classList.remove('active');
                        });
                        link.classList.add('active');
                        document.querySelectorAll('.admin-section').forEach(section => {
                            section.classList.remove('active');
                        });
                        document.getElementById(`admin${sectionId.charAt(0).toUpperCase() + sectionId.slice(1)}`).classList.add('active');
                    });
                });
                showAdminLoader(false);

                console.log('Admin panel initialized successfully');
            } catch (error) {
                console.error('Error initializing admin panel:', error);
                utils.showToast('Error', 'Hubo un problema al inicializar el panel de administración', 'error');
                showAdminLoader(false);
            }
        }
        function showAdminLoader(show) {
            const loader = document.getElementById('adminLoader');
            if (!loader) return;

            if (show) {
                loader.style.display = 'flex';
            } else {
                loader.style.opacity = '0';
                setTimeout(() => {
                    loader.style.display = 'none';
                    loader.style.opacity = '1';
                }, 300);
            }
        }
        async function loadAdminServices() {
            try {
                const { data, error } = await supabase
                    .from('services')
                    .select('*')
                    .order('id');

                if (error) throw error;

                appData.services = data;
                const serviciosTable = document.getElementById('serviciosTable').querySelector('tbody');
                if (!serviciosTable) return;

                serviciosTable.innerHTML = '';

                data.forEach(service => {
                    const row = document.createElement('tr');

                    row.innerHTML = `
                <td>${service.id}</td>
                <td>${service.name}</td>
                <td>${service.category === 'LASH' ? 'Pestañas' : 'Cejas'}</td>
                <td>${service.effect || '-'}</td>
                <td>${utils.formatCurrency(service.base_price)}</td>
                <td>${service.retouch_price ? utils.formatCurrency(service.retouch_price) : '-'}</td>
                <td>${service.work_minutes} min</td>
                <td>
                    <span class="badge ${service.is_active ? 'badge-success' : 'badge-error'}">
                        ${service.is_active ? 'Activo' : 'Inactivo'}
                    </span>
                </td>
                <td class="admin-table-actions">
                    <button class="button button-small admin-action-btn" onclick="editService(${service.id})">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M12.854.146a.5.5 0 0 0-.707 0L10.5 1.793 14.207 5.5l1.647-1.646a.5.5 0 0 0 0-.708l-3-3zm.646 6.061L9.793 2.5 3.293 9H3.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.207l6.5-6.5zm-7.468 7.468A.5.5 0 0 1 6 13.5V13h-.5a.5.5 0 0 1-.5-.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.5-.5V10h-.5a.499.499 0 0 1-.175-.032l-.179.178a.5.5 0 0 0-.11.168l-2 5a.5.5 0 0 0 .65.65l5-2a.5.5 0 0 0 .168-.11l.178-.178z"/>
                        </svg>
                    </button>
                    <button class="button button-small admin-action-btn" onclick="toggleServiceStatus(${service.id}, ${!service.is_active})">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                            <path d="M10.97 4.97a.235.235 0 0 0-.02.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-1.071-1.05z"/>
                        </svg>
                    </button>
                </td>
            `;

                    serviciosTable.appendChild(row);
                });
                updateServiceDropdowns();

                return data;
            } catch (error) {
                console.error('Error loading admin services:', error);
                utils.showToast('Error', 'Hubo un problema al cargar los servicios', 'error');
                return [];
            }
        }
        function updateServiceDropdowns() {
            const mediaServicio = document.getElementById('mediaServicio');
            if (mediaServicio) {
                mediaServicio.innerHTML = '<option value="">Ninguno (general)</option>';

                appData.services.forEach(service => {
                    if (service.is_active) {
                        const option = document.createElement('option');
                        option.value = service.id;
                        option.textContent = service.name;
                        mediaServicio.appendChild(option);
                    }
                });
            }
            const descuentoServicio = document.getElementById('descuentoServicio');
            if (descuentoServicio) {
                descuentoServicio.innerHTML = '<option value="">Seleccionar servicio</option>';

                appData.services.forEach(service => {
                    if (service.is_active) {
                        const option = document.createElement('option');
                        option.value = service.id;
                        option.textContent = service.name;
                        descuentoServicio.appendChild(option);
                    }
                });
            }
        }
        async function loadAdminAppointments(statusFilter = 'all') {
            try {
                let query = supabase
                    .from('appointments')
                    .select('*, services(name, base_price, work_minutes)')
                    .order('date', { ascending: true })
                    .order('start_time', { ascending: true });

                if (statusFilter !== 'all') {
                    query = query.eq('status', statusFilter);
                }

                const { data, error } = await query;

                if (error) throw error;

                appData.appointments = data;
                const appointmentsTable = document.getElementById('reservasTable')?.querySelector('tbody');
                if (!appointmentsTable) return;

                appointmentsTable.innerHTML = '';

                data.forEach(appointment => {
                    const formattedDate = utils.formatDate(appointment.date);
                    const formattedTime = `${utils.formatTime(appointment.start_time)} - ${utils.formatTime(appointment.end_time)}`;

                    const row = document.createElement('tr');

                    let statusClass = '';
                    let statusText = '';

                    switch (appointment.status) {
                        case 'PENDING':
                            statusClass = 'badge-warning';
                            statusText = 'Pendiente';
                            break;
                        case 'CONFIRMED':
                            statusClass = 'badge-success';
                            statusText = 'Confirmada';
                            break;
                        case 'CANCELLED':
                            statusClass = 'badge-error';
                            statusText = 'Cancelada';
                            break;
                    }

                    row.innerHTML = `
                <td>${appointment.id}</td>
                <td>${formattedDate}</td>
                <td>${formattedTime}</td>
                <td>${appointment.customer_name}</td>
                <td>${appointment.customer_phone}</td>
                <td>${appointment.services?.name || 'N/A'}</td>
                <td>
                    <span class="badge ${statusClass}">
                        ${statusText}
                    </span>
                </td>
                <td class="admin-table-actions">
                    ${appointment.status === 'PENDING' ? `
                        <button class="button button-small admin-action-btn" onclick="updateAppointmentStatus(${appointment.id}, 'CONFIRMED')">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                <path d="M10.97 4.97a.235.235 0 0 0-.02.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-1.071-1.05z"/>
                            </svg>
                        </button>
                    ` : ''}
                    ${appointment.status !== 'CANCELLED' ? `
                        <button class="button button-small admin-action-btn" onclick="updateAppointmentStatus(${appointment.id}, 'CANCELLED')">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"/>
                            </svg>
                        </button>
                    ` : ''}
                    <button class="button button-small admin-action-btn" onclick="sendWhatsAppReminder(${appointment.id})">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M13.601 2.326A7.854 7.854 0 0 0 7.994 0C3.627 0 .068 3.558.064 7.926c0 1.399.366 2.76 1.057 3.965L0 16l4.204-1.102a7.933 7.933 0 0 0 3.79.965h.004c4.368 0 7.926-3.558 7.93-7.93A7.898 7.898 0 0 0 13.6 2.326zM7.994 14.521a6.573 6.573 0 0 1-3.356-.92l-.24-.144-2.494.654.666-2.433-.156-.251a6.56 6.56 0 0 1-1.007-3.505c0-3.626 2.957-6.584 6.591-6.584a6.56 6.56 0 0 1 4.66 1.931 6.557 6.557 0 0 1 1.928 4.66c-.004 3.639-2.961 6.592-6.592 6.592zm3.615-4.934c-.197-.099-1.17-.578-1.353-.646-.182-.065-.315-.099-.445.099-.133.197-.513.646-.627.775-.114.133-.232.148-.43.05-.197-.1-.836-.308-1.592-.985-.59-.525-.985-1.175-1.103-1.372-.114-.198-.011-.304.088-.403.087-.088.197-.232.296-.346.1-.114.133-.198.198-.33.065-.134.034-.248-.015-.347-.05-.099-.445-1.076-.612-1.47-.16-.389-.323-.335-.445-.34-.114-.007-.247-.007-.38-.007a.729.729 0 0 0-.529.247c-.182.198-.691.677-.691 1.654 0 .977.71 1.916.81 2.049.098.133 1.394 2.132 3.383 2.992.47.205.84.326 1.129.418.475.152.904.129 1.246.08.38-.058 1.171-.48 1.338-.943.164-.464.164-.86.114-.943-.049-.084-.182-.133-.38-.232z"/>
                        </svg>
                    </button>
                </td>
            `;

                    appointmentsTable.appendChild(row);
                });
                updateAdminDashboardMetrics();

                return data;
            } catch (error) {
                console.error('Error loading admin appointments:', error);
                utils.showToast('Error', 'Hubo un problema al cargar las citas', 'error');
                return [];
            }
        }
        async function loadAdminReviews(approvedFilter = 'all') {
            try {
                let query = supabase
                    .from('reviews')
                    .select('*')
                    .order('created_at', { ascending: false });

                if (approvedFilter !== 'all') {
                    query = query.eq('is_approved', approvedFilter === 'true');
                }

                const { data, error } = await query;

                if (error) throw error;

                appData.reviews = data;
                const reviewsTable = document.getElementById('resenasTable')?.querySelector('tbody');
                if (!reviewsTable) return;

                reviewsTable.innerHTML = '';

                data.forEach(review => {
                    const formattedDate = utils.formatDate(review.created_at);
                    const stars = utils.generateStars(review.stars);

                    const row = document.createElement('tr');

                    row.innerHTML = `
                <td>${review.id}</td>
                <td>${formattedDate}</td>
                <td>${review.name}</td>
                <td>${stars}</td>
                <td>${review.comment}</td>
                <td>
                    <span class="badge ${review.is_approved ? 'badge-success' : 'badge-warning'}">
                        ${review.is_approved ? 'Aprobada' : 'Pendiente'}
                    </span>
                </td>
                <td class="admin-table-actions">
                    ${!review.is_approved ? `
                        <button class="button button-small admin-action-btn" onclick="approveReview(${review.id})">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                <path d="M10.97 4.97a.235.235 0 0 0-.02.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-1.071-1.05z"/>
                            </svg>
                        </button>
                    ` : ''}
                    <button class="button button-small admin-action-btn" onclick="deleteReview(${review.id})">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"/>
                            <path fill-rule="evenodd" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"/>
                        </svg>
                    </button>
                </td>
            `;

                    reviewsTable.appendChild(row);
                });
                const pendingReviewsCount = data.filter(r => !r.is_approved).length;
                const pendingReviewsElement = document.getElementById('resenasPendientes');
                if (pendingReviewsElement) {
                    pendingReviewsElement.textContent = pendingReviewsCount;
                }

                return data;
            } catch (error) {
                console.error('Error loading admin reviews:', error);
                utils.showToast('Error', 'Hubo un problema al cargar las reseñas', 'error');
                return [];
            }
        }
        async function loadAdminDiscounts() {
            try {
                const { data, error } = await supabase
                    .from('discounts')
                    .select('*, services(name)')
                    .order('date_start', { ascending: false });

                if (error) throw error;

                appData.discounts = data;
                const discountsTable = document.getElementById('descuentosTable')?.querySelector('tbody');
                if (!discountsTable) return;

                discountsTable.innerHTML = '';

                data.forEach(discount => {
                    const isActive = discount.is_active &&
                        new Date(discount.date_start) <= new Date() &&
                        new Date(discount.date_end) >= new Date();

                    const row = document.createElement('tr');

                    row.innerHTML = `
                <td>${discount.id}</td>
                <td>${discount.services?.name || 'N/A'}</td>
                <td>${discount.label}</td>
                <td>${discount.percent_off}%</td>
                <td>${utils.formatDate(discount.date_start)} - ${utils.formatDate(discount.date_end)}</td>
                <td>
                    <span class="badge ${isActive ? 'badge-success' : 'badge-error'}">
                        ${isActive ? 'Activo' : 'Inactivo'}
                    </span>
                </td>
                <td class="admin-table-actions">
                    <button class="button button-small admin-action-btn" onclick="editDiscount(${discount.id})">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M12.854.146a.5.5 0 0 0-.707 0L10.5 1.793 14.207 5.5l1.647-1.646a.5.5 0 0 0 0-.708l-3-3zm.646 6.061L9.793 2.5 3.293 9H3.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.207l6.5-6.5zm-7.468 7.468A.5.5 0 0 1 6 13.5V13h-.5a.5.5 0 0 1-.5-.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.5-.5V10h-.5a.499.499 0 0 1-.175-.032l-.179.178a.5.5 0 0 0-.11.168l-2 5a.5.5 0 0 0 .65.65l5-2a.5.5 0 0 0 .168-.11l.178-.178z"/>
                        </svg>
                    </button>
                    <button class="button button-small admin-action-btn" onclick="toggleDiscountStatus(${discount.id}, ${!discount.is_active})">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                            <path d="M10.97 4.97a.235.235 0 0 0-.02.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-1.071-1.05z"/>
                        </svg>
                    </button>
                    <button class="button button-small admin-action-btn" onclick="deleteDiscount(${discount.id})">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"/>
                            <path fill-rule="evenodd" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"/>
                        </svg>
                    </button>
                </td>
            `;

                    discountsTable.appendChild(row);
                });
                loadServicesAndPrices();

                return data;
            } catch (error) {
                console.error('Error loading admin discounts:', error);
                utils.showToast('Error', 'Hubo un problema al cargar los descuentos', 'error');
                return [];
            }
        }
        async function loadAdminMedia() {
            try {
                const { data, error } = await supabase
                    .from('media')
                    .select('*, services(name)')
                    .order('id', { ascending: false });

                if (error) throw error;

                appData.media = data;
                const mediaGrid = document.getElementById('mediaGrid');
                if (!mediaGrid) return;

                mediaGrid.innerHTML = '';

                data.forEach(item => {
                    const mediaCard = document.createElement('div');
                    mediaCard.className = 'card media-card';

                    mediaCard.innerHTML = `
                <img src="${item.url_storage}" alt="${item.services?.name || 'Imagen'}" loading="lazy" class="media-card-img">
                <div class="card-body">
                    <p class="media-card-title">${item.services?.name || 'Sin servicio asociado'}</p>
                    <div class="media-card-footer">
                        <span class="badge ${item.is_public ? 'badge-success' : 'badge-warning'}">
                            ${item.is_public ? 'Público' : 'Oculto'}
                        </span>
                        <div class="admin-table-actions">
                            <button class="button button-small admin-action-btn" onclick="toggleMediaVisibility(${item.id}, ${!item.is_public})">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                    <path d="M16 8s-3-5.5-8-5.5S0 8 0 8s3 5.5 8 5.5S16 8 16 8zM1.173 8a13.133 13.133 0 0 1 1.66-2.043C4.12 4.668 5.88 3.5 8 3.5c2.12 0 3.879 1.168 5.168 2.457A13.133 13.133 0 0 1 14.828 8c-.058.087-.122.183-.195.288-.335.48-.83 1.12-1.465 1.755C11.879 11.332 10.119 12.5 8 12.5c-2.12 0-3.879-1.168-5.168-2.457A13.134 13.134 0 0 1 1.172 8z"/>
                                    <path d="M8 5.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5zM4.5 8a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0z"/>
                                </svg>
                            </button>
                            <button class="button button-small admin-action-btn" onclick="deleteMedia(${item.id})">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                    <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"/>
                                    <path fill-rule="evenodd" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
            `;

                    mediaGrid.appendChild(mediaCard);
                });

                return data;
            } catch (error) {
                console.error('Error loading admin media:', error);
                utils.showToast('Error', 'Hubo un problema al cargar las imágenes', 'error');
                return [];
            }
        }
        async function loadAdminAvailability() {
            try {
                const { data, error } = await supabase
                    .from('availability')
                    .select('*')
                    .order('weekday');

                if (error) throw error;

                appData.availability = data;
                data.forEach(day => {
                    const dayName = getDayName(day.weekday).toLowerCase();
                    const openInput = document.getElementById(`${dayName}-open`);
                    const closeInput = document.getElementById(`${dayName}-close`);
                    const breakStartInput = document.getElementById(`${dayName}-break-start`);
                    const breakEndInput = document.getElementById(`${dayName}-break-end`);
                    const closedCheckbox = document.getElementById(`${dayName}-closed`);

                    if (openInput && closeInput && closedCheckbox) {
                        openInput.value = day.open_time ? day.open_time.substring(0, 5) : '';
                        closeInput.value = day.close_time ? day.close_time.substring(0, 5) : '';

                        if (breakStartInput && breakEndInput) {
                            breakStartInput.value = day.break_start ? day.break_start.substring(0, 5) : '';
                            breakEndInput.value = day.break_end ? day.break_end.substring(0, 5) : '';
                        }

                        closedCheckbox.checked = day.is_closed;
                        if (day.is_closed) {
                            openInput.disabled = true;
                            closeInput.disabled = true;
                            if (breakStartInput) breakStartInput.disabled = true;
                            if (breakEndInput) breakEndInput.disabled = true;
                        } else {
                            openInput.disabled = false;
                            closeInput.disabled = false;
                            if (breakStartInput) breakStartInput.disabled = false;
                            if (breakEndInput) breakEndInput.disabled = false;
                        }
                        closedCheckbox.addEventListener('change', function () {
                            openInput.disabled = this.checked;
                            closeInput.disabled = this.checked;
                            if (breakStartInput) breakStartInput.disabled = this.checked;
                            if (breakEndInput) breakEndInput.disabled = this.checked;
                        });
                    }
                });

                return data;
            } catch (error) {
                console.error('Error loading admin availability:', error);
                utils.showToast('Error', 'Hubo un problema al cargar la disponibilidad', 'error');
                return [];
            }
        }
        function getDayName(weekday) {
            const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
            return days[weekday];
        }
        async function loadAdminBlackouts() {
            try {
                const { data, error } = await supabase
                    .from('blackouts')
                    .select('*')
                    .order('date');

                if (error) throw error;

                appData.blackouts = data.map(b => ({
                    ...b,
                    date: (b.date || '').split('T')[0]
                }));
                const blackoutsTable = document.getElementById('blackoutsTable')?.querySelector('tbody');
                if (!blackoutsTable) return;

                blackoutsTable.innerHTML = '';

                appData.blackouts.forEach(blackout => {
                    const row = document.createElement('tr');

                    row.innerHTML = `
                <td>${blackout.id}</td>
                <td>${utils.formatDate(blackout.date)}</td>
                <td>${blackout.reason}</td>
                <td class="admin-table-actions">
                    <button class="button button-small admin-action-btn" onclick="deleteBlackout(${blackout.id})">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"/>
                            <path fill-rule="evenodd" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"/>
                        </svg>
                    </button>
                </td>
            `;

                    blackoutsTable.appendChild(row);
                });

                return appData.blackouts;
            } catch (error) {
                console.error('Error loading admin blackouts:', error);
                utils.showToast('Error', 'Hubo un problema al cargar los cierres', 'error');
                return [];
            }
        }
        function initAdminCharts() {
            ['chartIngresos', 'chartServicios', 'chartIngresosPorServicio', 'chartReservasPorDia', 'chartHorarioPopular'].forEach(chartId => {
                const existingChart = Chart.getChart(chartId);
                if (existingChart) {
                    existingChart.destroy();
                }
            });
            const ctxIngresos = document.getElementById('chartIngresos')?.getContext('2d');
            if (ctxIngresos) {
                const chartIngresos = new Chart(ctxIngresos, {
                    type: 'line',
                    data: {
                        labels: ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic'],
                        datasets: [{
                            label: 'Ingresos Mensuales',
                            data: calculateMonthlyIncome(),
                            backgroundColor: 'rgba(210, 121, 165, 0.2)',
                            borderColor: 'rgba(210, 121, 165, 1)',
                            borderWidth: 2,
                            tension: 0.4,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            },
                            tooltip: {
                                callbacks: {
                                    label: function (context) {
                                        return utils.formatCurrency(context.raw);
                                    }
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function (value) {
                                        return utils.formatCurrency(value);
                                    }
                                }
                            }
                        }
                    }
                });
                cache.charts.ingresos = chartIngresos;
            }
            const ctxServicios = document.getElementById('chartServicios')?.getContext('2d');
            if (ctxServicios) {
                const serviciosData = calculatePopularServices();
                const chartServicios = new Chart(ctxServicios, {
                    type: 'doughnut',
                    data: {
                        labels: serviciosData.labels,
                        datasets: [{
                            data: serviciosData.data,
                            backgroundColor: [
                                'rgba(210, 121, 165, 0.7)',
                                'rgba(248, 208, 186, 0.7)',
                                'rgba(212, 175, 55, 0.7)',
                                'rgba(130, 195, 230, 0.7)',
                                'rgba(102, 187, 138, 0.7)'
                            ],
                            borderColor: [
                                'rgba(210, 121, 165, 1)',
                                'rgba(248, 208, 186, 1)',
                                'rgba(212, 175, 55, 1)',
                                'rgba(130, 195, 230, 1)',
                                'rgba(102, 187, 138, 1)'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'right'
                            },
                            tooltip: {
                                callbacks: {
                                    label: function (context) {
                                        const label = context.label || '';
                                        const value = context.raw || 0;
                                        const total = context.dataset.data.reduce((acc, val) => acc + val, 0);
                                        const percentage = Math.round((value / total) * 100);
                                        return `${label}: ${value} (${percentage}%)`;
                                    }
                                }
                            }
                        }
                    }
                });
                cache.charts.servicios = chartServicios;
            }
            const ctxIngresosPorServicio = document.getElementById('chartIngresosPorServicio')?.getContext('2d');
            if (ctxIngresosPorServicio) {
                const ingresosPorServicioData = calculateIncomeByService();
                const chartIngresosPorServicio = new Chart(ctxIngresosPorServicio, {
                    type: 'bar',
                    data: {
                        labels: ingresosPorServicioData.labels,
                        datasets: [{
                            label: 'Ingresos por Servicio',
                            data: ingresosPorServicioData.data,
                            backgroundColor: 'rgba(210, 121, 165, 0.7)',
                            borderColor: 'rgba(210, 121, 165, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            },
                            tooltip: {
                                callbacks: {
                                    label: function (context) {
                                        return utils.formatCurrency(context.raw);
                                    }
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function (value) {
                                        return utils.formatCurrency(value);
                                    }
                                }
                            }
                        }
                    }
                });
                cache.charts.ingresosPorServicio = chartIngresosPorServicio;
            }
            const ctxReservasPorDia = document.getElementById('chartReservasPorDia')?.getContext('2d');
            if (ctxReservasPorDia) {
                const reservasPorDiaData = calculateBookingsByDay();
                const chartReservasPorDia = new Chart(ctxReservasPorDia, {
                    type: 'bar',
                    data: {
                        labels: ['Domingo', 'Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado'],
                        datasets: [{
                            label: 'Reservas por Día',
                            data: reservasPorDiaData,
                            backgroundColor: 'rgba(248, 208, 186, 0.7)',
                            borderColor: 'rgba(248, 208, 186, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    stepSize: 1
                                }
                            }
                        }
                    }
                });
                cache.charts.reservasPorDia = chartReservasPorDia;
            }
            const ctxHorarioPopular = document.getElementById('chartHorarioPopular')?.getContext('2d');
            if (ctxHorarioPopular) {
                const horarioPopularData = calculatePopularTimeSlots();
                const chartHorarioPopular = new Chart(ctxHorarioPopular, {
                    type: 'line',
                    data: {
                        labels: horarioPopularData.labels,
                        datasets: [{
                            label: 'Reservas por Horario',
                            data: horarioPopularData.data,
                            backgroundColor: 'rgba(130, 195, 230, 0.2)',
                            borderColor: 'rgba(130, 195, 230, 1)',
                            borderWidth: 2,
                            tension: 0.4,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    stepSize: 1
                                }
                            }
                        }
                    }
                });
                cache.charts.horarioPopular = chartHorarioPopular;
            }
            const ctxKPIs = document.getElementById('chartKPIs')?.getContext('2d');
            if (ctxKPIs) {
                const kpiData = calculateKPIs();
                const chartKPIs = new Chart(ctxKPIs, {
                    type: 'radar',
                    data: {
                        labels: ['Reservas', 'Ingresos', 'Clientes Nuevos', 'Reseñas', 'Tasa de Ocupación'],
                        datasets: [{
                            label: 'Este Mes',
                            data: kpiData.thisMonth,
                            backgroundColor: 'rgba(210, 121, 165, 0.2)',
                            borderColor: 'rgba(210, 121, 165, 1)',
                            borderWidth: 2,
                            pointBackgroundColor: 'rgba(210, 121, 165, 1)'
                        }, {
                            label: 'Mes Anterior',
                            data: kpiData.lastMonth,
                            backgroundColor: 'rgba(130, 195, 230, 0.2)',
                            borderColor: 'rgba(130, 195, 230, 1)',
                            borderWidth: 2,
                            pointBackgroundColor: 'rgba(130, 195, 230, 1)'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            r: {
                                angleLines: {
                                    display: true
                                },
                                suggestedMin: 0,
                                suggestedMax: 100
                            }
                        }
                    }
                });
                cache.charts.kpis = chartKPIs;
            }
        }
        function calculateKPIs() {
            const now = new Date();
            const currentMonth = now.getMonth();
            const currentYear = now.getFullYear();
            const currentMonthStart = new Date(currentYear, currentMonth, 1);
            const currentMonthEnd = new Date(currentYear, currentMonth + 1, 0);
            const lastMonth = currentMonth === 0 ? 11 : currentMonth - 1;
            const lastMonthYear = currentMonth === 0 ? currentYear - 1 : currentYear;
            const lastMonthStart = new Date(lastMonthYear, lastMonth, 1);
            const lastMonthEnd = new Date(lastMonthYear, lastMonth + 1, 0);
            const thisMonthAppointments = appData.appointments.filter(a =>
                a.status !== 'CANCELLED' &&
                new Date(a.date) >= currentMonthStart &&
                new Date(a.date) <= currentMonthEnd
            );

            const lastMonthAppointments = appData.appointments.filter(a =>
                a.status !== 'CANCELLED' &&
                new Date(a.date) >= lastMonthStart &&
                new Date(a.date) <= lastMonthEnd
            );
            const thisMonthIncome = calculateMonthIncome(thisMonthAppointments);
            const lastMonthIncome = calculateMonthIncome(lastMonthAppointments);
            const maxIncome = Math.max(
                ...Array.from({ length: 12 }, (_, i) => {
                    const monthAppointments = appData.appointments.filter(a =>
                        a.status !== 'CANCELLED' &&
                        new Date(a.date).getMonth() === i &&
                        new Date(a.date).getFullYear() === currentYear
                    );
                    return calculateMonthIncome(monthAppointments);
                })
            ) || 1;
            const thisMonthAppointmentsCount = thisMonthAppointments.length;
            const lastMonthAppointmentsCount = lastMonthAppointments.length;
            const maxAppointments = Math.max(thisMonthAppointmentsCount, lastMonthAppointmentsCount, 1);
            const allClients = new Set();
            const thisMonthNewClients = countNewClients(thisMonthAppointments, allClients);
            const lastMonthNewClients = countNewClients(lastMonthAppointments, allClients);
            const maxNewClients = Math.max(thisMonthNewClients, lastMonthNewClients, 1);
            const thisMonthReviews = appData.reviews.filter(r =>
                new Date(r.created_at) >= currentMonthStart &&
                new Date(r.created_at) <= currentMonthEnd
            ).length;

            const lastMonthReviews = appData.reviews.filter(r =>
                new Date(r.created_at) >= lastMonthStart &&
                new Date(r.created_at) <= lastMonthEnd
            ).length;

            const maxReviews = Math.max(thisMonthReviews, lastMonthReviews, 1);
            const thisMonthOccupancy = calculateOccupancyRate(thisMonthAppointments, currentMonthStart, currentMonthEnd);
            const lastMonthOccupancy = calculateOccupancyRate(lastMonthAppointments, lastMonthStart, lastMonthEnd);
            return {
                thisMonth: [
                    (thisMonthAppointmentsCount / maxAppointments) * 100,
                    (thisMonthIncome / maxIncome) * 100,
                    (thisMonthNewClients / maxNewClients) * 100,
                    (thisMonthReviews / maxReviews) * 100,
                    thisMonthOccupancy
                ],
                lastMonth: [
                    (lastMonthAppointmentsCount / maxAppointments) * 100,
                    (lastMonthIncome / maxIncome) * 100,
                    (lastMonthNewClients / maxNewClients) * 100,
                    (lastMonthReviews / maxReviews) * 100,
                    lastMonthOccupancy
                ]
            };
        }
        function calculateOccupancyRate(appointments, startDate, endDate) {
            let workingDays = 0;
            let currentDate = new Date(startDate);

            while (currentDate <= endDate) {
                const dayOfWeek = currentDate.getDay();
                if (!utils.isDayClosed(dayOfWeek)) {
                    workingDays++;
                }
                currentDate.setDate(currentDate.getDate() + 1);
            }
            const availabilityData = appData.availability.filter(a => !a.is_closed);
            let averageSlotsPerDay = 0;

            if (availabilityData.length > 0) {
                const slotsPerDay = availabilityData.map(day => {
                    const openMinutes = timeToMinutes(day.open_time);
                    const closeMinutes = timeToMinutes(day.close_time);
                    const breakStartMinutes = day.break_start ? timeToMinutes(day.break_start) : null;
                    const breakEndMinutes = day.break_end ? timeToMinutes(day.break_end) : null;

                    const totalMinutes = closeMinutes - openMinutes -
                        (breakStartMinutes && breakEndMinutes ? breakEndMinutes - breakStartMinutes : 0);

                    const slotMinutes = parseInt(day.slot_minutes || 30);
                    return Math.floor(totalMinutes / slotMinutes);
                });

                averageSlotsPerDay = slotsByDay.reduce((sum, slots) => sum + slots, 0) / slotsByDay.length;
            } else {
                averageSlotsPerDay = 16;
            }
            const totalAvailableSlots = workingDays * averageSlotsPerDay;
            return totalAvailableSlots > 0
                ? Math.min(100, (appointments.length / totalAvailableSlots) * 100)
                : 0;
        }
        function countNewClients(appointments, allClientsSet) {
            const existingClientsCount = allClientsSet.size;

            appointments.forEach(appointment => {
                allClientsSet.add(appointment.customer_phone);
            });

            return allClientsSet.size - existingClientsCount;
        }
        function calculateMonthIncome(appointments) {
            let totalIncome = 0;

            appointments.forEach(appointment => {
                const service = appData.services.find(s => s.id === appointment.service_id);

                if (service) {
                    const dateAppointment = new Date(appointment.date);
                    const activeDiscounts = appData.discounts.filter(d =>
                        d.service_id === service.id &&
                        d.is_active &&
                        new Date(d.date_start) <= dateAppointment &&
                        new Date(d.date_end) >= dateAppointment
                    );

                    const hasDiscount = activeDiscounts.length > 0;
                    const discount = hasDiscount ? activeDiscounts[0] : null;
                    const finalPrice = hasDiscount
                        ? Math.round(service.base_price * (1 - discount.percent_off / 100))
                        : service.base_price;

                    totalIncome += finalPrice;
                }
            });

            return totalIncome;
        }
        function calculateMonthlyIncome() {
            const now = new Date();
            const currentYear = now.getFullYear();
            const monthlyIncome = Array(12).fill(0);

            appData.appointments
                .filter(a => a.status !== 'CANCELLED' && new Date(a.date).getFullYear() === currentYear)
                .forEach(appointment => {
                    const month = new Date(appointment.date).getMonth();
                    const service = appData.services.find(s => s.id === appointment.service_id);

                    if (service) {
                        const dateAppointment = new Date(appointment.date);
                        const activeDiscounts = appData.discounts.filter(d =>
                            d.service_id === service.id &&
                            d.is_active &&
                            new Date(d.date_start) <= dateAppointment &&
                            new Date(d.date_end) >= dateAppointment
                        );

                        const hasDiscount = activeDiscounts.length > 0;
                        const discount = hasDiscount ? activeDiscounts[0] : null;
                        const finalPrice = hasDiscount
                            ? Math.round(service.base_price * (1 - discount.percent_off / 100))
                            : service.base_price;

                        monthlyIncome[month] += finalPrice;
                    }
                });

            return monthlyIncome;
        }
        function calculatePopularServices() {
            const serviceCount = {};
            const confirmedAppointments = appData.appointments.filter(a => a.status !== 'CANCELLED');

            confirmedAppointments.forEach(appointment => {
                const serviceId = appointment.service_id;
                serviceCount[serviceId] = (serviceCount[serviceId] || 0) + 1;
            });
            const sortedServices = Object.entries(serviceCount)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 5);

            const labels = sortedServices.map(([serviceId]) => {
                const service = appData.services.find(s => s.id == serviceId);
                return service ? service.name : 'Desconocido';
            });

            const data = sortedServices.map(([_, count]) => count);
            if (sortedServices.length > 0) {
                const topServiceId = sortedServices[0][0];
                const topService = appData.services.find(s => s.id == topServiceId);
                const topServiceCount = sortedServices[0][1];
                const topServicePercent = Math.round((topServiceCount / confirmedAppointments.length) * 100);

                const servicioPopularElement = document.getElementById('servicioPopular');
                const servicioPopularPercentElement = document.getElementById('servicioPopularPercent');

                if (servicioPopularElement) {
                    servicioPopularElement.textContent = topService ? topService.name : 'Ninguno';
                }

                if (servicioPopularPercentElement) {
                    servicioPopularPercentElement.textContent = `${topServicePercent}% del total`;
                }
            }

            return { labels, data };
        }
        function calculateIncomeByService() {
            const serviceIncome = {};

            appData.appointments
                .filter(a => a.status !== 'CANCELLED')
                .forEach(appointment => {
                    const serviceId = appointment.service_id;
                    const service = appData.services.find(s => s.id === serviceId);

                    if (service) {
                        const dateAppointment = new Date(appointment.date);
                        const activeDiscounts = appData.discounts.filter(d =>
                            d.service_id === service.id &&
                            d.is_active &&
                            new Date(d.date_start) <= dateAppointment &&
                            new Date(d.date_end) >= dateAppointment
                        );

                        const hasDiscount = activeDiscounts.length > 0;
                        const discount = hasDiscount ? activeDiscounts[0] : null;
                        const finalPrice = hasDiscount
                            ? Math.round(service.base_price * (1 - discount.percent_off / 100))
                            : service.base_price;

                        serviceIncome[serviceId] = (serviceIncome[serviceId] || 0) + finalPrice;
                    }
                });
            const sortedServices = Object.entries(serviceIncome)
                .sort((a, b) => b[1] - a[1]);

            const labels = sortedServices.map(([serviceId]) => {
                const service = appData.services.find(s => s.id == serviceId);
                return service ? service.name : 'Desconocido';
            });

            const data = sortedServices.map(([_, income]) => income);

            return { labels, data };
        }
        function calculateBookingsByDay() {
            const dayCount = Array(7).fill(0);

            appData.appointments
                .filter(a => a.status !== 'CANCELLED')
                .forEach(appointment => {
                    const dayOfWeek = new Date(appointment.date).getDay();
                    dayCount[dayOfWeek]++;
                });

            return dayCount;
        }
        function calculatePopularTimeSlots() {
            const timeSlots = {};

            appData.appointments
                .filter(a => a.status !== 'CANCELLED')
                .forEach(appointment => {
                    const hour = appointment.start_time.substring(0, 2);
                    timeSlots[hour] = (timeSlots[hour] || 0) + 1;
                });
            const labels = [];
            const data = [];

            for (let i = 9; i <= 20; i++) {
                const hour = i.toString().padStart(2, '0');
                labels.push(`${hour}:00`);
                data.push(timeSlots[hour] || 0);
            }

            return { labels, data };
        }
        function updateAdminDashboardMetrics() {
            const now = new Date();
            const currentMonth = now.getMonth();
            const currentYear = now.getFullYear();

            const currentMonthAppointments = appData.appointments.filter(a =>
                a.status !== 'CANCELLED' &&
                new Date(a.date).getMonth() === currentMonth &&
                new Date(a.date).getFullYear() === currentYear
            );

            const reservasMensualesElement = document.getElementById('reservasMensuales');
            if (reservasMensualesElement) {
                reservasMensualesElement.textContent = currentMonthAppointments.length;
            }
            const prevMonth = currentMonth === 0 ? 11 : currentMonth - 1;
            const prevMonthYear = currentMonth === 0 ? currentYear - 1 : currentYear;

            const prevMonthAppointments = appData.appointments.filter(a =>
                a.status !== 'CANCELLED' &&
                new Date(a.date).getMonth() === prevMonth &&
                new Date(a.date).getFullYear() === prevMonthYear
            );
            let changePercent = 0;
            if (prevMonthAppointments.length > 0) {
                changePercent = Math.round(
                    ((currentMonthAppointments.length - prevMonthAppointments.length) / prevMonthAppointments.length) * 100
                );
            }

            const reservasChange = document.getElementById('reservasChange');
            const reservasChangePercent = document.getElementById('reservasChangePercent');

            if (reservasChange && reservasChangePercent) {
                if (changePercent >= 0) {
                    reservasChange.classList.remove('negative');
                    reservasChange.classList.add('positive');
                    reservasChangePercent.textContent = `+${changePercent}%`;
                    reservasChange.querySelector('svg').innerHTML = `
                <path fill-rule="evenodd" d="M8 12a.5.5 0 0 0 .5-.5V5.707l2.146 2.147a.5.5 0 0 0 .708-.708l-3-3a.5.5 0 0 0-.708 0l-3 3a.5.5 0 1 0 .708.708L7.5 5.707V11.5a.5.5 0 0 0 .5.5z"/>
            `;
                } else {
                    reservasChange.classList.remove('positive');
                    reservasChange.classList.add('negative');
                    reservasChangePercent.textContent = `${changePercent}%`;
                    reservasChange.querySelector('svg').innerHTML = `
                <path fill-rule="evenodd" d="M8 4a.5.5 0 0 1 .5.5v5.793l2.146-2.147a.5.5 0 0 1 .708.708l-3 3a.5.5 0 0 1-.708 0l-3-3a.5.5 0 1 1 .708-.708L7.5 10.293V4.5A.5.5 0 0 1 8 4z"/>
            `;
                }
            }
            let currentMonthIncome = 0;

            currentMonthAppointments.forEach(appointment => {
                const service = appData.services.find(s => s.id === appointment.service_id);

                if (service) {
                    const dateAppointment = new Date(appointment.date);
                    const activeDiscounts = appData.discounts.filter(d =>
                        d.service_id === service.id &&
                        d.is_active &&
                        new Date(d.date_start) <= dateAppointment &&
                        new Date(d.date_end) >= dateAppointment
                    );

                    const hasDiscount = activeDiscounts.length > 0;
                    const discount = hasDiscount ? activeDiscounts[0] : null;
                    const finalPrice = hasDiscount
                        ? Math.round(service.base_price * (1 - discount.percent_off / 100))
                        : service.base_price;

                    currentMonthIncome += finalPrice;
                }
            });

            const ingresosMensualesElement = document.getElementById('ingresosMensuales');
            if (ingresosMensualesElement) {
                ingresosMensualesElement.textContent = utils.formatCurrency(currentMonthIncome);
            }
            let prevMonthIncome = 0;

            prevMonthAppointments.forEach(appointment => {
                const service = appData.services.find(s => s.id === appointment.service_id);

                if (service) {
                    const dateAppointment = new Date(appointment.date);
                    const activeDiscounts = appData.discounts.filter(d =>
                        d.service_id === service.id &&
                        d.is_active &&
                        new Date(d.date_start) <= dateAppointment &&
                        new Date(d.date_end) >= dateAppointment
                    );

                    const hasDiscount = activeDiscounts.length > 0;
                    const discount = hasDiscount ? activeDiscounts[0] : null;
                    const finalPrice = hasDiscount
                        ? Math.round(service.base_price * (1 - discount.percent_off / 100))
                        : service.base_price;

                    prevMonthIncome += finalPrice;
                }
            });
            let incomeChangePercent = 0;
            if (prevMonthIncome > 0) {
                incomeChangePercent = Math.round(
                    ((currentMonthIncome - prevMonthIncome) / prevMonthIncome) * 100
                );
            }

            const ingresosChange = document.getElementById('ingresosChange');
            const ingresosChangePercent = document.getElementById('ingresosChangePercent');

            if (ingresosChange && ingresosChangePercent) {
                if (incomeChangePercent >= 0) {
                    ingresosChange.classList.remove('negative');
                    ingresosChange.classList.add('positive');
                    ingresosChangePercent.textContent = `+${incomeChangePercent}%`;
                    ingresosChange.querySelector('svg').innerHTML = `
                <path fill-rule="evenodd" d="M8 12a.5.5 0 0 0 .5-.5V5.707l2.146 2.147a.5.5 0 0 0 .708-.708l-3-3a.5.5 0 0 0-.708 0l-3 3a.5.5 0 1 0 .708.708L7.5 5.707V11.5a.5.5 0 0 0 .5.5z"/>
            `;
                } else {
                    ingresosChange.classList.remove('positive');
                    ingresosChange.classList.add('negative');
                    ingresosChangePercent.textContent = `${incomeChangePercent}%`;
                    ingresosChange.querySelector('svg').innerHTML = `
                <path fill-rule="evenodd" d="M8 4a.5.5 0 0 1 .5.5v5.793l2.146-2.147a.5.5 0 0 1 .708.708l-3 3a.5.5 0 0 1-.708 0l-3-3a.5.5 0 1 1 .708-.708L7.5 10.293V4.5A.5.5 0 0 1 8 4z"/>
            `;
                }
            }
            const lastMonth = new Date();
            lastMonth.setMonth(lastMonth.getMonth() - 1);
            let totalIncome = 0;
            appData.appointments
                .filter(a => a.status !== 'CANCELLED')
                .forEach(appointment => {
                    const service = appData.services.find(s => s.id === appointment.service_id);

                    if (service) {
                        const dateAppointment = new Date(appointment.date);
                        const activeDiscounts = appData.discounts.filter(d =>
                            d.service_id === service.id &&
                            d.is_active &&
                            new Date(d.date_start) <= dateAppointment &&
                            new Date(d.date_end) >= dateAppointment
                        );

                        const hasDiscount = activeDiscounts.length > 0;
                        const discount = hasDiscount ? activeDiscounts[0] : null;
                        const finalPrice = hasDiscount
                            ? Math.round(service.base_price * (1 - discount.percent_off / 100))
                            : service.base_price;

                        totalIncome += finalPrice;
                    }
                });

            const metricaIngresoTotalElement = document.getElementById('metricaIngresoTotal');
            if (metricaIngresoTotalElement) {
                metricaIngresoTotalElement.textContent = utils.formatCurrency(totalIncome);
            }
            const uniqueClients = new Set();
            appData.appointments
                .filter(a => a.status !== 'CANCELLED')
                .forEach(appointment => {
                    uniqueClients.add(appointment.customer_phone);
                });

            const metricaClientesTotalElement = document.getElementById('metricaClientesTotal');
            if (metricaClientesTotalElement) {
                metricaClientesTotalElement.textContent = uniqueClients.size;
            }
            const totalAppointments = appData.appointments.length;
            const cancelledAppointments = appData.appointments.filter(a => a.status === 'CANCELLED').length;

            const cancellationRate = totalAppointments > 0
                ? Math.round((cancelledAppointments / totalAppointments) * 100)
                : 0;

            const metricaCancelacionRateElement = document.getElementById('metricaCancelacionRate');
            if (metricaCancelacionRateElement) {
                metricaCancelacionRateElement.textContent = `${cancellationRate}%`;
            }
            const approvedReviews = appData.reviews.filter(r => r.is_approved);

            const metricaRatingPromedioElement = document.getElementById('metricaRatingPromedio');
            if (metricaRatingPromedioElement) {
                if (approvedReviews.length > 0) {
                    const totalStars = approvedReviews.reduce((acc, review) => acc + review.stars, 0);
                    const averageRating = (totalStars / approvedReviews.length).toFixed(1);
                    metricaRatingPromedioElement.textContent = averageRating;
                } else {
                    metricaRatingPromedioElement.textContent = 'N/A';
                }
            }
            appData.stats = {
                monthlyIncome: currentMonthIncome,
                monthlyAppointments: currentMonthAppointments.length,
                totalClients: uniqueClients.size,
                averageRating: approvedReviews.length > 0
                    ? (approvedReviews.reduce((acc, review) => acc + review.stars, 0) / approvedReviews.length).toFixed(1)
                    : 0
            };
        }
        function setupAdminEventHandlers() {
            if (adminEventListenersInitialized) return;
            adminEventListenersInitialized = true;
            document.querySelectorAll('#adminReservas .admin-tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    document.querySelectorAll('#adminReservas .admin-tab').forEach(t => {
                        t.classList.remove('active');
                    });
                    tab.classList.add('active');
                    const status = tab.getAttribute('data-status');
                    loadAdminAppointments(status);
                });
            });
            const refreshReservasBtn = document.getElementById('refreshReservas');
            if (refreshReservasBtn) {
                refreshReservasBtn.addEventListener('click', () => {
                    const activeTab = document.querySelector('#adminReservas .admin-tab.active');
                    const status = activeTab ? activeTab.getAttribute('data-status') : 'all';
                    loadAdminAppointments(status);
                });
            }
            const exportReservasBtn = document.getElementById('exportReservas');
            if (exportReservasBtn) {
                exportReservasBtn.addEventListener('click', () => {
                    exportAppointmentsToCSV();
                });
            }
            document.querySelectorAll('#adminResenas .admin-tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    document.querySelectorAll('#adminResenas .admin-tab').forEach(t => {
                        t.classList.remove('active');
                    });
                    tab.classList.add('active');
                    const approved = tab.getAttribute('data-approved');
                    loadAdminReviews(approved);
                });
            });
            const refreshResenasBtn = document.getElementById('refreshResenas');
            if (refreshResenasBtn) {
                refreshResenasBtn.addEventListener('click', () => {
                    const activeTab = document.querySelector('#adminResenas .admin-tab.active');
                    const approved = activeTab ? activeTab.getAttribute('data-approved') : 'all';
                    loadAdminReviews(approved);
                });
            }
            const refreshDashboardBtn = document.getElementById('refreshDashboard');
            if (refreshDashboardBtn) {
                refreshDashboardBtn.addEventListener('click', () => {
                    initAdminPanel();
                });
            }
            document.querySelectorAll('#adminDisponibilidad .admin-tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    document.querySelectorAll('#adminDisponibilidad .admin-tab').forEach(t => {
                        t.classList.remove('active');
                    });
                    tab.classList.add('active');
                    const tabId = tab.getAttribute('data-tab');
                    document.querySelectorAll('#adminDisponibilidad .tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    const tabContentElement = document.getElementById(`${tabId}Content`);
                    if (tabContentElement) {
                        tabContentElement.classList.add('active');
                    }
                });
            });
            const availabilityForm = document.getElementById('availabilityForm');
            if (availabilityForm) {
                availabilityForm.addEventListener('submit', async (e) => {
                    e.preventDefault();

                    try {
                        const submitBtn = e.target.querySelector('button[type="submit"]');
                        if (submitBtn) submitBtn.disabled = true;
                        const days = ['sunday', 'monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday'];

                        for (let i = 0; i < days.length; i++) {
                            const day = days[i];
                            const openInput = document.getElementById(`${day}-open`);
                            const closeInput = document.getElementById(`${day}-close`);
                            const breakStartInput = document.getElementById(`${day}-break-start`);
                            const breakEndInput = document.getElementById(`${day}-break-end`);
                            const slotMinutesInput = document.getElementById(`${day}-slot-minutes`);
                            const closedCheckbox = document.getElementById(`${day}-closed`);

                            if (openInput && closeInput && closedCheckbox) {
                                const { data: existingData, error: checkError } = await supabase
                                    .from('availability')
                                    .select('id')
                                    .eq('weekday', i);

                                if (checkError) throw checkError;

                                const update = {
                                    weekday: i,
                                    open_time: openInput.value ? openInput.value + ':00' : '09:00:00',
                                    close_time: closeInput.value ? closeInput.value + ':00' : '18:00:00',
                                    break_start: breakStartInput?.value ? breakStartInput.value + ':00' : null,
                                    break_end: breakEndInput?.value ? breakEndInput.value + ':00' : null,
                                    slot_minutes: slotMinutesInput?.value || 30,
                                    is_closed: closedCheckbox.checked
                                };

                                if (existingData && existingData.length > 0) {
                                    const { error: updateError } = await supabase
                                        .from('availability')
                                        .update(update)
                                        .eq('id', existingData[0].id);

                                    if (updateError) throw updateError;
                                } else {
                                    const { error: insertError } = await supabase
                                        .from('availability')
                                        .insert([update]);

                                    if (insertError) throw insertError;
                                }
                            }
                        }

                        utils.showToast('Éxito', 'Horario actualizado correctamente', 'success');
                        await loadAdminAvailability();
                        await loadAvailability();
                        if (submitBtn) submitBtn.disabled = false;
                    } catch (error) {
                        console.error('Error updating availability:', error);
                        utils.showToast('Error', 'Hubo un problema al actualizar el horario', 'error');
                        const submitBtn = e.target.querySelector('button[type="submit"]');
                        if (submitBtn) submitBtn.disabled = false;
                    }
                });
            }
            const blackoutAddForm = document.getElementById('blackoutAddForm');
            if (blackoutAddForm) {
                blackoutAddForm.addEventListener('submit', async (e) => {
                    e.preventDefault();

                    const date = document.getElementById('blackoutDate').value;
                    const reason = document.getElementById('blackoutReason').value;

                    if (!date || !reason) {
                        utils.showToast('Error', 'Completa todos los campos', 'error');
                        return;
                    }

                    try {
                        const submitBtn = e.target.querySelector('button[type="submit"]');
                        if (submitBtn) submitBtn.disabled = true;
                        const { data: existing } = await supabase
                            .from('blackouts')
                            .select('id')
                            .eq('date', date);
                        if (existing && existing.length) {
                            utils.showToast('Error', 'La fecha ya está registrada', 'error');
                            if (submitBtn) submitBtn.disabled = false;
                            return;
                        }
                        const { error } = await supabase
                            .from('blackouts')
                            .insert([{ date, reason }]);
                        if (error) throw error;
                        utils.showToast('Éxito', 'Cierre añadido correctamente', 'success');
                        e.target.reset();
                        await loadAdminBlackouts();
                        await loadBlackoutDates();
                        if (submitBtn) submitBtn.disabled = false;
                    } catch (error) {
                        console.error('Error adding blackout:', error);
                        utils.showToast('Error', 'Hubo un problema al añadir el cierre', 'error');
                        const submitBtn = e.target.querySelector('button[type="submit"]');
                        if (submitBtn) submitBtn.disabled = false;
                    }
                });
            }
            const addServicioBtn = document.getElementById('addServicio');
            if (addServicioBtn) {
                addServicioBtn.addEventListener('click', () => {
                    const servicioFormTitle = document.getElementById('servicioFormTitle');
                    const servicioSubmitText = document.getElementById('servicioSubmitText');
                    const servicioEditForm = document.getElementById('servicioEditForm');
                    const servicioId = document.getElementById('servicioId');
                    const servicioActivo = document.getElementById('servicioActivo');
                    const servicioForm = document.getElementById('servicioForm');

                    if (servicioFormTitle) servicioFormTitle.textContent = 'Nuevo Servicio';
                    if (servicioSubmitText) servicioSubmitText.textContent = 'Guardar Servicio';
                    if (servicioEditForm) servicioEditForm.reset();
                    if (servicioId) servicioId.value = '';
                    if (servicioActivo) servicioActivo.checked = true;
                    if (servicioForm) servicioForm.style.display = 'block';
                });
            }
            const cancelServicioFormBtn = document.getElementById('cancelServicioForm');
            if (cancelServicioFormBtn) {
                cancelServicioFormBtn.addEventListener('click', () => {
                    const servicioForm = document.getElementById('servicioForm');
                    if (servicioForm) servicioForm.style.display = 'none';
                });
            }
            const servicioEditForm = document.getElementById('servicioEditForm');
            if (servicioEditForm) {
                servicioEditForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    const submitButton = e.target.querySelector('button[type="submit"]');
                    if (submitButton) submitButton.disabled = true;

                    try {
                        const servicioId = document.getElementById('servicioId').value;
                        const nombre = document.getElementById('servicioNombre').value;
                        const categoria = document.getElementById('servicioCategoria').value;
                        const efecto = document.getElementById('servicioEfecto').value;
                        const minutos = parseInt(document.getElementById('servicioMinutos').value);
                        const duracion = parseInt(document.getElementById('servicioDuracion').value) || null;
                        const basePrecio = parseInt(document.getElementById('servicioBasePrecio').value);
                        const retoquePrecio = parseInt(document.getElementById('servicioRetoquePrecio').value) || null;
                        const descripcion = document.getElementById('servicioDescripcion').value;
                        const activo = document.getElementById('servicioActivo').checked;
                        const fileInput = document.getElementById('servicioImagen');
                        if (!servicioId) {
                            const { data: existingServices, error: checkError } = await supabase
                                .from('services')
                                .select('id')
                                .eq('name', nombre)
                                .eq('category', categoria)
                                .eq('effect', efecto);

                            if (checkError) throw checkError;

                            if (existingServices && existingServices.length > 0) {
                                utils.showToast('Error', 'Ya existe un servicio con el mismo nombre y categoría', 'error');
                                if (submitButton) submitButton.disabled = false;
                                return;
                            }
                        }

                        let data, error;

                        if (servicioId) {
                            ({ data, error } = await supabase
                                .from('services')
                                .update({
                                    name: nombre,
                                    category: categoria,
                                    effect: efecto,
                                    work_minutes: minutos,
                                    result_duration_days: duracion,
                                    base_price: basePrecio,
                                    retouch_price: retoquePrecio,
                                    description: descripcion,
                                    is_active: activo
                                })
                                .eq('id', servicioId)
                                .select());
                        } else {
                            ({ data, error } = await supabase
                                .from('services')
                                .insert([{
                                    name: nombre,
                                    category: categoria,
                                    effect: efecto,
                                    work_minutes: minutos,
                                    result_duration_days: duracion,
                                    base_price: basePrecio,
                                    retouch_price: retoquePrecio,
                                    description: descripcion,
                                    is_active: activo
                                }])
                                .select());
                        }

                        if (error) throw error;
                        if (fileInput && fileInput.files && fileInput.files.length > 0) {
                            const file = fileInput.files[0];
                            const serviceIdToUse = servicioId || (data && data[0] ? data[0].id : null);

                            if (!serviceIdToUse) {
                                throw new Error('No se pudo obtener ID del servicio');
                            }
                            const timestamp = new Date().getTime();
                            const fileExt = file.name.split('.').pop();
                            const fileName = `${timestamp}.${fileExt}`;
                            const filePath = `service_${serviceIdToUse}_${fileName}`;

                            console.log('Uploading to bucket: pinky-portfolio, path:', filePath);
                            const { data: storageData, error: storageError } = await supabase.storage
                                .from('pinky-portfolio')
                                .upload(filePath, file, {
                                    cacheControl: '3600',
                                    upsert: false
                                });

                            if (storageError) {
                                console.error('Storage error:', storageError);
                                throw storageError;
                            }

                            console.log('Upload successful:', storageData);
                            const { data: urlData } = supabase.storage
                                .from('pinky-portfolio')
                                .getPublicUrl(filePath);

                            console.log('Public URL:', urlData);
                            const { error: mediaError } = await supabase
                                .from('media')
                                .insert([{
                                    service_id: serviceIdToUse,
                                    url_storage: urlData.publicUrl,
                                    is_public: true
                                }]);

                            if (mediaError) {
                                console.error('Media error:', mediaError);
                                throw mediaError;
                            }

                            console.log('Media record created successfully');
                        } else if (!servicioId) {
                            console.warn('Servicio creado sin imagen. Los clientes verán un placeholder.');
                        }

                        const message = servicioId ? 'Servicio actualizado correctamente' : 'Servicio creado correctamente';
                        const imageMessage = fileInput && fileInput.files && fileInput.files.length > 0 ? ' con imagen' : '';
                        utils.showToast('Éxito', `${message}${imageMessage}`, 'success');
                        document.getElementById('servicioForm').style.display = 'none';
                        await Promise.all([
                            loadAdminServices(),
                            loadAdminMedia(),
                            loadLashbook()
                        ]);

                        loadServicesAndPrices();
                    } catch (error) {
                        console.error('Error saving service:', error);
                        utils.showToast('Error', 'Hubo un problema al guardar el servicio: ' + error.message, 'error');
                    } finally {
                        if (submitButton) submitButton.disabled = false;
                    }
                });
            }
            const addDescuentoBtn = document.getElementById('addDescuento');
            if (addDescuentoBtn) {
                addDescuentoBtn.addEventListener('click', () => {
                    const descuentoFormTitle = document.getElementById('descuentoFormTitle');
                    const descuentoSubmitText = document.getElementById('descuentoSubmitText');
                    const descuentoEditForm = document.getElementById('descuentoEditForm');
                    const descuentoId = document.getElementById('descuentoId');
                    const descuentoActivo = document.getElementById('descuentoActivo');
                    const descuentoForm = document.getElementById('descuentoForm');

                    if (descuentoFormTitle) descuentoFormTitle.textContent = 'Nuevo Descuento';
                    if (descuentoSubmitText) descuentoSubmitText.textContent = 'Guardar Descuento';
                    if (descuentoEditForm) descuentoEditForm.reset();
                    if (descuentoId) descuentoId.value = '';
                    if (descuentoActivo) descuentoActivo.checked = true;
                    const today = new Date().toISOString().split('T')[0];
                    const oneMonthFromNow = new Date();
                    oneMonthFromNow.setMonth(oneMonthFromNow.getMonth() + 1);
                    const oneMonthFromNowStr = oneMonthFromNow.toISOString().split('T')[0];

                    const descuentoInicio = document.getElementById('descuentoInicio');
                    const descuentoFin = document.getElementById('descuentoFin');

                    if (descuentoInicio) descuentoInicio.value = today;
                    if (descuentoFin) descuentoFin.value = oneMonthFromNowStr;

                    if (descuentoForm) descuentoForm.style.display = 'block';
                });
            }
            const cancelDescuentoFormBtn = document.getElementById('cancelDescuentoForm');
            if (cancelDescuentoFormBtn) {
                cancelDescuentoFormBtn.addEventListener('click', () => {
                    const descuentoForm = document.getElementById('descuentoForm');
                    if (descuentoForm) descuentoForm.style.display = 'none';
                });
            }
            const descuentoEditForm = document.getElementById('descuentoEditForm');
            if (descuentoEditForm) {
                descuentoEditForm.addEventListener('submit', async (e) => {
                    e.preventDefault();

                    const descuentoId = document.getElementById('descuentoId').value;
                    const servicioId = document.getElementById('descuentoServicio').value;
                    const porcentaje = parseInt(document.getElementById('descuentoPorcentaje').value);
                    const etiqueta = document.getElementById('descuentoEtiqueta').value;
                    const fechaInicio = document.getElementById('descuentoInicio').value;
                    const fechaFin = document.getElementById('descuentoFin').value;
                    const activo = document.getElementById('descuentoActivo').checked;

                    try {
                        const submitBtn = e.target.querySelector('button[type="submit"]');
                        if (submitBtn) submitBtn.disabled = true;

                        let data, error;

                        if (descuentoId) {
                            ({ data, error } = await supabase
                                .from('discounts')
                                .update({
                                    service_id: servicioId,
                                    percent_off: porcentaje,
                                    label: etiqueta,
                                    date_start: fechaInicio,
                                    date_end: fechaFin,
                                    is_active: activo
                                })
                                .eq('id', descuentoId));
                        } else {
                            ({ data, error } = await supabase
                                .from('discounts')
                                .insert([{
                                    service_id: servicioId,
                                    percent_off: porcentaje,
                                    label: etiqueta,
                                    date_start: fechaInicio,
                                    date_end: fechaFin,
                                    is_active: activo
                                }]));
                        }

                        if (error) throw error;

                        utils.showToast('Éxito', `Descuento ${descuentoId ? 'actualizado' : 'creado'} correctamente`, 'success');
                        document.getElementById('descuentoForm').style.display = 'none';
                        await loadAdminDiscounts();
                        if (submitBtn) submitBtn.disabled = false;
                    } catch (error) {
                        console.error('Error saving discount:', error);
                        utils.showToast('Error', 'Hubo un problema al guardar el descuento', 'error');
                        const submitBtn = e.target.querySelector('button[type="submit"]');
                        if (submitBtn) submitBtn.disabled = false;
                    }
                });
            }
            const addMediaBtn = document.getElementById('addMedia');
            if (addMediaBtn) {
                addMediaBtn.addEventListener('click', () => {
                    const mediaForm = document.getElementById('mediaForm');
                    const filePreview = document.getElementById('filePreview');
                    const mediaUploadForm = document.getElementById('mediaUploadForm');

                    if (mediaForm) mediaForm.style.display = 'block';
                    if (filePreview) filePreview.style.display = 'none';
                    if (mediaUploadForm) mediaUploadForm.reset();
                });
            }
            const cancelMediaFormBtn = document.getElementById('cancelMediaForm');
            if (cancelMediaFormBtn) {
                cancelMediaFormBtn.addEventListener('click', () => {
                    const mediaForm = document.getElementById('mediaForm');
                    if (mediaForm) mediaForm.style.display = 'none';
                });
            }
            const mediaFileInput = document.getElementById('mediaFile');
            if (mediaFileInput) {
                mediaFileInput.addEventListener('change', function () {
                    const file = this.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = function (e) {
                            const previewImage = document.getElementById('previewImage');
                            const filePreview = document.getElementById('filePreview');

                            if (previewImage) previewImage.src = e.target.result;
                            if (filePreview) filePreview.style.display = 'block';
                        };
                        reader.readAsDataURL(file);
                    }
                });
            }
            const servicioImagenInput = document.getElementById('servicioImagen');
            if (servicioImagenInput) {
                servicioImagenInput.addEventListener('change', function () {
                    const file = this.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = function (e) {
                            const previewImageServicio = document.getElementById('previewImageServicio');
                            const servicioImagenPreview = document.getElementById('servicioImagenPreview');

                            if (previewImageServicio) previewImageServicio.src = e.target.result;
                            if (servicioImagenPreview) servicioImagenPreview.style.display = 'block';
                        };
                        reader.readAsDataURL(file);
                    }
                });
            }
            const mediaUploadForm = document.getElementById('mediaUploadForm');
            if (mediaUploadForm) {
                mediaUploadForm.addEventListener('submit', async (e) => {
                    e.preventDefault();

                    const fileInput = document.getElementById('mediaFile');
                    const serviceId = document.getElementById('mediaServicio').value;
                    const isPublic = document.getElementById('mediaPublic').checked;

                    if (!fileInput || !fileInput.files.length) {
                        utils.showToast('Error', 'Debes seleccionar una imagen para el servicio', 'error');
                        return;
                    }

                    const file = fileInput.files[0];

                    try {
                        const submitBtn = e.target.querySelector('button[type="submit"]');
                        if (submitBtn) submitBtn.disabled = true;
                        const timestamp = new Date().getTime();
                        const fileExt = file.name.split('.').pop();
                        const fileName = `${timestamp}.${fileExt}`;
                        const filePath = serviceId
                            ? `service_${serviceId}_${fileName}`
                            : `general_${fileName}`;

                        console.log('Uploading to bucket: pinky-portfolio, path:', filePath);
                        const { data: storageData, error: storageError } = await supabase.storage
                            .from('pinky-portfolio')
                            .upload(filePath, file, {
                                cacheControl: '3600',
                                upsert: false
                            });

                        if (storageError) {
                            console.error('Storage error:', storageError);
                            throw storageError;
                        }
                        const { data: urlData } = supabase.storage
                            .from('pinky-portfolio')
                            .getPublicUrl(filePath);
                        const { data, error } = await supabase
                            .from('media')
                            .insert([{
                                service_id: serviceId || null,
                                url_storage: urlData.publicUrl,
                                is_public: isPublic
                            }]);

                        if (error) throw error;

                        utils.showToast('Éxito', 'Imagen subida correctamente', 'success');
                        document.getElementById('mediaForm').style.display = 'none';
                        await loadAdminMedia();
                        await loadLashbook();
                        if (submitBtn) submitBtn.disabled = false;
                    } catch (error) {
                        console.error('Error uploading media:', error);
                        utils.showToast('Error', 'Hubo un problema al subir la imagen: ' + error.message, 'error');
                        const submitBtn = e.target.querySelector('button[type="submit"]');
                        if (submitBtn) submitBtn.disabled = false;
                    }
                });
            }
            const metricsDateRange = document.getElementById('metricsDateRange');
            if (metricsDateRange) {
                metricsDateRange.addEventListener('change', function () {
                    updateMetrics(this.value);
                });
            }
            const downloadChartButtons = {
                'downloadChartIngresos': 'chartIngresos',
                'downloadChartIngresosPorServicio': 'chartIngresosPorServicio',
                'downloadChartServicios': 'chartServicios',
                'downloadChartReservasPorDia': 'chartReservasPorDia',
                'downloadChartHorarioPopular': 'chartHorarioPopular',
                'downloadChartKPIs': 'chartKPIs'
            };

            Object.entries(downloadChartButtons).forEach(([btnId, chartId]) => {
                const btn = document.getElementById(btnId);
                if (btn) {
                    btn.addEventListener('click', () => {
                        downloadChart(chartId, `${chartId}.png`);
                    });
                }
            });
            const searchAppointmentsInput = document.getElementById('searchAppointments');
            if (searchAppointmentsInput) {
                searchAppointmentsInput.addEventListener('input', utils.debounce(function () {
                    const searchTerm = this.value.toLowerCase();
                    filterAppointments(searchTerm);
                }, 300));
            }
            const searchReviewsInput = document.getElementById('searchReviews');
            if (searchReviewsInput) {
                searchReviewsInput.addEventListener('input', utils.debounce(function () {
                    const searchTerm = this.value.toLowerCase();
                    filterReviews(searchTerm);
                }, 300));
            }
        }
        function filterAppointments(searchTerm) {
            const rows = document.querySelectorAll('#reservasTable tbody tr');

            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                if (text.includes(searchTerm)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }
        function filterReviews(searchTerm) {
            const rows = document.querySelectorAll('#resenasTable tbody tr');

            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                if (text.includes(searchTerm)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }
        function downloadChart(chartId, filename) {
            try {
                const canvas = document.getElementById(chartId);
                if (!canvas) {
                    console.error(`Canvas with ID ${chartId} not found`);
                    utils.showToast('Error', 'No se pudo descargar el gráfico', 'error');
                    return;
                }

                const link = document.createElement('a');
                link.download = filename;
                link.href = canvas.toDataURL('image/png');
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            } catch (error) {
                console.error('Error downloading chart:', error);
                utils.showToast('Error', 'Hubo un problema al descargar el gráfico', 'error');
            }
        }
        function exportAppointmentsToCSV() {
            const activeTab = document.querySelector('#adminReservas .admin-tab.active');
            const status = activeTab ? activeTab.getAttribute('data-status') : 'all';
            let filteredAppointments = [...appData.appointments];

            if (status !== 'all') {
                filteredAppointments = filteredAppointments.filter(a => a.status === status);
            }
            filteredAppointments.sort((a, b) => {
                if (a.date === b.date) {
                    return a.start_time.localeCompare(b.start_time);
                }
                return a.date.localeCompare(b.date);
            });
            const headers = ['ID', 'Fecha', 'Hora Inicio', 'Hora Fin', 'Cliente', 'Teléfono', 'Servicio', 'Estado'];
            const rows = [headers];

            filteredAppointments.forEach(appointment => {
                const service = appData.services.find(s => s.id === appointment.service_id);
                const serviceName = service ? service.name : 'N/A';

                let statusText = '';
                switch (appointment.status) {
                    case 'PENDING':
                        statusText = 'Pendiente';
                        break;
                    case 'CONFIRMED':
                        statusText = 'Confirmada';
                        break;
                    case 'CANCELLED':
                        statusText = 'Cancelada';
                        break;
                }

                rows.push([
                    appointment.id,
                    appointment.date,
                    appointment.start_time,
                    appointment.end_time,
                    appointment.customer_name,
                    appointment.customer_phone,
                    serviceName,
                    statusText
                ]);
            });
            utils.exportToCSV(rows, `reservas_${new Date().toISOString().split('T')[0]}.csv`);
        }
        function updateMetrics(daysRange) {
            const range = parseInt(daysRange);
            const endDate = new Date();
            const startDate = new Date();
            startDate.setDate(startDate.getDate() - range);
            const appointmentsInRange = appData.appointments.filter(a => {
                const appointmentDate = new Date(a.date);
                return appointmentDate >= startDate && appointmentDate <= endDate && a.status !== 'CANCELLED';
            });
            let totalIncome = 0;

            appointmentsInRange.forEach(appointment => {
                const service = appData.services.find(s => s.id === appointment.service_id);

                if (service) {
                    const dateAppointment = new Date(appointment.date);
                    const activeDiscounts = appData.discounts.filter(d =>
                        d.service_id === service.id &&
                        d.is_active &&
                        new Date(d.date_start) <= dateAppointment &&
                        new Date(d.date_end) >= dateAppointment
                    );

                    const hasDiscount = activeDiscounts.length > 0;
                    const discount = hasDiscount ? activeDiscounts[0] : null;
                    const finalPrice = hasDiscount
                        ? Math.round(service.base_price * (1 - discount.percent_off / 100))
                        : service.base_price;

                    totalIncome += finalPrice;
                }
            });

            const metricaIngresoTotalElement = document.getElementById('metricaIngresoTotal');
            if (metricaIngresoTotalElement) {
                metricaIngresoTotalElement.textContent = utils.formatCurrency(totalIncome);
            }
            const uniqueClients = new Set();
            appointmentsInRange.forEach(appointment => {
                uniqueClients.add(appointment.customer_phone);
            });

            const metricaClientesTotalElement = document.getElementById('metricaClientesTotal');
            if (metricaClientesTotalElement) {
                metricaClientesTotalElement.textContent = uniqueClients.size;
            }
            updateChartsForRange(range);
        }
        function updateChartsForRange(daysRange) {
            const endDate = new Date();
            const startDate = new Date();
            startDate.setDate(startDate.getDate() - daysRange);
            const appointmentsInRange = appData.appointments.filter(a => {
                const appointmentDate = new Date(a.date);
                return appointmentDate >= startDate && appointmentDate <= endDate && a.status !== 'CANCELLED';
            });
            const ingresosPorServicioData = calculateIncomeByServiceForRange(appointmentsInRange);
            const chartIngresosPorServicio = cache.charts.ingresosPorServicio;

            if (chartIngresosPorServicio) {
                chartIngresosPorServicio.data.labels = ingresosPorServicioData.labels;
                chartIngresosPorServicio.data.datasets[0].data = ingresosPorServicioData.data;
                chartIngresosPorServicio.update();
            }
            const reservasPorDiaData = calculateBookingsByDayForRange(appointmentsInRange);
            const chartReservasPorDia = cache.charts.reservasPorDia;

            if (chartReservasPorDia) {
                chartReservasPorDia.data.datasets[0].data = reservasPorDiaData;
                chartReservasPorDia.update();
            }
            const horarioPopularData = calculatePopularTimeSlotsForRange(appointmentsInRange);
            const chartHorarioPopular = cache.charts.horarioPopular;

            if (chartHorarioPopular) {
                chartHorarioPopular.data.labels = horarioPopularData.labels;
                chartHorarioPopular.data.datasets[0].data = horarioPopularData.data;
                chartHorarioPopular.update();
            }
        }
        function calculateIncomeByServiceForRange(appointments) {
            const serviceIncome = {};

            appointments.forEach(appointment => {
                const serviceId = appointment.service_id;
                const service = appData.services.find(s => s.id === serviceId);

                if (service) {
                    const dateAppointment = new Date(appointment.date);
                    const activeDiscounts = appData.discounts.filter(d =>
                        d.service_id === service.id &&
                        d.is_active &&
                        new Date(d.date_start) <= dateAppointment &&
                        new Date(d.date_end) >= dateAppointment
                    );

                    const hasDiscount = activeDiscounts.length > 0;
                    const discount = hasDiscount ? activeDiscounts[0] : null;
                    const finalPrice = hasDiscount
                        ? Math.round(service.base_price * (1 - discount.percent_off / 100))
                        : service.base_price;

                    serviceIncome[serviceId] = (serviceIncome[serviceId] || 0) + finalPrice;
                }
            });
            const sortedServices = Object.entries(serviceIncome)
                .sort((a, b) => b[1] - a[1]);

            const labels = sortedServices.map(([serviceId]) => {
                const service = appData.services.find(s => s.id == serviceId);
                return service ? service.name : 'Desconocido';
            });

            const data = sortedServices.map(([_, income]) => income);

            return { labels, data };
        }
        function calculateBookingsByDayForRange(appointments) {
            const dayCount = Array(7).fill(0);

            appointments.forEach(appointment => {
                const dayOfWeek = new Date(appointment.date).getDay();
                dayCount[dayOfWeek]++;
            });

            return dayCount;
        }
        function calculatePopularTimeSlotsForRange(appointments) {
            const timeSlots = {};

            appointments.forEach(appointment => {
                const hour = appointment.start_time.substring(0, 2);
                timeSlots[hour] = (timeSlots[hour] || 0) + 1;
            });
            const labels = [];
            const data = [];

            for (let i = 9; i <= 20; i++) {
                const hour = i.toString().padStart(2, '0');
                labels.push(`${hour}:00`);
                data.push(timeSlots[hour] || 0);
            }

            return { labels, data };
        }
        window.editService = function (id) {
            const service = appData.services.find(s => s.id === id);

            if (!service) {
                utils.showToast('Error', 'Servicio no encontrado', 'error');
                return;
            }

            const servicioFormTitle = document.getElementById('servicioFormTitle');
            const servicioSubmitText = document.getElementById('servicioSubmitText');

            if (servicioFormTitle) servicioFormTitle.textContent = 'Editar Servicio';
            if (servicioSubmitText) servicioSubmitText.textContent = 'Actualizar Servicio';

            const servicioId = document.getElementById('servicioId');
            const servicioNombre = document.getElementById('servicioNombre');
            const servicioCategoria = document.getElementById('servicioCategoria');
            const servicioEfecto = document.getElementById('servicioEfecto');
            const servicioMinutos = document.getElementById('servicioMinutos');
            const servicioDuracion = document.getElementById('servicioDuracion');
            const servicioBasePrecio = document.getElementById('servicioBasePrecio');
            const servicioRetoquePrecio = document.getElementById('servicioRetoquePrecio');
            const servicioDescripcion = document.getElementById('servicioDescripcion');
            const servicioActivo = document.getElementById('servicioActivo');

            if (servicioId) servicioId.value = service.id;
            if (servicioNombre) servicioNombre.value = service.name;
            if (servicioCategoria) servicioCategoria.value = service.category;
            if (servicioEfecto) servicioEfecto.value = service.effect || '';
            if (servicioMinutos) servicioMinutos.value = service.work_minutes;
            if (servicioDuracion) servicioDuracion.value = service.result_duration_days || '';
            if (servicioBasePrecio) servicioBasePrecio.value = service.base_price;
            if (servicioRetoquePrecio) servicioRetoquePrecio.value = service.retouch_price || '';
            if (servicioDescripcion) servicioDescripcion.value = service.description || '';
            if (servicioActivo) servicioActivo.checked = service.is_active;

            const servicioForm = document.getElementById('servicioForm');
            if (servicioForm) servicioForm.style.display = 'block';
        };
        window.clearServicioImagen = function () {
            const servicioImagen = document.getElementById('servicioImagen');
            const servicioImagenPreview = document.getElementById('servicioImagenPreview');
            const previewImageServicio = document.getElementById('previewImageServicio');

            if (servicioImagen) servicioImagen.value = '';
            if (servicioImagenPreview) servicioImagenPreview.style.display = 'none';
            if (previewImageServicio) previewImageServicio.src = '';
        };
        window.toggleServiceStatus = async function (id, isActive) {
            try {
                const { data, error } = await supabase
                    .from('services')
                    .update({ is_active: isActive })
                    .eq('id', id);

                if (error) throw error;

                utils.showToast('Éxito', `Servicio ${isActive ? 'activado' : 'desactivado'} correctamente`, 'success');
                await loadAdminServices();
                loadServicesAndPrices();
            } catch (error) {
                console.error('Error toggling service status:', error);
                utils.showToast('Error', 'Hubo un problema al cambiar el estado del servicio', 'error');
            }
        };
        window.editDiscount = function (id) {
            const discount = appData.discounts.find(d => d.id === id);

            if (!discount) {
                utils.showToast('Error', 'Descuento no encontrado', 'error');
                return;
            }

            const descuentoFormTitle = document.getElementById('descuentoFormTitle');
            const descuentoSubmitText = document.getElementById('descuentoSubmitText');

            if (descuentoFormTitle) descuentoFormTitle.textContent = 'Editar Descuento';
            if (descuentoSubmitText) descuentoSubmitText.textContent = 'Actualizar Descuento';

            const descuentoId = document.getElementById('descuentoId');
            const descuentoServicio = document.getElementById('descuentoServicio');
            const descuentoPorcentaje = document.getElementById('descuentoPorcentaje');
            const descuentoEtiqueta = document.getElementById('descuentoEtiqueta');
            const descuentoInicio = document.getElementById('descuentoInicio');
            const descuentoFin = document.getElementById('descuentoFin');
            const descuentoActivo = document.getElementById('descuentoActivo');

            if (descuentoId) descuentoId.value = discount.id;
            if (descuentoServicio) descuentoServicio.value = discount.service_id;
            if (descuentoPorcentaje) descuentoPorcentaje.value = discount.percent_off;
            if (descuentoEtiqueta) descuentoEtiqueta.value = discount.label;
            if (descuentoInicio) descuentoInicio.value = discount.date_start;
            if (descuentoFin) descuentoFin.value = discount.date_end;
            if (descuentoActivo) descuentoActivo.checked = discount.is_active;

            const descuentoForm = document.getElementById('descuentoForm');
            if (descuentoForm) descuentoForm.style.display = 'block';
        };
        window.toggleDiscountStatus = async function (id, isActive) {
            try {
                const { data, error } = await supabase
                    .from('discounts')
                    .update({ is_active: isActive })
                    .eq('id', id);

                if (error) throw error;

                utils.showToast('Éxito', `Descuento ${isActive ? 'activado' : 'desactivado'} correctamente`, 'success');
                await loadAdminDiscounts();
            } catch (error) {
                console.error('Error toggling discount status:', error);
                utils.showToast('Error', 'Hubo un problema al cambiar el estado del descuento', 'error');
            }
        };
        window.deleteDiscount = async function (id) {
            if (!confirm('¿Estás seguro de que deseas eliminar este descuento? Esta acción no se puede deshacer.')) {
                return;
            }

            try {
                const { data, error } = await supabase
                    .from('discounts')
                    .delete()
                    .eq('id', id);

                if (error) throw error;

                utils.showToast('Éxito', 'Descuento eliminado correctamente', 'success');
                await loadAdminDiscounts();
            } catch (error) {
                console.error('Error deleting discount:', error);
                utils.showToast('Error', 'Hubo un problema al eliminar el descuento', 'error');
            }
        };
        window.toggleMediaVisibility = async function (id, isPublic) {
            try {
                const { data, error } = await supabase
                    .from('media')
                    .update({ is_public: isPublic })
                    .eq('id', id);

                if (error) throw error;

                utils.showToast('Éxito', `Imagen ${isPublic ? 'publicada' : 'ocultada'} correctamente`, 'success');
                await loadAdminMedia();
                await loadLashbook();
            } catch (error) {
                console.error('Error toggling media visibility:', error);
                utils.showToast('Error', 'Hubo un problema al cambiar la visibilidad de la imagen', 'error');
            }
        };
        window.deleteMedia = async function (id) {
            if (!confirm('¿Estás seguro de que deseas eliminar esta imagen? Esta acción no se puede deshacer.')) {
                return;
            }

            try {
                const { data, error } = await supabase
                    .from('media')
                    .delete()
                    .eq('id', id);

                if (error) throw error;

                utils.showToast('Éxito', 'Imagen eliminada correctamente', 'success');
                await loadAdminMedia();
                await loadLashbook();
            } catch (error) {
                console.error('Error deleting media:', error);
                utils.showToast('Error', 'Hubo un problema al eliminar la imagen', 'error');
            }
        };
        window.deleteBlackout = async function (id) {
            if (!confirm('¿Estás seguro de que deseas eliminar esta fecha de cierre? Esta acción no se puede deshacer.')) {
                return;
            }

            try {
                const { data, error } = await supabase
                    .from('blackouts')
                    .delete()
                    .eq('id', id);

                if (error) throw error;

                utils.showToast('Éxito', 'Fecha de cierre eliminada correctamente', 'success');
                await loadAdminBlackouts();
                await loadBlackoutDates();
            } catch (error) {
                console.error('Error deleting blackout:', error);
                utils.showToast('Error', 'Hubo un problema al eliminar la fecha de cierre', 'error');
            }
        };
        window.approveReview = async function (id) {
            try {
                const { data, error } = await supabase
                    .from('reviews')
                    .update({ is_approved: true })
                    .eq('id', id);

                if (error) throw error;

                utils.showToast('Éxito', 'Reseña aprobada y publicada', 'success');
                await loadAdminReviews();
                await loadReviews();
            } catch (error) {
                console.error('Error approving review:', error);
                utils.showToast('Error', 'Hubo un problema al aprobar la reseña', 'error');
            }
        };
        window.deleteReview = async function (id) {
            if (!confirm('¿Estás seguro de que deseas eliminar esta reseña? Esta acción no se puede deshacer.')) {
                return;
            }

            try {
                const { data, error } = await supabase
                    .from('reviews')
                    .delete()
                    .eq('id', id);

                if (error) throw error;

                utils.showToast('Éxito', 'Reseña eliminada correctamente', 'success');
                await loadAdminReviews();
                await loadReviews();
            } catch (error) {
                console.error('Error deleting review:', error);
                utils.showToast('Error', 'Hubo un problema al eliminar la reseña', 'error');
            }
        };
        window.updateAppointmentStatus = async function (id, status) {
            try {
                const { data, error } = await supabase
                    .from('appointments')
                    .update({ status })
                    .eq('id', id);

                if (error) throw error;

                utils.showToast('Éxito', `Estado de la cita actualizado a ${status === 'CONFIRMED' ? 'Confirmada' : 'Cancelada'}`, 'success');
                const activeTab = document.querySelector('#adminReservas .admin-tab.active');
                const currentStatus = activeTab ? activeTab.getAttribute('data-status') : 'all';
                await loadAdminAppointments(currentStatus);
            } catch (error) {
                console.error('Error updating appointment status:', error);
                utils.showToast('Error', 'Hubo un problema al actualizar el estado de la cita', 'error');
            }
        };
        window.sendWhatsAppReminder = function (appointmentId) {
            const appointment = appData.appointments.find(a => a.id === appointmentId);

            if (!appointment) {
                utils.showToast('Error', 'Cita no encontrada', 'error');
                return;
            }

            const service = appData.services.find(s => s.id === appointment.service_id);
            const formattedDate = utils.formatDate(appointment.date);
            const formattedTime = utils.formatTime(appointment.start_time);
            const dayName = new Date(appointment.date).toLocaleDateString('es-CL', { weekday: 'long' });

            const message = encodeURIComponent(
                `Hola ${appointment.customer_name} 👋\n\n` +
                `Te recuerdo tu cita de *${service?.name || 'servicio'}*\n` +
                `📅 *${dayName} ${formattedDate}*\n` +
                `⏰ *${formattedTime}*\n\n` +
                `Por favor, llega 5 minutos antes para registrar tu entrada.\n\n` +
                `Si necesitas reprogramar, avísame con anticipación.\n\n` +
                `¡Te espero! 💕\n` +
                `Pinky Eyelashess`
            );

            window.open(`https://wa.me/${appointment.customer_phone.replace(/\D/g, '')}?text=${message}`, '_blank');
        };
        window.exportReportPDF = function () {
            try {
                utils.showToast('Info', 'Generando informe PDF...', 'info');
                const reportTitle = 'Informe de Gestión - Pinky Eyelashess';
                const reportDate = utils.formatDate(new Date(), {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
                const now = new Date();
                const currentMonth = now.getMonth();
                const currentYear = now.getFullYear();

                const currentMonthName = now.toLocaleDateString('es-CL', { month: 'long' });

                const currentMonthAppointments = appData.appointments.filter(a =>
                    a.status !== 'CANCELLED' &&
                    new Date(a.date).getMonth() === currentMonth &&
                    new Date(a.date).getFullYear() === currentYear
                );

                const confirmedAppointments = appData.appointments.filter(a => a.status === 'CONFIRMED').length;
                const pendingAppointments = appData.appointments.filter(a => a.status === 'PENDING').length;
                const cancelledAppointments = appData.appointments.filter(a => a.status === 'CANCELLED').length;
                let currentMonthIncome = 0;
                currentMonthAppointments.forEach(appointment => {
                    const service = appData.services.find(s => s.id === appointment.service_id);
                    if (service) {
                        currentMonthIncome += service.base_price;
                    }
                });
                const serviceCount = {};
                appData.appointments
                    .filter(a => a.status !== 'CANCELLED')
                    .forEach(appointment => {
                        const serviceId = appointment.service_id;
                        serviceCount[serviceId] = (serviceCount[serviceId] || 0) + 1;
                    });

                const sortedServices = Object.entries(serviceCount)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 3);

                const topServices = sortedServices.map(([serviceId, count]) => {
                    const service = appData.services.find(s => s.id == serviceId);
                    return {
                        name: service ? service.name : 'Desconocido',
                        count
                    };
                });
                utils.showToast('Éxito', 'Informe PDF generado. Abriendo descarga...', 'success');
                setTimeout(() => {
                    alert('Funcionalidad de exportación a PDF: Aquí se generaría un documento PDF con las siguientes estadísticas:\n\n' +
                        `- Título: ${reportTitle}\n` +
                        `- Fecha: ${reportDate}\n` +
                        `- Ingresos del mes (${currentMonthName}): ${utils.formatCurrency(currentMonthIncome)}\n` +
                        `- Citas del mes: ${currentMonthAppointments.length}\n` +
                        `- Citas confirmadas: ${confirmedAppointments}\n` +
                        `- Citas pendientes: ${pendingAppointments}\n` +
                        `- Citas canceladas: ${cancelledAppointments}\n\n` +
                        `- Servicios más populares:\n` +
                        topServices.map((s, i) => `  ${i + 1}. ${s.name}: ${s.count} reservas`).join('\n'));
                }, 1500);
            } catch (error) {
                console.error('Error generating PDF report:', error);
                utils.showToast('Error', 'Hubo un problema al generar el informe PDF', 'error');
            }
        };

        document.addEventListener('DOMContentLoaded', () => {
            initApp();
            if (window.location.hash === '#admin') {
                setTimeout(() => {
                    const adminLoginModal = document.getElementById('adminLoginModal');
                    if (adminLoginModal) {
                        adminLoginModal.style.display = 'flex';
                    }
                }, 500);
            }
        });
    </script>

</body>

</html>
